/*
JSNES, based on Jamie Sanders' vNES
Copyright (C) 2010 Ben Firshman

This program is free software: you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License
along with this program.  If not, see <http://www.gnu.org/licenses/>.
*/
'use strict';function h(a){this.N={ui:aa,swfPath:"lib/",preferredFrameRate:60,fpsInterval:500,showDisplay:!0,emulateSound:!1,sampleRate:44100,CPU_FREQ_NTSC:1789772.5,CPU_FREQ_PAL:1773447.4};if(void 0!=a)for(var b in this.N)void 0!=a[b]&&(this.N[b]=a[b]);this.Fc=1E3/this.N.preferredFrameRate;this.ui=new this.N.ui(this);this.g=new l(this);this.m=new n(this);this.D=new ba(this);this.k=null;this.Jc=new r;this.ui.Ia("Ready to load a ROM.")}
h.prototype={tb:!1,Cc:0,Qc:null,reset:function(){null!==this.k&&this.k.reset();this.g.reset();this.m.reset();this.D.reset()},start:function(){var a=this;null!==this.b&&this.b.valid?this.tb||(this.tb=!0,requestAnimationFrame(function(){a.frame()}),this.Te(),this.je(),this.fpsInterval=setInterval(function(){a.je()},this.N.fpsInterval)):this.ui.Ia("There is no ROM loaded, or it is invalid.")},frame:function(){ca(this.m);var a=this,b=0,c=this.N.emulateSound,d=this.g,e=this.m,f=this.D;a:for(;;)for(0===
d.ja?(b=da(d),c&&t(f,b),b*=3):8<d.ja?(b=24,c&&t(f,8),d.ja-=8):(b=3*d.ja,c&&t(f,d.ja),d.ja=0);0<b;b--){e.Lb===e.Ea&&1===e.sa&&e.J-21===e.Fa&&v(e,e.Fe,!0);if(e.Pc&&(e.Kc--,0===e.Kc)){e.Pc=!1;ea(e);break a}e.Lb++;341===e.Lb&&(e.Lb=0,fa(e))}this.Cc++;this.tb&&requestAnimationFrame(function(){a.frame()})},je:function(){var a=+new Date,b="Running";this.ee&&(b+=": "+(this.Cc/((a-this.ee)/1E3)).toFixed(2)+" FPS");this.ui.Ia(b);this.Cc=0;this.ee=a},stop:function(){clearInterval(this.fpsInterval);this.tb=!1},
Se:function(){null!==this.Qc&&this.zd(this.Qc)},zd:function(a){this.tb&&this.stop();this.ui.Ia("Loading ROM...");this.b=new ga(this);this.b.load(a);if(this.b.valid){this.reset();var b;b=this.b;void 0!==x[b.Na]?b=new x[b.Na](b.a):(b.a.ui.Ia("This ROM uses a mapper not supported by JSNES: "+(0<=b.Na&&b.Na<b.h.length?b.h[b.Na]:"Unknown Mapper, "+b.Na)+"("+b.Na+")"),b=null);this.k=b;if(!this.k)return;this.k.hc();b=this.b;y(this.m,b.Je?b.pf:0===b.ab?b.ad:b.fd);this.Qc=a;this.ui.Ia("Successfully loaded. Ready to be started.")}else this.ui.Ia("Invalid ROM!");
return this.b.valid},Te:function(){this.ee=null;this.Cc=0},fg:function(a){this.N.preferredFrameRate=a;this.Fc=1E3/a;this.D.og(this.N.sampleRate,!1)},toJSON:function(){return{romData:this.Qc,cpu:this.g.toJSON(),mmap:this.k.toJSON(),ppu:this.m.toJSON()}},R:function(a){this.zd(a.romData);this.g.R(a.cpu);this.k.R(a.mmap);this.m.R(a.ppu)}};function z(a,b,c,d,e){for(var f=0;f<e;++f)c[d+f]=a[b+f]}function ha(a,b){for(var c in a.Jb)a.Jb.hasOwnProperty(c)&&(a[c]=b[a.Jb[c]])}function ia(a){var b={},c;for(c in a.Jb)a.Jb.hasOwnProperty(c)&&(b[a.Jb[c]]=a[c]);return b};function l(a){this.a=a;this.ud=this.fc=this.ja=this.ic=this.$c=this.za=this.xe=this.La=this.f=this.e=this.ga=this.pc=this.fa=this.Ka=this.o=this.De=this.U=this.i=this.W=this.u=this.q=this.c=this.n=null;this.reset()}
l.prototype={dd:0,Yf:1,ed:2,reset:function(){this.n=new Uint8Array(65536);for(var a=0;8192>a;a++)this.n[a]=255;for(var b=0;4>b;b++)a=2048*b,this.n[a+8]=247,this.n[a+9]=239,this.n[a+10]=223,this.n[a+15]=191;for(a=8193;a<this.n.length;a++)this.n[a]=0;this.u=this.q=this.c=0;this.W=511;this.U=this.i=32767;this.De=40;this.fa=this.f=this.o=0;this.Ka=1;this.za=0;this.La=1;this.Ka=this.o=this.e=this.ga=0;this.pc=this.fa=1;this.e=this.ga=0;this.$c=this.za=this.xe=this.La=this.f=1;this.ic=(new ja).ic;this.ja=
0;this.fc=!1;this.ud=null},load:function(a){return 8192>a?this.n[a&2047]:this.a.k.load(a)},write:function(a,b){8192>a?this.n[a&2047]=b:this.a.k.write(a,b)},push:function(a){this.a.k.write(this.W,a);this.W--;this.W=256|this.W&255},Jb:{n:"mem",ja:"cyclesToHalt",fc:"irqRequested",ud:"irqType",c:"REG_ACC",q:"REG_X",u:"REG_Y",W:"REG_SP",i:"REG_PC",U:"REG_PC_NEW",De:"REG_STATUS",o:"F_CARRY",Ka:"F_DECIMAL",fa:"F_INTERRUPT",pc:"F_INTERRUPT_NEW",ga:"F_OVERFLOW",e:"F_SIGN",f:"F_ZERO",La:"F_NOTUSED",xe:"F_NOTUSED_NEW",
za:"F_BRK",$c:"F_BRK_NEW"},toJSON:function(){return ia(this)},R:function(a){ha(this,a)}};function A(a){a.W++;a.W=256|a.W&255;return a.a.k.load(a.W)}function B(a,b){a.fc&&b==a.dd||(a.fc=!0,a.ud=b)}function D(a,b){return 8191>b?a.n[b&2047]|a.n[b+1&2047]<<8:a.a.k.load(b)|a.a.k.load(b+1)<<8}
function da(a){var b,c;if(a.fc){b=a.o|(0===a.f?1:0)<<1|a.fa<<2|a.Ka<<3|a.za<<4|a.La<<5|a.ga<<6|a.e<<7;a.U=a.i;a.pc=a.fa;switch(a.ud){case 0:if(0!=a.fa)break;var d=b;a.U++;a.push(a.U>>8&255);a.push(a.U&255);a.push(d);a.pc=1;a.$c=0;a.U=a.a.k.load(65534)|a.a.k.load(65535)<<8;a.U--;break;case 1:d=b;0!=(a.a.k.load(8192)&128)&&(a.U++,a.push(a.U>>8&255),a.push(a.U&255),a.push(d),a.U=a.a.k.load(65530)|a.a.k.load(65531)<<8,a.U--);break;case 2:a.U=a.a.k.load(65532)|a.a.k.load(65533)<<8,a.U--}a.i=a.U;a.fa=a.pc;
a.za=a.$c;a.fc=!1}b=a.ic[a.a.k.load(a.i+1)];d=b>>24;c=0;var e=b>>8&255,f=a.i;a.i+=b>>16&255;var g=0;switch(e){case 0:g=a.load(f+2);break;case 1:g=a.load(f+2);g=128>g?g+a.i:g+(a.i-256);break;case 3:g=D(a,f+2);break;case 4:g=a.c;break;case 5:g=a.i;break;case 6:g=a.load(f+2)+a.q&255;break;case 7:g=a.load(f+2)+a.u&255;break;case 8:g=D(a,f+2);(g&65280)!=(g+a.q&65280)&&(c=1);g+=a.q;break;case 9:g=D(a,f+2);(g&65280)!=(g+a.u&65280)&&(c=1);g+=a.u;break;case 10:g=a.load(f+2);(g&65280)!=(g+a.q&65280)&&(c=1);
g+=a.q;g=D(a,g&255);break;case 11:g=D(a,a.load(f+2));(g&65280)!=(g+a.u&65280)&&(c=1);g+=a.u;break;case 12:g=D(a,f+2),g=8191>g?a.n[g]+(a.n[g&65280|(g&255)+1&255]<<8):a.a.k.load(g)+(a.a.k.load(g&65280|(g&255)+1&255)<<8)}g&=65535;switch(b&255){case 0:b=a.c+a.load(g)+a.o;a.ga=0==((a.c^a.load(g))&128)&&0!=((a.c^b)&128)?1:0;a.o=255<b?1:0;a.e=b>>7&1;a.f=b&255;a.c=b&255;d+=c;break;case 1:a.c&=a.load(g);a.e=a.c>>7&1;a.f=a.c;11!=e&&(d+=c);break;case 2:4==e?(a.o=a.c>>7&1,a.c=a.c<<1&255,a.e=a.c>>7&1,a.f=a.c):
(b=a.load(g),a.o=b>>7&1,b=b<<1&255,a.e=b>>7&1,a.f=b,a.write(g,b));break;case 3:0==a.o&&(d+=(f&65280)!=(g&65280)?2:1,a.i=g);break;case 4:1==a.o&&(d+=(f&65280)!=(g&65280)?2:1,a.i=g);break;case 5:0==a.f&&(d+=(f&65280)!=(g&65280)?2:1,a.i=g);break;case 6:b=a.load(g);a.e=b>>7&1;a.ga=b>>6&1;b&=a.c;a.f=b;break;case 7:1==a.e&&(d++,a.i=g);break;case 8:0!=a.f&&(d+=(f&65280)!=(g&65280)?2:1,a.i=g);break;case 9:0==a.e&&(d+=(f&65280)!=(g&65280)?2:1,a.i=g);break;case 10:a.i+=2;a.push(a.i>>8&255);a.push(a.i&255);
a.za=1;a.push(a.o|(0==a.f?1:0)<<1|a.fa<<2|a.Ka<<3|a.za<<4|a.La<<5|a.ga<<6|a.e<<7);a.fa=1;a.i=D(a,65534);a.i--;break;case 11:0==a.ga&&(d+=(f&65280)!=(g&65280)?2:1,a.i=g);break;case 12:1==a.ga&&(d+=(f&65280)!=(g&65280)?2:1,a.i=g);break;case 13:a.o=0;break;case 14:a.Ka=0;break;case 15:a.fa=0;break;case 16:a.ga=0;break;case 17:b=a.c-a.load(g);a.o=0<=b?1:0;a.e=b>>7&1;a.f=b&255;d+=c;break;case 18:b=a.q-a.load(g);a.o=0<=b?1:0;a.e=b>>7&1;a.f=b&255;break;case 19:b=a.u-a.load(g);a.o=0<=b?1:0;a.e=b>>7&1;a.f=
b&255;break;case 20:b=a.load(g)-1&255;a.e=b>>7&1;a.f=b;a.write(g,b);break;case 21:a.q=a.q-1&255;a.e=a.q>>7&1;a.f=a.q;break;case 22:a.u=a.u-1&255;a.e=a.u>>7&1;a.f=a.u;break;case 23:a.c=(a.load(g)^a.c)&255;a.e=a.c>>7&1;a.f=a.c;d+=c;break;case 24:b=a.load(g)+1&255;a.e=b>>7&1;a.f=b;a.write(g,b&255);break;case 25:a.q=a.q+1&255;a.e=a.q>>7&1;a.f=a.q;break;case 26:a.u++;a.u&=255;a.e=a.u>>7&1;a.f=a.u;break;case 27:a.i=g-1;break;case 28:a.push(a.i>>8&255);a.push(a.i&255);a.i=g-1;break;case 29:a.c=a.load(g);
a.e=a.c>>7&1;a.f=a.c;d+=c;break;case 30:a.q=a.load(g);a.e=a.q>>7&1;a.f=a.q;d+=c;break;case 31:a.u=a.load(g);a.e=a.u>>7&1;a.f=a.u;d+=c;break;case 32:4==e?(b=a.c&255,a.o=b&1,b>>=1,a.c=b):(b=a.load(g)&255,a.o=b&1,b>>=1,a.write(g,b));a.e=0;a.f=b;break;case 33:break;case 34:b=(a.load(g)|a.c)&255;a.e=b>>7&1;a.f=b;a.c=b;11!=e&&(d+=c);break;case 35:a.push(a.c);break;case 36:a.za=1;a.push(a.o|(0==a.f?1:0)<<1|a.fa<<2|a.Ka<<3|a.za<<4|a.La<<5|a.ga<<6|a.e<<7);break;case 37:a.c=A(a);a.e=a.c>>7&1;a.f=a.c;break;
case 38:b=A(a);a.o=b&1;a.f=1==(b>>1&1)?0:1;a.fa=b>>2&1;a.Ka=b>>3&1;a.za=b>>4&1;a.La=b>>5&1;a.ga=b>>6&1;a.e=b>>7&1;a.La=1;break;case 39:4==e?(b=a.c,c=a.o,a.o=b>>7&1,b=(b<<1&255)+c,a.c=b):(b=a.load(g),c=a.o,a.o=b>>7&1,b=(b<<1&255)+c,a.write(g,b));a.e=b>>7&1;a.f=b;break;case 40:4==e?(c=a.o<<7,a.o=a.c&1,b=(a.c>>1)+c,a.c=b):(b=a.load(g),c=a.o<<7,a.o=b&1,b=(b>>1)+c,a.write(g,b));a.e=b>>7&1;a.f=b;break;case 41:b=A(a);a.o=b&1;a.f=0==(b>>1&1)?1:0;a.fa=b>>2&1;a.Ka=b>>3&1;a.za=b>>4&1;a.La=b>>5&1;a.ga=b>>6&1;
a.e=b>>7&1;a.i=A(a);a.i+=A(a)<<8;if(65535==a.i)return;a.i--;a.La=1;break;case 42:a.i=A(a);a.i+=A(a)<<8;if(65535==a.i)return;break;case 43:b=a.c-a.load(g)-(1-a.o);a.e=b>>7&1;a.f=b&255;a.ga=0!=((a.c^b)&128)&&0!=((a.c^a.load(g))&128)?1:0;a.o=0>b?0:1;a.c=b&255;11!=e&&(d+=c);break;case 44:a.o=1;break;case 45:a.Ka=1;break;case 46:a.fa=1;break;case 47:a.write(g,a.c);break;case 48:a.write(g,a.q);break;case 49:a.write(g,a.u);break;case 50:a.q=a.c;a.e=a.c>>7&1;a.f=a.c;break;case 51:a.u=a.c;a.e=a.c>>7&1;a.f=
a.c;break;case 52:a.q=a.W-256;a.e=a.W>>7&1;a.f=a.q;break;case 53:a.c=a.q;a.e=a.q>>7&1;a.f=a.q;break;case 54:a.W=a.q+256;a.W=256|a.W&255;break;case 55:a.c=a.u;a.e=a.u>>7&1;a.f=a.u;break;default:a.a.stop(),a.a.jg="Game crashed, invalid opcode at address $"+f.toString(16)}return d}
function ja(){this.ic=new Uint32Array(255);for(var a=0;255>a;a++)this.ic[a]=255;E(this,this.hb,105,this.ya,2,2);E(this,this.hb,101,this.B,2,3);E(this,this.hb,117,this.T,2,4);E(this,this.hb,109,this.v,3,4);E(this,this.hb,125,this.V,3,4);E(this,this.hb,121,this.Va,3,4);E(this,this.hb,97,this.fb,2,6);E(this,this.hb,113,this.eb,2,5);E(this,this.ib,41,this.ya,2,2);E(this,this.ib,37,this.B,2,3);E(this,this.ib,53,this.T,2,4);E(this,this.ib,45,this.v,3,4);E(this,this.ib,61,this.V,3,4);E(this,this.ib,57,this.Va,
3,4);E(this,this.ib,33,this.fb,2,6);E(this,this.ib,49,this.eb,2,5);E(this,this.qc,10,this.Zc,1,2);E(this,this.qc,6,this.B,2,5);E(this,this.qc,22,this.T,2,6);E(this,this.qc,14,this.v,3,6);E(this,this.qc,30,this.V,3,7);E(this,this.qf,144,this.gb,2,2);E(this,this.rf,176,this.gb,2,2);E(this,this.sf,240,this.gb,2,2);E(this,this.ye,36,this.B,2,3);E(this,this.ye,44,this.v,3,4);E(this,this.tf,48,this.gb,2,2);E(this,this.uf,208,this.gb,2,2);E(this,this.vf,16,this.gb,2,2);E(this,this.wf,0,this.t,1,7);E(this,
this.xf,80,this.gb,2,2);E(this,this.yf,112,this.gb,2,2);E(this,this.zf,24,this.t,1,2);E(this,this.Af,216,this.t,1,2);E(this,this.Bf,88,this.t,1,2);E(this,this.Cf,184,this.t,1,2);E(this,this.jb,201,this.ya,2,2);E(this,this.jb,197,this.B,2,3);E(this,this.jb,213,this.T,2,4);E(this,this.jb,205,this.v,3,4);E(this,this.jb,221,this.V,3,4);E(this,this.jb,217,this.Va,3,4);E(this,this.jb,193,this.fb,2,6);E(this,this.jb,209,this.eb,2,5);E(this,this.Pd,224,this.ya,2,2);E(this,this.Pd,228,this.B,2,3);E(this,this.Pd,
236,this.v,3,4);E(this,this.Qd,192,this.ya,2,2);E(this,this.Qd,196,this.B,2,3);E(this,this.Qd,204,this.v,3,4);E(this,this.bd,198,this.B,2,5);E(this,this.bd,214,this.T,2,6);E(this,this.bd,206,this.v,3,6);E(this,this.bd,222,this.V,3,7);E(this,this.Df,202,this.t,1,2);E(this,this.Ef,136,this.t,1,2);E(this,this.kb,73,this.ya,2,2);E(this,this.kb,69,this.B,2,3);E(this,this.kb,85,this.T,2,4);E(this,this.kb,77,this.v,3,4);E(this,this.kb,93,this.V,3,4);E(this,this.kb,89,this.Va,3,4);E(this,this.kb,65,this.fb,
2,6);E(this,this.kb,81,this.eb,2,5);E(this,this.cd,230,this.B,2,5);E(this,this.cd,246,this.T,2,6);E(this,this.cd,238,this.v,3,6);E(this,this.cd,254,this.V,3,7);E(this,this.Ff,232,this.t,1,2);E(this,this.Gf,200,this.t,1,2);E(this,this.ze,76,this.v,3,3);E(this,this.ze,108,this.ff,3,5);E(this,this.Hf,32,this.v,3,6);E(this,this.lb,169,this.ya,2,2);E(this,this.lb,165,this.B,2,3);E(this,this.lb,181,this.T,2,4);E(this,this.lb,173,this.v,3,4);E(this,this.lb,189,this.V,3,4);E(this,this.lb,185,this.Va,3,4);
E(this,this.lb,161,this.fb,2,6);E(this,this.lb,177,this.eb,2,5);E(this,this.rc,162,this.ya,2,2);E(this,this.rc,166,this.B,2,3);E(this,this.rc,182,this.we,2,4);E(this,this.rc,174,this.v,3,4);E(this,this.rc,190,this.Va,3,4);E(this,this.sc,160,this.ya,2,2);E(this,this.sc,164,this.B,2,3);E(this,this.sc,180,this.T,2,4);E(this,this.sc,172,this.v,3,4);E(this,this.sc,188,this.V,3,4);E(this,this.tc,74,this.Zc,1,2);E(this,this.tc,70,this.B,2,5);E(this,this.tc,86,this.T,2,6);E(this,this.tc,78,this.v,3,6);E(this,
this.tc,94,this.V,3,7);E(this,this.If,234,this.t,1,2);E(this,this.mb,9,this.ya,2,2);E(this,this.mb,5,this.B,2,3);E(this,this.mb,21,this.T,2,4);E(this,this.mb,13,this.v,3,4);E(this,this.mb,29,this.V,3,4);E(this,this.mb,25,this.Va,3,4);E(this,this.mb,1,this.fb,2,6);E(this,this.mb,17,this.eb,2,5);E(this,this.Jf,72,this.t,1,3);E(this,this.Kf,8,this.t,1,3);E(this,this.Lf,104,this.t,1,4);E(this,this.Mf,40,this.t,1,4);E(this,this.uc,42,this.Zc,1,2);E(this,this.uc,38,this.B,2,5);E(this,this.uc,54,this.T,
2,6);E(this,this.uc,46,this.v,3,6);E(this,this.uc,62,this.V,3,7);E(this,this.vc,106,this.Zc,1,2);E(this,this.vc,102,this.B,2,5);E(this,this.vc,118,this.T,2,6);E(this,this.vc,110,this.v,3,6);E(this,this.vc,126,this.V,3,7);E(this,this.Nf,64,this.t,1,6);E(this,this.Of,96,this.t,1,6);E(this,this.nb,233,this.ya,2,2);E(this,this.nb,229,this.B,2,3);E(this,this.nb,245,this.T,2,4);E(this,this.nb,237,this.v,3,4);E(this,this.nb,253,this.V,3,4);E(this,this.nb,249,this.Va,3,4);E(this,this.nb,225,this.fb,2,6);
E(this,this.nb,241,this.eb,2,5);E(this,this.Pf,56,this.t,1,2);E(this,this.Qf,248,this.t,1,2);E(this,this.Rf,120,this.t,1,2);E(this,this.Ib,133,this.B,2,3);E(this,this.Ib,149,this.T,2,4);E(this,this.Ib,141,this.v,3,4);E(this,this.Ib,157,this.V,3,5);E(this,this.Ib,153,this.Va,3,5);E(this,this.Ib,129,this.fb,2,6);E(this,this.Ib,145,this.eb,2,6);E(this,this.Rd,134,this.B,2,3);E(this,this.Rd,150,this.we,2,4);E(this,this.Rd,142,this.v,3,4);E(this,this.Sd,132,this.B,2,3);E(this,this.Sd,148,this.T,2,4);E(this,
this.Sd,140,this.v,3,4);E(this,this.Sf,170,this.t,1,2);E(this,this.Tf,168,this.t,1,2);E(this,this.Uf,186,this.t,1,2);E(this,this.Vf,138,this.t,1,2);E(this,this.Wf,154,this.t,1,2);E(this,this.Xf,152,this.t,1,2);new Uint8Array([7,6,2,8,3,3,5,5,3,2,2,2,4,4,6,6,2,5,2,8,4,4,6,6,2,4,2,7,4,4,7,7,6,6,2,8,3,3,5,5,4,2,2,2,4,4,6,6,2,5,2,8,4,4,6,6,2,4,2,7,4,4,7,7,6,6,2,8,3,3,5,5,3,2,2,2,3,4,6,6,2,5,2,8,4,4,6,6,2,4,2,7,4,4,7,7,6,6,2,8,3,3,5,5,4,2,2,2,5,4,6,6,2,5,2,8,4,4,6,6,2,4,2,7,4,4,7,7,2,6,2,6,3,3,3,3,2,2,
2,2,4,4,4,4,2,6,2,6,4,4,4,4,2,5,2,5,5,5,5,5,2,6,2,6,3,3,3,3,2,2,2,2,4,4,4,4,2,5,2,5,4,4,4,4,2,4,2,4,4,4,4,4,2,6,2,8,3,3,5,5,2,2,2,2,4,4,6,6,2,5,2,8,4,4,6,6,2,4,2,7,4,4,7,7,2,6,3,8,3,3,5,5,2,2,2,2,4,4,6,6,2,5,2,8,4,4,6,6,2,4,2,7,4,4,7,7])}
ja.prototype={hb:0,ib:1,qc:2,qf:3,rf:4,sf:5,ye:6,tf:7,uf:8,vf:9,wf:10,xf:11,yf:12,zf:13,Af:14,Bf:15,Cf:16,jb:17,Pd:18,Qd:19,bd:20,Df:21,Ef:22,kb:23,cd:24,Ff:25,Gf:26,ze:27,Hf:28,lb:29,rc:30,sc:31,tc:32,If:33,mb:34,Jf:35,Kf:36,Lf:37,Mf:38,uc:39,vc:40,Nf:41,Of:42,nb:43,Pf:44,Qf:45,Rf:46,Ib:47,Rd:48,Sd:49,Sf:50,Tf:51,Uf:52,Vf:53,Wf:54,Xf:55,B:0,gb:1,t:2,v:3,Zc:4,ya:5,T:6,we:7,V:8,Va:9,fb:10,eb:11,ff:12};function E(a,b,c,d,e,f){a.ic[c]=b&255|(d&255)<<8|(e&255)<<16|(f&255)<<24};function r(){var a=0;this.Ha=new Uint8Array(8);for(a=0;8>a;a++)this.Ha[a]=64;this.Ra=new Uint8Array(8);for(a=0;8>a;a++)this.Ra[a]=64}r.prototype={Ke:function(a){!ka(this,a.keyCode,65)&&a.preventDefault&&a.preventDefault()},Me:function(a){!ka(this,a.keyCode,64)&&a.preventDefault&&a.preventDefault()},Le:function(a){a.preventDefault()}};
function ka(a,b,c){switch(b){case 88:a.Ha[0]=c;break;case 89:a.Ha[1]=c;break;case 90:a.Ha[1]=c;break;case 17:a.Ha[2]=c;break;case 13:a.Ha[3]=c;break;case 38:a.Ha[4]=c;break;case 40:a.Ha[5]=c;break;case 37:a.Ha[6]=c;break;case 39:a.Ha[7]=c;break;case 103:a.Ra[0]=c;break;case 105:a.Ra[1]=c;break;case 99:a.Ra[2]=c;break;case 97:a.Ra[3]=c;break;case 104:a.Ra[4]=c;break;case 98:a.Ra[5]=c;break;case 100:a.Ra[6]=c;break;case 102:a.Ra[7]=c;break;default:return!0}return!1};var x={0:function(a){this.a=a}};
x[0].prototype={reset:function(){this.vd=this.vb=this.ub=0;this.Ad=!1;this.Cd=this.Bd=null},write:function(a,b){8192>a?this.a.g.n[a&2047]=b:16407<a?this.a.g.n[a]=b:8199<a&&16384>a?F(this,8192+(a&7),b):F(this,a,b)},pg:function(a,b){8192>a?this.a.g.n[a&2047]=b:16407<a?this.a.g.n[a]=b:8199<a&&16384>a?F(this,8192+(a&7),b):F(this,a,b)},load:function(a){a&=65535;return 16407<a?this.a.g.n[a]:8192<=a?la(this,a):this.a.g.n[a&2047]},hc:function(){!this.a.b.valid||1>this.a.b.I?alert("NoMapper: Invalid ROM! Unable to load."):
(1<this.a.b.I?(I(this,0,32768),I(this,1,49152)):(I(this,0,32768),I(this,0,49152)),J(this),K(this),B(this.a.g,this.a.g.ed))},mg:function(a,b){if(0!==this.a.b.A){L(this.a.m);var c=Math.floor(a/2)%this.a.b.A;z(this.a.b.Ua[c],a%2*2048,this.a.m.O,b,2048);for(var c=this.a.b.Hb[c],d=b>>4,e=0;128>e;e++)this.a.m.H[d+e]=c[(a%2<<7)+e]}},Xd:function(){},kg:function(){},toJSON:function(){return{joy1StrobeState:this.ub,joy2StrobeState:this.vb,joypadLastWrite:this.vd}},R:function(a){this.ub=a.joy1StrobeState;this.vb=
a.joy2StrobeState;this.vd=a.joypadLastWrite}};function M(a,b,c){z(a.a.b.b[Math.floor(b/2)%a.a.b.I],b%2*8192,a.a.g.n,c,8192)}function N(a,b,c){if(0!==a.a.b.A){L(a.a.m);var d=Math.floor(b/4)%a.a.b.A;z(a.a.b.Ua[d],0,a.a.m.O,b%4*1024,1024);d=a.a.b.Hb[d];c>>=4;for(var e=0;64>e;e++)a.a.m.H[c+e]=d[(b%4<<6)+e]}}function ma(a,b){0!==a.a.b.A&&(L(a.a.m),O(a,b%a.a.b.A,0),O(a,(b+1)%a.a.b.A,4096))}
function O(a,b,c){0!==a.a.b.A&&(L(a.a.m),z(a.a.b.Ua[b%a.a.b.A],0,a.a.m.O,c,4096),z(a.a.b.Hb[b%a.a.b.A],0,a.a.m.H,c>>4,256))}function I(a,b,c){b%=a.a.b.I;z(a.a.b.b[b],0,a.a.g.n,c,16384)}function K(a){if(a.a.b.Ud){var b=a.a.b.Ud;null!==b&&8192==b.length&&z(b,0,a.a.g.n,24576,8192)}}function J(a){0<a.a.b.A&&(1==a.a.b.A?(O(a,0,0),O(a,0,4096)):(O(a,0,0),O(a,1,4096)))}
function na(a){var b;switch(a.vb){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:b=a.a.Jc.Ra[a.vb];break;case 8:case 9:case 10:case 11:case 12:case 13:case 14:case 15:case 16:case 17:case 18:b=0;break;case 19:b=1;break;default:b=0}a.vb++;24==a.vb&&(a.vb=0);return b}
function F(a,b,c){switch(b){case 8192:a.a.g.n[b]=c;oa(a.a.m,c);break;case 8193:a.a.g.n[b]=c;pa(a.a.m,c);break;case 8195:a.a.m.Qa=c;break;case 8196:a=a.a.m;a.cb[a.Qa]=c;P(a,a.Qa,c);a.Qa++;a.Qa%=256;break;case 8197:a=a.a.m;L(a);a.Za?(a.Pa=c>>3&31,a.Oc=c&7):(a.yb=c&7,a.ba=c>>3&31);a.Za=!a.Za;break;case 8198:a=a.a.m;a.Za?(a.yb=c>>4&3,a.zb=c>>3&1,a.Oa=c>>2&1,a.ba=a.ba&7|(c&3)<<3):(L(a),a.ba=a.ba&24|c>>5&7,a.Pa=c&31,a.pa=a.yb,a.Y=a.zb,a.X=a.Oa,a.Q=a.ba,a.qa=a.Pa,Q(a,a.J-20));a.Za=!a.Za;R(a);break;case 8199:a=
a.a.m;L(a);R(a);qa(a);8192<=a.S?(b=a.S,16128<=b&&16160>b?16128==b||16144==b?(S(a,16128,c),S(a,16144,c)):16132==b||16148==b?(S(a,16132,c),S(a,16148,c)):16136==b||16152==b?(S(a,16136,c),S(a,16152,c)):16140==b||16156==b?(S(a,16140,c),S(a,16156,c)):S(a,b,c):b<a.Ja.length?S(a,a.Ja[b],c):alert("Invalid VRAM address: "+b.toString(16))):S(a,a.S,c);a.S+=1==a.zc?32:1;ra(a);sa(a);break;case 16404:a=a.a.m;c*=256;for(var d=a.Qa;256>d;d++)b=a.a.g.n[c+d],a.cb[d]=b,P(a,d,b);c=a.a.g;c.ja+=513;break;case 16405:a.a.D.P(b,
c);break;case 16406:0===(c&1)&&1===(a.vd&1)&&(a.ub=0,a.vb=0);a.vd=c;break;case 16407:a.a.D.P(b,c);break;default:16384<=b&&16407>=b&&a.a.D.P(b,c)}}
function la(a,b){switch(b>>12){case 2:case 3:switch(b&7){case 0:return a.a.g.n[8192];case 1:return a.a.g.n[8193];case 2:var c=a.a.m,d=c.a.g.n[8194];c.Za=!0;v(c,c.Td,!1);return d;case 3:return 0;case 4:return c=a.a.m,c.cb[c.Qa];case 5:return 0;case 6:return 0;case 7:return c=a.a.m,R(c),qa(c),16127>=c.S?(d=c.Od,c.Od=8192>c.S?c.O[c.S]:c.O[c.Ja[c.S]]):d=c.O[c.Ja[c.S]],c.S+=1==c.zc?32:1,sa(c),ra(c),d}break;case 4:switch(b-16405){case 0:return a.a.D.Re(b);case 1:switch(a.ub){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:c=
a.a.Jc.Ha[a.ub];break;case 8:case 9:case 10:case 11:case 12:case 13:case 14:case 15:case 16:case 17:case 18:c=0;break;case 19:c=1;break;default:c=0}a.ub++;24==a.ub&&(a.ub=0);return c;case 2:if(a.Ad){for(var c=Math.max(0,a.Bd-4),d=Math.min(256,a.Bd+4),e=Math.max(0,a.Cd-4),f=Math.min(240,a.Cd+4),g=0;e<f;e++)for(var k=c;k<d;k++)if(16777215==a.a.m.buffer[(e<<8)+k]){g|=8;console.debug("Clicked on white!");break}g|=a.Ad?16:0;return(na(a)|g)&65535}return na(a)}}return 0}x[1]=function(a){this.a=a};
x[1].prototype=new x[0];x[1].prototype.reset=function(){x[0].prototype.reset.apply(this);this.Oe=this.ab=this.xb=this.Vb=0;this.Nc=this.Mc=1;this.Ve=this.Sc=this.Ab=this.oc=0};
x[1].prototype.write=function(a,b){if(32768>a)x[0].prototype.write.apply(this,arguments);else if(0!==(b&128))this.Vb=this.xb=0,0===ta(a)&&(this.Nc=this.Mc=1);else if(this.Vb=this.Vb&255-(1<<this.xb)|(b&1)<<this.xb,this.xb++,5==this.xb){var c=this.Vb,d;switch(ta(a)){case 0:d=c&3;d!==this.ab&&(this.ab=d,0===(this.ab&2)?y(this.a.m,this.a.b.Ee):0!==(this.ab&1)?y(this.a.m,this.a.b.ad):y(this.a.m,this.a.b.fd));this.Mc=c>>2&1;this.Nc=c>>3&1;this.oc=c>>4&1;break;case 1:this.Ab=c>>4&1;0<this.a.b.A&&(0===this.oc?
0===this.Ab?ma(this,c&15):ma(this,Math.floor(this.a.b.A/2)+(c&15)):0===this.Ab?O(this,c&15,0):O(this,Math.floor(this.a.b.A/2)+(c&15),0));break;case 2:this.Sc=c>>4&1;0<this.a.b.A&&1===this.oc&&(0===this.Sc?O(this,c&15,4096):O(this,Math.floor(this.a.b.A/2)+(c&15),4096));break;default:d=0,32<=this.a.b.I?0===this.oc?1===this.Ab&&(d=16):d=(this.Ab|this.Sc<<1)<<3:16<=this.a.b.I&&1===this.Ab&&(d=8),0===this.Nc?(c=d+(c&15),I(this,2*c%this.a.b.I,32768),I(this,(2*c+1)%this.a.b.I,49152)):(c=2*d+(c&15),0===this.Mc?
I(this,c,49152):I(this,c,32768))}this.xb=this.Vb=0}};function ta(a){return 32768<=a&&40959>=a?0:40960<=a&&49151>=a?1:49152<=a&&57343>=a?2:3}x[1].prototype.hc=function(){this.a.b.valid?(I(this,0,32768),I(this,this.a.b.I-1,49152),J(this),K(this),B(this.a.g,this.a.g.ed)):alert("MMC1: Invalid ROM! Unable to load.")};
x[1].prototype.toJSON=function(){var a=x[0].prototype.toJSON.apply(this);a.mirroring=this.ab;a.oneScreenMirroring=this.Oe;a.prgSwitchingArea=this.Mc;a.prgSwitchingSize=this.Nc;a.vromSwitchingSize=this.oc;a.romSelectionReg0=this.Ab;a.romSelectionReg1=this.Sc;a.romBankSelect=this.Ve;a.regBuffer=this.Vb;a.regBufferCounter=this.xb;return a};
x[1].prototype.R=function(a){x[0].prototype.R.apply(this,a);this.ab=a.mirroring;this.Oe=a.oneScreenMirroring;this.Mc=a.prgSwitchingArea;this.Nc=a.prgSwitchingSize;this.oc=a.vromSwitchingSize;this.Ab=a.romSelectionReg0;this.Sc=a.romSelectionReg1;this.Ve=a.romBankSelect;this.Vb=a.regBuffer;this.xb=a.regBufferCounter};x[2]=function(a){this.a=a};x[2].prototype=new x[0];x[2].prototype.write=function(a,b){32768>a?x[0].prototype.write.apply(this,arguments):I(this,b,32768)};
x[2].prototype.hc=function(){this.a.b.valid?(I(this,0,32768),I(this,this.a.b.I-1,49152),J(this),B(this.a.g,this.a.g.ed)):alert("UNROM: Invalid ROM! Unable to load.")};x[4]=function(a){this.a=a;this.lf=0;this.mf=1;this.gf=2;this.hf=3;this.jf=4;this.kf=5;this.nf=6;this.of=7;this.Ic=this.td=this.ec=this.Pe=this.Wa=this.Ub=this.kd=null;this.Tb=!1};x[4].prototype=new x[0];
x[4].prototype.write=function(a,b){if(32768>a)x[0].prototype.write.apply(this,arguments);else switch(a){case 32768:this.kd=b&7;var c=b>>6&1;c!=this.Ub&&(this.Tb=!0);this.Ub=c;this.Wa=b>>7&1;break;case 32769:c=b;switch(this.kd){case this.lf:0===this.Wa?(N(this,c,0),N(this,c+1,1024)):(N(this,c,4096),N(this,c+1,5120));break;case this.mf:0===this.Wa?(N(this,c,2048),N(this,c+1,3072)):(N(this,c,6144),N(this,c+1,7168));break;case this.gf:0===this.Wa?N(this,c,4096):N(this,c,0);break;case this.hf:0===this.Wa?
N(this,c,5120):N(this,c,1024);break;case this.jf:0===this.Wa?N(this,c,6144):N(this,c,2048);break;case this.kf:0===this.Wa?N(this,c,7168):N(this,c,3072);break;case this.nf:this.Tb&&(0===this.Ub?M(this,2*(this.a.b.I-1),49152):M(this,2*(this.a.b.I-1),32768),this.Tb=!1);0===this.Ub?M(this,c,32768):M(this,c,49152);break;case this.of:M(this,c,40960),this.Tb&&(0===this.Ub?M(this,2*(this.a.b.I-1),49152):M(this,2*(this.a.b.I-1),32768),this.Tb=!1)}break;case 40960:0!==(b&1)?y(this.a.m,this.a.b.ad):y(this.a.m,
this.a.b.fd);break;case 49152:this.ec=b;break;case 49153:this.td=b;break;case 57344:this.Ic=0;break;case 57345:this.Ic=1}};x[4].prototype.hc=function(){this.a.b.valid?(M(this,2*(this.a.b.I-1),49152),M(this,2*(this.a.b.I-1)+1,57344),M(this,0,32768),M(this,1,40960),J(this),K(this),B(this.a.g,this.a.g.ed)):alert("MMC3: Invalid ROM! Unable to load.")};x[4].prototype.Xd=function(){1==this.Ic&&(this.ec--,0>this.ec&&(B(this.a.g,this.a.g.dd),this.ec=this.td))};
x[4].prototype.toJSON=function(){var a=x[0].prototype.toJSON.apply(this);a.command=this.kd;a.prgAddressSelect=this.Ub;a.chrAddressSelect=this.Wa;a.pageNumber=this.Pe;a.irqCounter=this.ec;a.irqLatchValue=this.td;a.irqEnable=this.Ic;a.prgAddressChanged=this.Tb;return a};x[4].prototype.R=function(a){x[0].prototype.R.apply(this,a);this.kd=a.command;this.Ub=a.prgAddressSelect;this.Wa=a.chrAddressSelect;this.Pe=a.pageNumber;this.ec=a.irqCounter;this.td=a.irqLatchValue;this.Ic=a.irqEnable;this.Tb=a.prgAddressChanged};function ba(a){this.a=a;this.wa=new ua(this,!0);this.xa=new ua(this,!1);this.na=new va(this);this.Ca=new wa(this);this.Z=new xa(this);this.rd=4;this.dc=2048;this.Ge=8192;this.$b=0;this.We=44100;this.Eb=this.Db=this.M=this.L=this.yd=null;this.Tc=Array(2*this.Ge);this.Ec=!1;this.Dc=null;this.sd=!1;this.Id=this.Fc=this.Wb=this.xc=this.ra=this.Qb=null;this.Sa=0;this.G=this.ca=this.ma=this.ea=this.da=null;this.Yd=this.Ie=this.Vc=this.Uc=this.Fd=this.Ed=0;this.C=256;this.he=this.ge=this.od=this.Ze=this.$e=
this.cf=this.bf=this.af=this.oe=this.pe=this.se=this.re=this.qe=null;a=this.Sb=[80,170,100,150,128];for(var b=0;5>b;b++)this.Sb[b]=a[b];this.qe=this.Sb[0]*this.C>>8;this.re=this.Sb[1]*this.C>>8;this.se=this.Sb[2]*this.C>>8;this.pe=this.Sb[3]*this.C>>8;this.oe=this.Sb[4]*this.C>>8;this.af=this.C-this.qe;this.bf=this.C-this.re;this.cf=this.C-this.se;this.$e=this.C-this.pe;this.Ze=this.C-this.oe;this.yd=[10,254,20,2,40,4,80,6,160,8,60,10,14,12,26,14,12,16,24,18,48,20,96,22,192,24,72,26,16,28,32,30];
this.L=Array(16);this.L[0]=3424;this.L[1]=3040;this.L[2]=2720;this.L[3]=2560;this.L[4]=2288;this.L[5]=2032;this.L[6]=1808;this.L[7]=1712;this.L[8]=1520;this.L[9]=1280;this.L[10]=1136;this.L[11]=1024;this.L[12]=848;this.L[13]=672;this.L[14]=576;this.L[15]=432;this.M=Array(16);this.M[0]=4;this.M[1]=8;this.M[2]=16;this.M[3]=32;this.M[4]=64;this.M[5]=96;this.M[6]=128;this.M[7]=160;this.M[8]=202;this.M[9]=254;this.M[10]=380;this.M[11]=508;this.M[12]=762;this.M[13]=1016;this.M[14]=2034;this.M[15]=4068;
var c,d=b=0;this.Db=Array(512);this.Eb=Array(3264);for(a=0;512>a;a++)c=95.52/(8128/(a/16)+100),c*=.98411,c*=5E4,c=Math.floor(c),this.Db[a]=c,c>b&&(b=c);for(a=0;3264>a;a++)c=163.67/(24329/(a/16)+100),c*=.98411,c*=5E4,c=Math.floor(c),this.Eb[a]=c,c>d&&(d=c);this.Ie=b+d;this.Yd=this.Ie/2;for(a=0;20>a;a++)16===a?this.P(16400,16):this.P(16384+a,0);this.reset()}
ba.prototype={reset:function(){this.We=this.a.N.sampleRate;this.Id=Math.floor(1024*this.a.N.CPU_FREQ_NTSC*this.a.N.cg/(60*this.We));this.Fc=Math.floor(14915*this.a.N.cg/60);this.$b=this.Wb=0;ya(this,0);this.xc=this.ra=this.Qb=0;this.dc=2048;this.sd=this.Ec=!1;this.ra=0===this.xc?4:0;this.wa.reset();this.xa.reset();this.na.reset();this.Ca.reset();this.Z.reset();this.ca=this.ma=this.ea=this.da=this.G=this.$b=0;this.Ec=!1;this.rd=4;this.Vc=this.Uc=this.Fd=this.Ed=0;this.ge=-5E5;this.he=5E5},Re:function(){var a;
a=0|this.wa.rb();a|=this.xa.rb()<<1;a|=this.na.rb()<<2;a|=this.Ca.rb()<<3;a|=this.Z.rb()<<4;a|=(this.Dc&&this.Ec?1:0)<<6;a|=(this.Z.Pb?1:0)<<7;this.Dc=!1;this.Z.Pb=!1;return a&65535},P:function(a,b){16384<=a&&16388>a?this.wa.P(a,b):16388<=a&&16392>a?this.xa.P(a,b):16392<=a&&16396>a?this.na.P(a,b):16396<=a&&16399>=a?this.Ca.P(a,b):16400===a?this.Z.P(a,b):16401===a?this.Z.P(a,b):16402===a?this.Z.P(a,b):16403===a?this.Z.P(a,b):16405===a?(ya(this,b),0!==b&&0<this.dc&&(this.sd=!0),this.Z.P(a,b)):16407===
a&&(this.xc=b>>7&1,this.Qb=0,this.Dc=!1,this.Ec=0===(b>>6&1),0===this.xc?this.ra=this.rd=4:(this.rd=5,this.ra=0,za(this)))},bb:function(){var a,b;0<this.G?(this.da<<=4,this.da=Math.floor(this.da/this.G),this.ea<<=4,this.ea=Math.floor(this.ea/this.G),this.ma=Math.floor(this.ma/this.G),this.ca<<=4,this.ca=Math.floor(this.ca/this.G),this.G=0):(this.da=this.wa.w<<4,this.ea=this.xa.w<<4,this.ma=this.na.w,this.ca=this.Z.bb<<4);var c=Math.floor((this.Ca.Zb<<4)/this.Ca.G);this.Ca.Zb=c>>4;this.Ca.G=1;a=this.da*
this.qe+this.ea*this.re>>8;b=3*this.ma*this.se+(c<<1)*this.pe+this.ca*this.oe>>8;a>=this.Db.length&&(a=this.Db.length-1);b>=this.Eb.length&&(b=this.Eb.length-1);var d=this.Db[a]+this.Eb[b]-this.Yd;a=this.da*this.af+this.ea*this.bf>>8;b=3*this.ma*this.cf+(c<<1)*this.$e+this.ca*this.Ze>>8;a>=this.Db.length&&(a=this.Db.length-1);b>=this.Eb.length&&(b=this.Eb.length-1);a=this.Db[a]+this.Eb[b]-this.Yd;d-=this.Ed;this.Ed+=d;d=this.Uc+=d-(this.Uc>>10);a-=this.Fd;this.Fd+=a;a=this.Vc+=a-(this.Vc>>10);d>this.ge&&
(this.ge=d);d<this.he&&(this.he=d);this.Tc[this.$b++]=d;this.Tc[this.$b++]=a;this.$b===this.Tc.length&&(this.a.ui.df(this.Tc),this.Tc=Array(2*this.Ge),this.$b=0);this.ca=this.ma=this.ea=this.da=0}};function za(a){a.ra++;a.ra>=a.rd&&(a.ra=0);if(1===a.ra||3===a.ra)a.na.ac(),a.wa.ac(),a.xa.ac(),a.Ca.ac(),Aa(a.wa),Aa(a.xa);if(0<=a.ra&&4>a.ra){a.wa.jd();a.xa.jd();a.Ca.jd();var b=a.na;b.xd?(b.gc=b.fe,T(b)):0<b.gc&&(b.gc--,T(b));b.wd||(b.xd=!1)}3===a.ra&&0===a.xc&&(a.Dc=!0)}
function t(a,b){if(0<a.dc&&a.sd)a.dc-=b,0>=a.dc&&(a.sd=!1);else{b+=a.od;var c=a.Id-a.Wb;b<<10>c?(a.od=(b<<10)-c>>10,b-=a.od):a.od=0;var d=a.Z,e=a.na,f=a.wa,g=a.xa,c=a.Ca;if(d.isEnabled)for(d.lc-=b<<3;0>=d.lc&&0<d.nd;){d.lc+=d.nd;var k=d;k.de&&(0===(k.data&1)?0<k.qb&&k.qb--:63>k.qb&&k.qb++,k.bb=k.isEnabled?(k.qb<<1)+k.ld:0,k.data>>=1);k.md--;if(0>=k.md){k.de=!1;var m=k;0===m.Da&&m.kc===m.Be&&(m.wb=m.Lc,m.Da=m.jc);if(0<m.Da){var p=m;p.data=p.D.a.k.load(p.wb);var q=p.D.a.g;q.ja+=4;p.Da--;p.wb++;65535<
p.wb&&(p.wb=32768);p.de=!0;0===m.Da&&m.kc===m.Ae&&(m.Pb=!0)}k.md=8}k.Pb&&B(k.D.a.g,k.D.a.g.dd)}if(0<e.d)for(e.r-=b;0>=e.r;)e.r+=e.d+1,0<e.gc&&0<e.p&&(e.Fb++,e.Fb&=31,e.isEnabled&&(e.w=16<=e.Fb?e.Fb&15:15-(e.Fb&15),e.w<<=4));f.r-=b;0>=f.r&&(f.r+=f.d+1<<1,f.Cb++,f.Cb&=7,f.Ta());g.r-=b;0>=g.r&&(g.r+=g.d+1<<1,g.Cb++,g.Cb&=7,g.Ta());d=b;if(0<c.r-d)c.r-=d,c.G+=d,c.Zb+=d*c.w;else for(;0<d--;)0>=--c.r&&0<c.d&&(c.Xb<<=1,c.Xc=(c.Xb<<(0===c.ke?1:6)^c.Xb)&32768,0!==c.Xc?(c.Xb|=1,c.Gd=0,c.w=0):(c.Gd=1,c.w=c.isEnabled&&
0<c.p?c.C:0),c.r+=c.d),c.Zb+=c.w,c.G++;a.Ec&&a.Dc&&B(a.a.g,a.a.g.dd);a.Qb+=b<<1;a.Qb>=a.Fc&&(a.Qb-=a.Fc,za(a));c=b;a.na.le&&(a.Sa=Math.floor((a.na.r<<4)/(a.na.d+1)),16<a.Sa&&(a.Sa=16),16<=a.na.Fb&&(a.Sa=16-a.Sa),a.Sa+=a.na.w);2===c?(a.ma+=a.Sa<<1,a.ca+=a.Z.bb<<1,a.da+=a.wa.w<<1,a.ea+=a.xa.w<<1,a.G+=2):4===c?(a.ma+=a.Sa<<2,a.ca+=a.Z.bb<<2,a.da+=a.wa.w<<2,a.ea+=a.xa.w<<2,a.G+=4):(a.ma+=c*a.Sa,a.ca+=c*a.Z.bb,a.da+=c*a.wa.w,a.ea+=c*a.xa.w,a.G+=c);a.Wb+=b<<10;a.Wb>=a.Id&&(a.bb(),a.Wb-=a.Id)}}
function ya(a,b){a.wa.Bb(0!==(b&1));a.xa.Bb(0!==(b&2));a.na.Bb(0!==(b&4));a.Ca.Bb(0!==(b&8));a.Z.Bb(0!==(b&16))}function xa(a){this.D=a;this.Ce=0;this.Be=1;this.Ae=2;this.de=this.isEnabled=null;this.Pb=!1;this.data=this.ld=this.bb=this.lc=this.Da=this.jc=this.wb=this.Lc=this.qb=this.md=this.nd=this.kc=null;this.reset()}
xa.prototype={P:function(a,b){if(16400===a){0===b>>6?this.kc=this.Ce:1===(b>>6&1)?this.kc=this.Be:2===b>>6&&(this.kc=this.Ae);0===(b&128)&&(this.Pb=!1);var c=b&15;this.nd=0<=c&&16>c?this.D.L[c]:0}else 16401===a?(this.qb=b>>1&63,this.ld=b&1,this.bb=(this.qb<<1)+this.ld):16402===a?this.wb=this.Lc=b<<6|49152:16403===a?this.Da=this.jc=(b<<4)+1:16405===a&&(0===(b>>4&1)?this.Da=0:(this.wb=this.Lc,this.Da=this.jc),this.Pb=!1)},Bb:function(a){!this.isEnabled&&a&&(this.Da=this.jc);this.isEnabled=a},rb:function(){return 0!==
this.Da&&this.isEnabled?1:0},reset:function(){this.Pb=this.isEnabled=!1;this.kc=this.Ce;this.data=this.lc=this.ld=this.bb=this.Da=this.jc=this.wb=this.Lc=this.qb=this.md=this.nd=0}};function wa(a){this.D=a;this.C=this.aa=this.Xa=this.ka=this.d=this.r=this.p=this.Nb=this.Ba=this.Mb=this.Ya=this.isEnabled=null;this.Xb=16384;this.w=this.ke=this.Gd=null;this.Zb=0;this.G=1;this.Xc=null;this.reset()}
wa.prototype={reset:function(){this.d=this.r=0;this.isEnabled=!1;this.p=0;this.Mb=this.Ya=this.Ba=!1;this.C=this.aa=this.Xa=this.ka=0;this.Xb=1;this.Xc=this.w=this.ke=this.Gd=0},ac:function(){this.Ba&&0<this.p&&(this.p--,0===this.p&&this.Ta())},jd:function(){this.Nb?(this.Nb=!1,this.Xa=this.ka+1,this.aa=15):0>=--this.Xa&&(this.Xa=this.ka+1,0<this.aa?this.aa--:this.aa=this.Mb?15:0);this.C=this.Ya?this.ka:this.aa;this.Ta()},Ta:function(){this.isEnabled&&0<this.p&&(this.w=this.Gd*this.C)},P:function(a,
b){if(16396===a)this.Ya=0!==(b&16),this.ka=b&15,this.Mb=0!==(b&32),this.Ba=0===(b&32),this.C=this.Ya?this.ka:this.aa;else if(16398===a){var c=b&15;this.d=0<=c&&16>c?this.D.M[c]:0;this.ke=b>>7}else 16399===a&&(this.p=this.D.yd[(b&248)>>3],this.Nb=!0)},Bb:function(a){this.isEnabled=a;a||(this.p=0);this.Ta()},rb:function(){return 0!==this.p&&this.isEnabled?1:0}};
function ua(a,b){this.D=a;this.ag=[0,1,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,1,1,1,1,0,0,0,1,0,0,1,1,1,1,1];this.Ye=b;this.w=this.Zd=this.C=this.aa=this.Xa=this.ka=this.nc=this.Md=this.Ld=this.Kd=this.Cb=this.p=this.d=this.r=this.ue=this.Nb=this.Mb=this.Ya=this.te=this.Ba=this.isEnabled=null;this.reset()}
ua.prototype={reset:function(){this.Zd=this.C=this.aa=this.Xa=this.ka=this.nc=this.Md=this.Ld=this.Kd=this.Cb=this.p=this.d=this.r=0;this.Mb=this.Ya=this.te=this.Ba=this.isEnabled=!1},ac:function(){this.Ba&&0<this.p&&(this.p--,0===this.p&&this.Ta())},jd:function(){this.Nb?(this.Nb=!1,this.Xa=this.ka+1,this.aa=15):0>=--this.Xa&&(this.Xa=this.ka+1,0<this.aa?this.aa--:this.aa=this.Mb?15:0);this.C=this.Ya?this.ka:this.aa;this.Ta()},Ta:function(){this.w=this.isEnabled&&0<this.p&&7<this.d?0===this.Md&&
4095<this.d+(this.d>>this.nc)?0:this.C*this.ag[(this.Zd<<3)+this.Cb]:0},P:function(a,b){var c=this.Ye?0:4;a===16384+c?(this.Ya=0!==(b&16),this.ka=b&15,this.Mb=0!==(b&32),this.Zd=b>>6&3,this.Ba=0===(b&32),this.C=this.Ya?this.ka:this.aa,this.Ta()):a===16385+c?(this.te=0!==(b&128),this.Ld=b>>4&7,this.Md=b>>3&1,this.nc=b&7,this.ue=!0):a===16386+c?(this.d&=1792,this.d|=b):a===16387+c&&(this.d&=255,this.d|=(b&7)<<8,this.isEnabled&&(this.p=this.D.yd[(b&248)>>3]),this.Nb=!0)},Bb:function(a){this.isEnabled=
a;a||(this.p=0);this.Ta()},rb:function(){return 0!==this.p&&this.isEnabled?1:0}};function Aa(a){0>=--a.Kd&&(a.Kd=a.Ld+1,a.te&&0<a.nc&&7<a.d&&(0===a.Md?(a.d+=a.d>>a.nc,4095<a.d&&(a.d=4095)):a.d-=(a.d>>a.nc)-(a.Ye?1:0)));a.ue&&(a.ue=!1,a.Kd=a.Ld+1)}function va(a){this.D=a;this.Xc=this.w=this.fe=this.gc=this.p=this.Fb=this.d=this.r=this.wd=this.xd=this.Ba=this.le=this.isEnabled=null;this.reset()}
va.prototype={reset:function(){this.Fb=this.d=this.r=0;this.le=this.isEnabled=!1;this.p=0;this.Ba=!1;this.fe=this.gc=0;this.xd=!0;this.wd=!1;this.Xc=0;this.w=15},ac:function(){this.Ba&&0<this.p&&(this.p--,0===this.p&&T(this))},rb:function(){return 0!==this.p&&this.isEnabled?1:0},Re:function(){return 0},P:function(a,b){16392===a?(this.wd=0!==(b&128),this.fe=b&127,this.Ba=!this.wd):16394===a?(this.d&=1792,this.d|=b):16395===a&&(this.d&=255,this.d|=(b&7)<<8,this.p=this.D.yd[(b&248)>>3],this.xd=!0);T(this)},
Bb:function(a){this.isEnabled=a;a||(this.p=0);T(this)}};function T(a){a.le=a.isEnabled&&7<a.d&&0<a.gc&&0<a.p};function n(a){this.a=a;this.Rb=this.Ja=this.ta=this.bc=this.l=this.H=this.Hc=this.Yb=this.Gc=this.Fa=this.Ea=this.Vd=this.sb=this.oa=this.mc=this.Ga=this.s=this.ia=this.Lb=this.$a=this.J=this.Xe=this.Gb=this.la=this.gd=this.Qe=this.buffer=this.ob=this.pb=this.Hd=this.Oc=this.Pa=this.ba=this.Oa=this.zb=this.yb=this.qa=this.Q=this.X=this.Y=this.pa=this.Ob=this.pd=this.qd=this.Ma=this.sa=this.Ac=this.be=this.zc=this.Bc=this.ae=this.cc=this.ce=this.Jd=this.Kc=this.Gb=this.yc=this.Ne=this.Pc=this.bc=this.Qa=
this.Za=this.Od=this.Yc=this.S=this.cb=this.O=null;this.hg=!1;this.Wd=!0;this.reset()}
n.prototype={Fe:6,Td:7,reset:function(){var a;this.O=new Uint8Array(32768);this.cb=new Uint8Array(256);for(a=0;a<this.O.length;a++)this.O[a]=0;for(a=0;a<this.cb.length;a++)this.cb[a]=0;this.Yc=this.S=null;this.Od=0;this.Za=!0;this.Qa=0;this.bc=-1;this.Gb=this.yc=this.Ne=this.Pc=!1;this.Kc=0;this.Jd=null;this.Hd=this.Oc=this.Pa=this.ba=this.Oa=this.zb=this.yb=this.qa=this.Q=this.X=this.Y=this.pa=this.Ob=this.pd=this.qd=this.Ma=this.sa=this.Ac=this.be=this.zc=this.Bc=this.ae=this.cc=this.ce=0;this.pb=
null;this.ob=Array(32);this.buffer=Array(61440);this.Qe=Array(61440);this.gd=Array(61440);this.la=Array(61440);this.Gb=null;this.Xe=Array(32);this.J=0;this.$a=-1;this.Lb=0;this.ia=Array(64);this.s=Array(64);this.Ga=Array(64);this.mc=Array(64);this.oa=Array(64);this.sb=Array(64);this.Vd=Array(64);this.Fa=this.Ea=0;this.Gc=!1;this.Yb=Array(16);this.Hc=Array(16);this.H=Array(512);for(a=0;512>a;a++)this.H[a]=new Ba;this.l=Array(4);this.bc=-1;this.ta=Array(4);for(a=0;4>a;a++)this.ta[a]=new Ca(32,32,"Nt"+
a);this.Ja=Array(32768);for(a=0;32768>a;a++)this.Ja[a]=a;a=this.Rb=new Da;a.Kb=[5395026,11796480,10485760,11599933,7602281,91,95,6208,12048,543240,26368,1196544,7153664,0,0,0,12899815,16728064,14421538,16729963,14090399,6818519,6588,21681,27227,35843,43776,2918400,10777088,0,0,0,16316664,16755516,16742785,16735173,16730354,14633471,4681215,46327,57599,58229,259115,7911470,15065624,7895160,0,0,16777215,16773822,16300216,16300248,16758527,16761855,13095423,10148607,8973816,8650717,12122296,16119980,
16777136,16308472,0,0];for(var b,c,d,e,f,g,k,m=0;8>m;m++)for(k=g=f=1,0!==(m&1)&&(k=f=.75),0!==(m&2)&&(g=f=.75),0!==(m&4)&&(k=g=.75),a.$d[m]=Array(64),e=0;64>e;e++)d=a.Kb[e],b=Math.floor((d>>16&255)*f),c=Math.floor((d>>8&255)*g),d=Math.floor((d&255)*k),a.$d[m][e]=b<<16|c<<8|d;Ea(a,0);oa(this,0);pa(this,0)},Jb:{O:"vramMem",cb:"spriteMem",pa:"cntFV",Y:"cntV",X:"cntH",Q:"cntVT",qa:"cntHT",yb:"regFV",zb:"regV",Oa:"regH",ba:"regVT",Pa:"regHT",Oc:"regFH",Hd:"regS",S:"vramAddress",Yc:"vramTmpAddress",ce:"f_nmiOnVblank",
cc:"f_spriteSize",ae:"f_bgPatternTable",Bc:"f_spPatternTable",zc:"f_addrInc",be:"f_nTblAddress",Ac:"f_color",sa:"f_spVisibility",Ma:"f_bgVisibility",qd:"f_spClipping",pd:"f_bgClipping",Ob:"f_dispType",Od:"vramBufferedReadValue",Za:"firstWrite",bc:"currentMirroring",Ja:"vramMirrorTable",l:"ntable1",Qa:"sramAddress",Gc:"hitSpr0",Yb:"sprPalette",Hc:"imgPalette",Lb:"curX",J:"scanline",$a:"lastRenderedScanline",pb:"curNt",ob:"attrib",buffer:"buffer",gd:"bgbuffer",la:"pixrendered",Pc:"requestEndFrame",
Ne:"nmiOk",yc:"dummyCycleToggle",Kc:"nmiCounter",Gb:"validTileData",Jd:"scanlineAlreadyRendered"},toJSON:function(){var a,b=ia(this);b.nameTable=[];for(a=0;a<this.ta.length;a++)b.nameTable[a]=this.ta[a].toJSON();b.ptTile=[];for(a=0;a<this.H.length;a++)b.ptTile[a]=this.H[a].toJSON();return b},R:function(a){var b;ha(this,a);for(b=0;b<this.ta.length;b++)this.ta[b].R(a.nameTable[b]);for(b=0;b<this.H.length;b++)this.H[b].R(a.ptTile[b]);for(b=0;b<this.cb.length;b++)P(this,b,this.cb[b])}};
function P(a,b,c){var d=Math.floor(b/4);0===d&&Q(a,a.J-20);0===b%4?a.s[d]=c:1==b%4?a.Ga[d]=c:2==b%4?(a.oa[d]=0!==(c&128),a.sb[d]=0!==(c&64),a.Vd[d]=0!==(c&32),a.mc[d]=(c&3)<<2):3==b%4&&(a.ia[d]=c)}function U(a,b,c,d){a.ta[b].Nd[c]=d;Q(a,a.J-20)}function Fa(a){var b;for(b=0;16>b;b++)a.Hc[b]=0===a.Ob?a.Rb.Kb[a.O[16128+b]&63]:a.Rb.Kb[a.O[16128+b]&32];for(b=0;16>b;b++)a.Yb[b]=0===a.Ob?a.Rb.Kb[a.O[16144+b]&63]:a.Rb.Kb[a.O[16144+b]&32]}
function S(a,b,c){a.O[b]=c;if(8192>b){a.O[b]=c;var d=Math.floor(b/16),e=b%16;8>e?V(a.H[d],e,c,a.O[b+8]):V(a.H[d],e-8,a.O[b-8],c)}else 8192<=b&&9152>b?U(a,a.l[0],b-8192,c):9152<=b&&9216>b?X(a.ta[a.l[0]],b-9152,c):9216<=b&&10176>b?U(a,a.l[1],b-9216,c):10176<=b&&10240>b?X(a.ta[a.l[1]],b-10176,c):10240<=b&&11200>b?U(a,a.l[2],b-10240,c):11200<=b&&11264>b?X(a.ta[a.l[2]],b-11200,c):11264<=b&&12224>b?U(a,a.l[3],b-11264,c):12224<=b&&12288>b?X(a.ta[a.l[3]],b-12224,c):16128<=b&&16160>b&&Fa(a)}
function Q(a,b){a.Ea=-1;a.Fa=-1;var c,d=0===a.Bc?0:256,e,f,g;e=a.ia[0];c=a.s[0]+1;if(0===a.cc){if(c<=b&&c+8>b&&-7<=e&&256>e)if(d=a.H[a.Ga[0]+d],c=a.oa[0]?7-(b-c):b-c,c*=8,g=256*b+e,a.sb[0])for(f=7;0<=f;f--){if(0<=e&&256>e&&0<=g&&61440>g&&0!==a.la[g]&&0!==d.ha[c+f])return a.Ea=g%256,a.Fa=b,!0;e++;g++}else for(f=0;8>f;f++){if(0<=e&&256>e&&0<=g&&61440>g&&0!==a.la[g]&&0!==d.ha[c+f])return a.Ea=g%256,a.Fa=b,!0;e++;g++}}else if(c<=b&&c+16>b&&-7<=e&&256>e)if(c=a.oa[0]?15-(b-c):b-c,8>c?d=a.H[a.Ga[0]+(a.oa[0]?
1:0)+(0!==(a.Ga[0]&1)?255:0)]:(d=a.H[a.Ga[0]+(a.oa[0]?0:1)+(0!==(a.Ga[0]&1)?255:0)],c=a.oa[0]?15-c:c-8),c*=8,g=256*b+e,a.sb[0])for(f=7;0<=f;f--){if(0<=e&&256>e&&0<=g&&61440>g&&0!==a.la[g]&&0!==d.ha[c+f])return a.Ea=g%256,a.Fa=b,!0;e++;g++}else for(f=0;8>f;f++){if(0<=e&&256>e&&0<=g&&61440>g&&0!==a.la[g]&&0!==d.ha[c+f])return a.Ea=g%256,a.Fa=b,!0;e++;g++}return!1}
function Ga(a,b,c,d){if(1===a.sa)for(var e=0;64>e;e++)if(a.Vd[e]==d&&0<=a.ia[e]&&256>a.ia[e]&&a.s[e]+8>=b&&a.s[e]<b+c)if(0===a.cc)a.me=0,a.ne=8,a.s[e]<b&&(a.me=b-a.s[e]-1),a.s[e]+8>b+c&&(a.ne=b+c-a.s[e]+1),0===a.Bc?Y(a.H[a.Ga[e]],a.buffer,a.me,a.ne,a.ia[e],a.s[e]+1,a.mc[e],a.Yb,a.sb[e],a.oa[e],e,a.la):Y(a.H[a.Ga[e]+256],a.buffer,a.me,a.ne,a.ia[e],a.s[e]+1,a.mc[e],a.Yb,a.sb[e],a.oa[e],e,a.la);else{var f=a.Ga[e];0!==(f&1)&&(f=a.Ga[e]-1+256);var g=0,k=8;a.s[e]<b&&(g=b-a.s[e]-1);a.s[e]+8>b+c&&(k=b+c-
a.s[e]);Y(a.H[f+(a.oa[e]?1:0)],a.buffer,g,k,a.ia[e],a.s[e]+1,a.mc[e],a.Yb,a.sb[e],a.oa[e],e,a.la);g=0;k=8;a.s[e]+8<b&&(g=b-(a.s[e]+8+1));a.s[e]+16>b+c&&(k=b+c-(a.s[e]+8));Y(a.H[f+(a.oa[e]?0:1)],a.buffer,g,k,a.ia[e],a.s[e]+1+8,a.mc[e],a.Yb,a.sb[e],a.oa[e],e,a.la)}}
function Ha(a,b,c){var d=0===a.Hd?0:256,e=(c<<8)-a.Oc;a.pb=a.l[a.Y+a.Y+a.X];a.qa=a.Pa;a.X=a.Oa;a.pb=a.l[a.Y+a.Y+a.X];if(240>c&&0<=c-a.pa){var f=a.pa<<3,g=a.Xe,k=a.ob,m=a.H,p=a.ta,q=a.Hc,w=a.la;b=b?a.gd:a.buffer;for(var s,u,C,G=0;32>G;G++){if(0<=c){a.Gb?(s=g[G],u=s.ha,C=k[G]):(u=p[a.pb],s=m[d+u.Nd[a.Q*u.width+a.qa]],u=s.ha,C=p[a.pb],C=C.ob[a.Q*C.width+a.qa],g[G]=s,k[G]=C);var H=0,W=(G<<3)-a.Oc;if(-8<W)if(0>W&&(e-=W,H=-W),s.Dd[a.pa])for(;8>H;H++)b[e]=q[u[f+H]+C],w[e]|=256,e++;else for(;8>H;H++)s=u[f+
H],0!==s&&(b[e]=q[s+C],w[e]|=256),e++}32==++a.qa&&(a.qa=0,a.X++,a.X%=2,a.pb=a.l[(a.Y<<1)+a.X])}a.Gb=!0}a.pa++;8==a.pa&&(a.pa=0,a.Q++,30==a.Q?(a.Q=0,a.Y++,a.Y%=2,a.pb=a.l[(a.Y<<1)+a.X]):32==a.Q&&(a.Q=0),a.Gb=!1)}function Ia(a,b,c){1==a.sa&&Ga(a,b,c,!0);if(1==a.Ma){var d=b+c<<8;61440<d&&(d=61440);for(var e=a.buffer,f=a.gd,g=a.la,k=b<<8;k<d;k++)255<g[k]&&(e[k]=f[k])}1==a.sa&&Ga(a,b,c,!1);a.Gb=!1}function L(a){21<=a.J&&260>=a.J&&(Ia(a,a.$a+1,a.J-21-a.$a),a.$a=a.J-21)}
function R(a){var b=(a.pa&7)<<4,b=b|(a.Y&1)<<3,b=b|(a.X&1)<<2,b=b|a.Q>>3&3,c=(a.Q&7)<<5,c=c|a.qa&31;a.S=(b<<8|c)&32767}function qa(a){var b=(a.yb&7)<<4,b=b|(a.zb&1)<<3,b=b|(a.Oa&1)<<2,b=b|a.ba>>3&3,c=(a.ba&7)<<5,c=c|a.Pa&31;a.Yc=(b<<8|c)&32767}function sa(a){var b=a.S>>8&255;a.pa=b>>4&3;a.Y=b>>3&1;a.X=b>>2&1;a.Q=a.Q&7|(b&3)<<3;b=a.S&255;a.Q=a.Q&24|b>>5&7;a.qa=b&31}function ra(a){var b=a.Yc>>8&255;a.yb=b>>4&7;a.zb=b>>3&1;a.Oa=b>>2&1;a.ba=a.ba&7|(b&3)<<3;b=a.Yc&255;a.ba=a.ba&24|b>>5&7;a.Pa=b&31}
function v(a,b,c){b=1<<b;a.a.g.n[8194]=a.a.g.n[8194]&255-b|(c?b:0)}function pa(a,b){L(a);a.Ac=b>>5&7;a.sa=b>>4&1;a.Ma=b>>3&1;a.qd=b>>2&1;a.pd=b>>1&1;a.Ob=b&1;0===a.Ob&&Ea(a.Rb,a.Ac);Fa(a)}function oa(a,b){L(a);a.ce=b>>7&1;a.cc=b>>5&1;a.ae=b>>4&1;a.Bc=b>>3&1;a.zc=b>>2&1;a.be=b&3;a.zb=b>>1&1;a.Oa=b&1;a.Hd=b>>4&1}
function ca(a){var b=0;if(0===a.Ob)b=a.Hc[0];else switch(a.Ac){case 0:b=0;break;case 1:b=65280;break;case 2:b=16711680;break;case 3:b=0;break;case 4:b=255;break;default:b=0}var c=a.buffer,d;for(d=0;61440>d;d++)c[d]=b;a=a.la;for(d=0;d<a.length;d++)a[d]=65}
function fa(a){switch(a.J){case 19:a.yc&&(a.Lb=1,a.yc=!a.yc);break;case 20:v(a,a.Td,!1);v(a,a.Fe,!1);a.Gc=!1;a.Ea=-1;a.Fa=-1;if(1==a.Ma||1==a.sa)a.pa=a.yb,a.Y=a.zb,a.X=a.Oa,a.Q=a.ba,a.qa=a.Pa,1==a.Ma&&Ha(a,!1,0);1==a.Ma&&1==a.sa&&Q(a,0);1!=a.Ma&&1!=a.sa||a.a.k.Xd();break;case 261:v(a,a.Td,!0);a.Pc=!0;a.Kc=9;a.J=-1;break;default:21<=a.J&&260>=a.J&&(1==a.Ma&&(a.Jd||(a.qa=a.Pa,a.X=a.Oa,Ha(a,!0,a.J+1-21)),a.Jd=!1,!a.Gc&&1==a.sa&&-7<=a.ia[0]&&256>a.ia[0]&&a.s[0]+1<=a.J-20&&a.s[0]+1+(0===a.cc?8:16)>=a.J-
20&&Q(a,a.J-20)&&(a.Gc=!0)),1!=a.Ma&&1!=a.sa||a.a.k.Xd())}a.J++;qa(a);R(a)}
function ea(a){B(a.a.g,a.a.g.Yf);239>a.$a&&Ia(a,a.$a+1,240-a.$a);var b,c,d=a.buffer;if(a.hg){if(0<=a.ia[0]&&256>a.ia[0]&&0<=a.s[0]&&240>a.s[0]){for(b=0;256>b;b++)d[(a.s[0]<<8)+b]=16733525;for(b=0;240>b;b++)d[(b<<8)+a.ia[0]]=16733525}if(0<=a.Ea&&256>a.Ea&&0<=a.Fa&&240>a.Fa){for(b=0;256>b;b++)d[(a.Fa<<8)+b]=5635925;for(b=0;240>b;b++)d[(b<<8)+a.Ea]=5635925}}if(a.Wd||0===a.pd||0===a.qd)for(c=0;240>c;c++)for(b=0;8>b;b++)d[(c<<8)+b]=0;if(a.Wd)for(c=0;240>c;c++)for(b=0;8>b;b++)d[(c<<8)+255-b]=0;if(a.Wd)for(c=
0;8>c;c++)for(b=0;256>b;b++)d[(c<<8)+b]=0,d[(239-c<<8)+b]=0;a.a.N.showDisplay&&a.a.ui.ef(d,a.Qe);a.$a=-1}function Z(a,b,c,d){for(var e=0;e<d;e++)a.Ja[b+e]=c+e}
function y(a,b){if(b!=a.bc){a.bc=b;L(a);null===a.Ja&&(a.Ja=Array(32768));for(var c=0;32768>c;c++)a.Ja[c]=c;Z(a,16160,16128,32);Z(a,16192,16128,32);Z(a,16256,16128,32);Z(a,16320,16128,32);Z(a,12288,8192,3840);Z(a,16384,0,16384);b==a.a.b.ad?(a.l[0]=0,a.l[1]=0,a.l[2]=1,a.l[3]=1,Z(a,9216,8192,1024),Z(a,11264,10240,1024)):b==a.a.b.fd?(a.l[0]=0,a.l[1]=1,a.l[2]=0,a.l[3]=1,Z(a,10240,8192,1024),Z(a,11264,9216,1024)):b==a.a.b.Ee?(a.l[0]=0,a.l[1]=0,a.l[2]=0,a.l[3]=0,Z(a,9216,8192,1024),Z(a,10240,8192,1024),
Z(a,11264,8192,1024)):b==a.a.b.$f?(a.l[0]=1,a.l[1]=1,a.l[2]=1,a.l[3]=1,Z(a,9216,9216,1024),Z(a,10240,9216,1024),Z(a,11264,9216,1024)):(a.l[0]=0,a.l[1]=1,a.l[2]=2,a.l[3]=3)}}function Ca(a,b,c){this.width=a;this.height=b;this.name=c;this.Nd=Array(a*b);this.ob=Array(a*b)}Ca.prototype={toJSON:function(){return{tile:this.Nd,attrib:this.ob}},R:function(a){this.Nd=a.tile;this.ob=a.attrib}};
function X(a,b,c){var d=b%8*4;b=4*Math.floor(b/8);for(var e,f,g,k=0;2>k;k++)for(var m=0;2>m;m++){e=c>>2*(2*k+m)&3;for(var p=0;2>p;p++)for(var q=0;2>q;q++)f=d+2*m+q,g=b+2*k+p,a.ob[g*a.width+f]=e<<2&12}}function Da(){this.Kb=Array(64);this.$d=Array(8);this.He=-1}Da.prototype={reset:function(){Ea(this,0)}};function Ea(a,b){if(b!=a.He){a.He=b;for(var c=0;64>c;c++)a.Kb[c]=a.$d[b][c]}}function Ba(){this.ha=Array(64);this.F=this.va=this.y=this.x=this.K=this.j=null;this.Dd=Array(8)}
Ba.prototype={toJSON:function(){return{opaque:this.Dd,pix:this.ha}},R:function(a){this.Dd=a.opaque;this.ha=a.pix}};
function Y(a,b,c,d,e,f,g,k,m,p,q,w){var s=0,u=8;if(!(-7>e||256<=e||-7>f||240<=f))if(0>e&&(s-=e),256<=e+u&&(u=256-e),0>f&&(c-=f),240<=f+d&&(d=240-f),m||p)if(m&&!p)for(a.j=(f<<8)+e,a.K=7,a.y=0;8>a.y;a.y++){for(a.x=0;8>a.x;a.x++)a.x>=s&&a.x<u&&a.y>=c&&a.y<d&&(a.va=a.ha[a.K],a.F=w[a.j],0!==a.va&&q<=(a.F&255)&&(b[a.j]=k[a.va+g],a.F=a.F&3840|q,w[a.j]=a.F)),a.j++,a.K--;a.j-=8;a.j+=256;a.K+=16}else if(p&&!m)for(a.j=(f<<8)+e,a.K=56,a.y=0;8>a.y;a.y++){for(a.x=0;8>a.x;a.x++)a.x>=s&&a.x<u&&a.y>=c&&a.y<d&&(a.va=
a.ha[a.K],a.F=w[a.j],0!==a.va&&q<=(a.F&255)&&(b[a.j]=k[a.va+g],a.F=a.F&3840|q,w[a.j]=a.F)),a.j++,a.K++;a.j-=8;a.j+=256;a.K-=16}else for(a.j=(f<<8)+e,a.K=63,a.y=0;8>a.y;a.y++){for(a.x=0;8>a.x;a.x++)a.x>=s&&a.x<u&&a.y>=c&&a.y<d&&(a.va=a.ha[a.K],a.F=w[a.j],0!==a.va&&q<=(a.F&255)&&(b[a.j]=k[a.va+g],a.F=a.F&3840|q,w[a.j]=a.F)),a.j++,a.K--;a.j-=8;a.j+=256}else for(a.j=(f<<8)+e,a.K=0,a.y=0;8>a.y;a.y++){for(a.x=0;8>a.x;a.x++)a.x>=s&&a.x<u&&a.y>=c&&a.y<d&&(a.va=a.ha[a.K],a.F=w[a.j],0!==a.va&&q<=(a.F&255)&&
(b[a.j]=k[a.va+g],a.F=a.F&3840|q,w[a.j]=a.F)),a.j++,a.K++;a.j-=8;a.j+=256}}function V(a,b,c,d){a.K=b<<3;for(a.x=0;8>a.x;a.x++)a.ha[a.K+a.x]=(c>>7-a.x&1)+((d>>7-a.x&1)<<1),0===a.ha[a.K+a.x]&&(a.Dd[b]=!1)};function ga(a){this.a=a;this.h=Array(92);for(a=0;92>a;a++)this.h[a]="Unknown Mapper";this.h[0]="Direct Access";this.h[1]="Nintendo MMC1";this.h[2]="UNROM";this.h[3]="CNROM";this.h[4]="Nintendo MMC3";this.h[5]="Nintendo MMC5";this.h[6]="FFE F4xxx";this.h[7]="AOROM";this.h[8]="FFE F3xxx";this.h[9]="Nintendo MMC2";this.h[10]="Nintendo MMC4";this.h[11]="Color Dreams Chip";this.h[12]="FFE F6xxx";this.h[15]="100-in-1 switch";this.h[16]="Bandai chip";this.h[17]="FFE F8xxx";this.h[18]="Jaleco SS8806 chip";
this.h[19]="Namcot 106 chip";this.h[20]="Famicom Disk System";this.h[21]="Konami VRC4a";this.h[22]="Konami VRC2a";this.h[23]="Konami VRC2a";this.h[24]="Konami VRC6";this.h[25]="Konami VRC4b";this.h[32]="Irem G-101 chip";this.h[33]="Taito TC0190/TC0350";this.h[34]="32kB ROM switch";this.h[64]="Tengen RAMBO-1 chip";this.h[65]="Irem H-3001 chip";this.h[66]="GNROM switch";this.h[67]="SunSoft3 chip";this.h[68]="SunSoft4 chip";this.h[69]="SunSoft5 FME-7 chip";this.h[71]="Camerica chip";this.h[78]="Irem 74HC161/32-based";
this.h[91]="Pirate HK-SF3 chip"}
ga.prototype={fd:0,ad:1,pf:2,Ee:3,$f:4,Aa:null,b:null,Ua:null,Hb:null,I:null,A:null,ab:null,Ud:null,ig:null,Je:null,Na:null,valid:!1,load:function(a){var b,c;if(-1===a.indexOf("NES\u001a"))this.a.ui.Ia("Not a valid NES ROM.");else{this.Aa=new Uint8Array(16);for(b=0;16>b;b++)this.Aa[b]=a.charCodeAt(b)&255;this.I=this.Aa[4];this.A=2*this.Aa[5];this.ab=0!==(this.Aa[6]&1)?1:0;this.Ud=0!==(this.Aa[6]&2);this.ig=0!==(this.Aa[6]&4);this.Je=0!==(this.Aa[6]&8);this.Na=this.Aa[6]>>4|this.Aa[7]&240;c=!1;for(b=
8;16>b;b++)if(0!==this.Aa[b]){c=!0;break}c&&(this.Na&=15);this.b=Array(this.I);var d=16;for(b=0;b<this.I;b++){this.b[b]=new Uint8Array(16384);for(c=0;16384>c&&!(d+c>=a.length);c++)this.b[b][c]=a.charCodeAt(d+c)&255;d+=16384}this.Ua=Array(this.A);for(b=0;b<this.A;b++){this.Ua[b]=new Uint8Array(4096);for(c=0;4096>c&&!(d+c>=a.length);c++)this.Ua[b][c]=a.charCodeAt(d+c)&255;d+=4096}this.Hb=Array(this.A);for(b=0;b<this.A;b++)for(this.Hb[b]=Array(256),c=0;256>c;c++)this.Hb[b][c]=new Ba;for(a=0;a<this.A;a++)for(b=
0;4096>b;b++)c=b>>4,d=b%16,8>d?V(this.Hb[a][c],d,this.Ua[a][b],this.Ua[a][b+8]):V(this.Hb[a][c],d-8,this.Ua[a][b-8],this.Ua[a][b]);this.valid=!0}}};function aa(a){this.a=a;this.enable=function(){};this.Ia=function(){};this.df=function(){};this.ef=function(){}}
"undefined"!==typeof jQuery&&function(a){a.fn.Zf=function(b){function c(c){var f=this;f.a=c;f.root=a("<div></div>");f.screen=a('<canvas class="nes-screen" width="256" height="240"></canvas>').appendTo(f.root);f.screen[0].getContext?(f.eg=a('<div class="nes-roms"></div>').appendTo(f.root),f.Rc=a("<select></select>").appendTo(f.eg),f.controls=a('<div class="nes-controls"></div>').appendTo(f.root),f.buttons={pause:a('<input type="button" value="pause" class="nes-pause" disabled="disabled">').appendTo(f.controls),
Ue:a('<input type="button" value="restart" class="nes-restart" disabled="disabled">').appendTo(f.controls),Wc:a('<input type="button" value="enable sound" class="nes-enablesound">').appendTo(f.controls),zoom:a('<input type="button" value="zoom in" class="nes-zoom">').appendTo(f.controls)},f.status=a('<p class="nes-status">Booting up...</p>').appendTo(f.root),f.root.appendTo(d),f.Rc.change(function(){f.hc()}),f.buttons.pause.click(function(){f.a.tb?(f.a.stop(),f.Ia("Paused"),f.buttons.pause.attr("value",
"resume")):(f.a.start(),f.buttons.pause.attr("value","pause"))}),f.buttons.Ue.click(function(){f.a.Se();f.a.start()}),f.buttons.Wc.click(function(){f.a.N.emulateSound?(f.a.N.emulateSound=!1,f.buttons.Wc.attr("value","enable sound")):(f.a.N.emulateSound=!0,f.buttons.Wc.attr("value","disable sound"))}),f.ve=!1,f.buttons.zoom.click(function(){f.ve?(f.screen.animate({width:"256px",height:"240px"}),f.buttons.zoom.attr("value","zoom in"),f.ve=!1):(f.screen.animate({width:"512px",height:"480px"}),f.buttons.zoom.attr("value",
"zoom out"),f.ve=!0)}),a.offset&&f.screen.mousedown(function(a){f.a.k&&(f.a.k.Ad=!0,f.a.k.Bd=a.pageX-f.screen.offset().left,f.a.k.Cd=a.pageY-f.screen.offset().top)}).mouseup(function(){setTimeout(function(){f.a.k&&(f.a.k.Ad=!1,f.a.k.Bd=0,f.a.k.Cd=0)},500)}),void 0!=b&&f.gg(b),f.wc=f.screen[0].getContext("2d"),f.wc.getImageData?(f.hd=f.wc.getImageData(0,0,256,240),f.dg(),a(document).bind("keydown",function(a){f.a.Jc.Ke(a)}).bind("keyup",function(a){f.a.Jc.Me(a)}).bind("keypress",function(a){f.a.Jc.Le(a)}),
f.bg=new DynamicAudio({swf:c.N.swfPath+"dynamicaudio.swf"})):d.html("Your browser doesn't support writing pixels directly to the <code>&lt;canvas&gt;</code> tag. Try the latest versions of Google Chrome, Safari, Opera or Firefox!")):d.html("Your browser doesn't support the <code>&lt;canvas&gt;</code> tag. Try Google Chrome, Safari, Opera or Firefox!")}var d=this;c.prototype={hc:function(){var b=this;b.Ia("Downloading...");a.ajax({url:escape(b.Rc.val()),xhr:function(){var c=a.ajaxSettings.xhr();void 0!==
c.overrideMimeType&&c.overrideMimeType("text/plain; charset=x-user-defined");return b.xhr=c},complete:function(a){/msie/i.test(navigator.userAgent)&&!/opera/i.test(navigator.userAgent)?(a=JSNESBinaryToArray(a.responseBody).toArray(),a=String.fromCharCode.apply(void 0,a)):a=a.responseText;b.a.zd(a);b.a.start();b.enable()}})},dg:function(){this.wc.fillStyle="black";this.wc.fillRect(0,0,256,240);for(var a=3;a<this.hd.data.length-3;a+=4)this.hd.data[a]=255},enable:function(){this.buttons.pause.attr("disabled",
null);this.a.tb?this.buttons.pause.attr("value","pause"):this.buttons.pause.attr("value","resume");this.buttons.Ue.attr("disabled",null);this.a.N.emulateSound?this.buttons.Wc.attr("value","disable sound"):this.buttons.Wc.attr("value","enable sound")},Ia:function(a){this.status.text(a)},gg:function(b){this.Rc.children().remove();a("<option>Select a ROM...</option>").appendTo(this.Rc);for(var c in b)if(b.hasOwnProperty(c)){for(var d=a("<optgroup></optgroup>").attr("label",c),k=0;k<b[c].length;k++)a("<option>"+
b[c][k][0]+"</option>").attr("value",b[c][k][1]).appendTo(d);this.Rc.append(d)}},df:function(a){return this.bg.writeInt(a)},ef:function(a,b){var c=this.hd.data,d,m,p;for(m=0;61440>m;m++)d=a[m],d!=b[m]&&(p=4*m,c[p]=d&255,c[p+1]=d>>8&255,c[p+2]=d>>16&255,b[m]=d);this.wc.putImageData(this.hd,0,0)}};return c}}(jQuery);window.$=$;$.fn.JSNESUI=$.fn.Zf;window.JSNES=h;h.prototype.loadRom=h.prototype.zd;h.prototype.start=h.prototype.start;h.prototype.frame=h.prototype.frame;h.prototype.reloadRom=h.prototype.Se;h.prototype.stop=h.prototype.stop;h.prototype.toJSON=h.prototype.toJSON;h.prototype.fromJSON=h.prototype.R;h.CPU=l;h.CPU.prototype.toJSON=l.prototype.toJSON;h.CPU.prototype.fromJSON=l.prototype.R;h.PPU=n;h.PPU.prototype.toJSON=n.prototype.toJSON;h.PPU.prototype.fromJSON=n.prototype.R;h.Keyboard=r;
h.Keyboard.prototype.keyDown=r.prototype.Ke;h.Keyboard.prototype.keyUp=r.prototype.Me;h.Keyboard.prototype.keyPress=r.prototype.Le;h.prototype.isRunning=h.prototype.tb;h.prototype.fpsFrameCount=h.prototype.Cc;h.prototype.limitFrames=h.prototype.lg;h.prototype.romData=h.prototype.Qc;h.prototype.reset=h.prototype.reset;h.prototype.printFps=h.prototype.je;h.prototype.resetFps=h.prototype.Te;h.prototype.setFramerate=h.prototype.fg;h.prototype.setLimitFrames=h.prototype.ng;
