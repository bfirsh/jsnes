/*
JSNES, based on Jamie Sanders' vNES
Copyright (C) 2010 Ben Firshman

This program is free software: you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License
along with this program.  If not, see <http://www.gnu.org/licenses/>.
*/
'use strict';function h(a){this.P={ui:h.Ff,swfPath:"lib/",preferredFrameRate:60,fpsInterval:500,showDisplay:!0,emulateSound:!1,sampleRate:44100,CPU_FREQ_NTSC:1789772.5,CPU_FREQ_PAL:1773447.4};if("undefined"!=typeof a)for(var b in this.P)"undefined"!=typeof a[b]&&(this.P[b]=a[b]);this.Mc=1E3/this.P.preferredFrameRate;this.ui=new this.P.ui(this);this.g=new h.lb(this);this.n=new h.Y(this);this.G=new h.X(this);this.k=null;this.Qc=new h.ec;this.ui.Ma("Ready to load a ROM.")}h.VERSION="ff7d96c5ca8e6e3c74d4";
h.prototype={yb:!1,Jc:0,Xc:null,reset:function(){null!==this.k&&this.k.reset();this.g.reset();this.n.reset();this.G.reset()},start:function(){var a=this;null!==this.b&&this.b.valid?this.yb||(this.yb=!0,requestAnimationFrame(function(){a.frame()}),this.jf(),this.se(),this.fpsInterval=setInterval(function(){a.se()},this.P.fpsInterval)):this.ui.Ma("There is no ROM loaded, or it is invalid.")},frame:function(){aa(this.n);var a=this,b=0,c=this.P.emulateSound,d=this.g,e=this.n,f=this.G;a:for(;;)for(0===
d.ma?(b=ba(d),c&&k(f,b),b*=3):8<d.ma?(b=24,c&&k(f,8),d.ma-=8):(b=3*d.ma,c&&k(f,d.ma),d.ma=0);0<b;b--){e.Rb===e.Ia&&1===e.xa&&e.L-21===e.Ja&&q(e,e.Ve,!0);if(e.Wc&&(e.Rc--,0===e.Rc)){e.Wc=!1;ca(e);break a}e.Rb++;341===e.Rb&&(e.Rb=0,da(e))}this.Jc++;this.yb&&requestAnimationFrame(function(){a.frame()})},se:function(){var a=+new Date,b="Running";this.oe&&(b+=": "+(this.Jc/((a-this.oe)/1E3)).toFixed(2)+" FPS");this.ui.Ma(b);this.Jc=0;this.oe=a},stop:function(){clearInterval(this.fpsInterval);this.yb=!1},
hf:function(){null!==this.Xc&&this.Gd(this.Xc)},Gd:function(a){this.yb&&this.stop();this.ui.Ma("Loading ROM...");this.b=new h.Te(this);this.b.load(a);if(this.b.valid){this.reset();var b;b=this.b;"undefined"!==typeof h.m[b.Ra]?b=new h.m[b.Ra](b.a):(b.a.ui.Ma("This ROM uses a mapper not supported by JSNES: "+(0<=b.Ra&&b.Ra<b.h.length?b.h[b.Ra]:"Unknown Mapper, "+b.Ra)+"("+b.Ra+")"),b=null);this.k=b;if(!this.k)return;this.k.oc();b=this.b;s(this.n,b.Ze?b.Gf:0===b.fb?b.hd:b.nd);this.Xc=a;this.ui.Ma("Successfully loaded. Ready to be started.")}else this.ui.Ma("Invalid ROM!");
return this.b.valid},jf:function(){this.oe=null;this.Jc=0},xg:function(a){this.P.preferredFrameRate=a;this.Mc=1E3/a;this.G.Hg(this.P.sampleRate,!1)},toJSON:function(){return{romData:this.Xc,cpu:this.g.toJSON(),mmap:this.k.toJSON(),ppu:this.n.toJSON()}},F:function(a){this.Gd(a.romData);this.g.F(a.cpu);this.k.F(a.mmap);this.n.F(a.ppu)}};h.sa={Pb:function(a,b,c,d,e){for(var f=0;f<e;++f)c[d+f]=a[b+f]},Bg:function(a){for(var b=Array(a.length),c=0;c<a.length;c++)b[c]=a[c];return b},F:function(a,b){for(var c in a.Ob)a.Ob.hasOwnProperty(c)&&(a[c]=b[a.Ob[c]])},toJSON:function(a){var b={},c;for(c in a.Ob)a.Ob.hasOwnProperty(c)&&(b[a.Ob[c]]=a[c]);return b},tg:function(){return/msie/i.test(navigator.userAgent)&&!/opera/i.test(navigator.userAgent)}};h.lb=function(a){this.a=a;this.Bd=this.mc=this.ma=this.pc=this.gd=this.Da=this.Je=this.Pa=this.f=this.e=this.ja=this.wc=this.ia=this.Oa=this.p=this.Se=this.V=this.i=this.Z=this.v=this.r=this.c=this.o=null;this.reset()};
h.lb.prototype={ld:0,og:1,md:2,reset:function(){this.o=new Uint8Array(65536);for(var a=0;8192>a;a++)this.o[a]=255;for(var b=0;4>b;b++)a=2048*b,this.o[a+8]=247,this.o[a+9]=239,this.o[a+10]=223,this.o[a+15]=191;for(a=8193;a<this.o.length;a++)this.o[a]=0;this.v=this.r=this.c=0;this.Z=511;this.V=this.i=32767;this.Se=40;this.ia=this.f=this.p=0;this.Oa=1;this.Da=0;this.Pa=1;this.Oa=this.p=this.e=this.ja=0;this.wc=this.ia=1;this.e=this.ja=0;this.gd=this.Da=this.Je=this.Pa=this.f=1;this.pc=(new h.lb.Qe).pc;
this.ma=0;this.mc=!1;this.Bd=null},load:function(a){return 8192>a?this.o[a&2047]:this.a.k.load(a)},write:function(a,b){8192>a?this.o[a&2047]=b:this.a.k.write(a,b)},push:function(a){this.a.k.write(this.Z,a);this.Z--;this.Z=256|this.Z&255},Ob:{o:"mem",ma:"cyclesToHalt",mc:"irqRequested",Bd:"irqType",c:"REG_ACC",r:"REG_X",v:"REG_Y",Z:"REG_SP",i:"REG_PC",V:"REG_PC_NEW",Se:"REG_STATUS",p:"F_CARRY",Oa:"F_DECIMAL",ia:"F_INTERRUPT",wc:"F_INTERRUPT_NEW",ja:"F_OVERFLOW",e:"F_SIGN",f:"F_ZERO",Pa:"F_NOTUSED",
Je:"F_NOTUSED_NEW",Da:"F_BRK",gd:"F_BRK_NEW"},toJSON:function(){return h.sa.toJSON(this)},F:function(a){h.sa.F(this,a)}};function u(a){a.Z++;a.Z=256|a.Z&255;return a.a.k.load(a.Z)}function w(a,b){a.mc&&b==a.ld||(a.mc=!0,a.Bd=b)}function x(a,b){return 8191>b?a.o[b&2047]|a.o[b+1&2047]<<8:a.a.k.load(b)|a.a.k.load(b+1)<<8}
function ba(a){var b,c;if(a.mc){b=a.p|(0===a.f?1:0)<<1|a.ia<<2|a.Oa<<3|a.Da<<4|a.Pa<<5|a.ja<<6|a.e<<7;a.V=a.i;a.wc=a.ia;switch(a.Bd){case 0:if(0!=a.ia)break;var d=b;a.V++;a.push(a.V>>8&255);a.push(a.V&255);a.push(d);a.wc=1;a.gd=0;a.V=a.a.k.load(65534)|a.a.k.load(65535)<<8;a.V--;break;case 1:d=b;0!=(a.a.k.load(8192)&128)&&(a.V++,a.push(a.V>>8&255),a.push(a.V&255),a.push(d),a.V=a.a.k.load(65530)|a.a.k.load(65531)<<8,a.V--);break;case 2:a.V=a.a.k.load(65532)|a.a.k.load(65533)<<8,a.V--}a.i=a.V;a.ia=a.wc;
a.Da=a.gd;a.mc=!1}b=a.pc[a.a.k.load(a.i+1)];d=b>>24;c=0;var e=b>>8&255,f=a.i;a.i+=b>>16&255;var g=0;switch(e){case 0:g=a.load(f+2);break;case 1:g=a.load(f+2);g=128>g?g+a.i:g+(a.i-256);break;case 3:g=x(a,f+2);break;case 4:g=a.c;break;case 5:g=a.i;break;case 6:g=a.load(f+2)+a.r&255;break;case 7:g=a.load(f+2)+a.v&255;break;case 8:g=x(a,f+2);(g&65280)!=(g+a.r&65280)&&(c=1);g+=a.r;break;case 9:g=x(a,f+2);(g&65280)!=(g+a.v&65280)&&(c=1);g+=a.v;break;case 10:g=a.load(f+2);(g&65280)!=(g+a.r&65280)&&(c=1);
g+=a.r;g=x(a,g&255);break;case 11:g=x(a,a.load(f+2));(g&65280)!=(g+a.v&65280)&&(c=1);g+=a.v;break;case 12:g=x(a,f+2),g=8191>g?a.o[g]+(a.o[g&65280|(g&255)+1&255]<<8):a.a.k.load(g)+(a.a.k.load(g&65280|(g&255)+1&255)<<8)}g&=65535;switch(b&255){case 0:b=a.c+a.load(g)+a.p;a.ja=0==((a.c^a.load(g))&128)&&0!=((a.c^b)&128)?1:0;a.p=255<b?1:0;a.e=b>>7&1;a.f=b&255;a.c=b&255;d+=c;break;case 1:a.c&=a.load(g);a.e=a.c>>7&1;a.f=a.c;11!=e&&(d+=c);break;case 2:4==e?(a.p=a.c>>7&1,a.c=a.c<<1&255,a.e=a.c>>7&1,a.f=a.c):
(b=a.load(g),a.p=b>>7&1,b=b<<1&255,a.e=b>>7&1,a.f=b,a.write(g,b));break;case 3:0==a.p&&(d+=(f&65280)!=(g&65280)?2:1,a.i=g);break;case 4:1==a.p&&(d+=(f&65280)!=(g&65280)?2:1,a.i=g);break;case 5:0==a.f&&(d+=(f&65280)!=(g&65280)?2:1,a.i=g);break;case 6:b=a.load(g);a.e=b>>7&1;a.ja=b>>6&1;b&=a.c;a.f=b;break;case 7:1==a.e&&(d++,a.i=g);break;case 8:0!=a.f&&(d+=(f&65280)!=(g&65280)?2:1,a.i=g);break;case 9:0==a.e&&(d+=(f&65280)!=(g&65280)?2:1,a.i=g);break;case 10:a.i+=2;a.push(a.i>>8&255);a.push(a.i&255);
a.Da=1;a.push(a.p|(0==a.f?1:0)<<1|a.ia<<2|a.Oa<<3|a.Da<<4|a.Pa<<5|a.ja<<6|a.e<<7);a.ia=1;a.i=x(a,65534);a.i--;break;case 11:0==a.ja&&(d+=(f&65280)!=(g&65280)?2:1,a.i=g);break;case 12:1==a.ja&&(d+=(f&65280)!=(g&65280)?2:1,a.i=g);break;case 13:a.p=0;break;case 14:a.Oa=0;break;case 15:a.ia=0;break;case 16:a.ja=0;break;case 17:b=a.c-a.load(g);a.p=0<=b?1:0;a.e=b>>7&1;a.f=b&255;d+=c;break;case 18:b=a.r-a.load(g);a.p=0<=b?1:0;a.e=b>>7&1;a.f=b&255;break;case 19:b=a.v-a.load(g);a.p=0<=b?1:0;a.e=b>>7&1;a.f=
b&255;break;case 20:b=a.load(g)-1&255;a.e=b>>7&1;a.f=b;a.write(g,b);break;case 21:a.r=a.r-1&255;a.e=a.r>>7&1;a.f=a.r;break;case 22:a.v=a.v-1&255;a.e=a.v>>7&1;a.f=a.v;break;case 23:a.c=(a.load(g)^a.c)&255;a.e=a.c>>7&1;a.f=a.c;d+=c;break;case 24:b=a.load(g)+1&255;a.e=b>>7&1;a.f=b;a.write(g,b&255);break;case 25:a.r=a.r+1&255;a.e=a.r>>7&1;a.f=a.r;break;case 26:a.v++;a.v&=255;a.e=a.v>>7&1;a.f=a.v;break;case 27:a.i=g-1;break;case 28:a.push(a.i>>8&255);a.push(a.i&255);a.i=g-1;break;case 29:a.c=a.load(g);
a.e=a.c>>7&1;a.f=a.c;d+=c;break;case 30:a.r=a.load(g);a.e=a.r>>7&1;a.f=a.r;d+=c;break;case 31:a.v=a.load(g);a.e=a.v>>7&1;a.f=a.v;d+=c;break;case 32:4==e?(b=a.c&255,a.p=b&1,b>>=1,a.c=b):(b=a.load(g)&255,a.p=b&1,b>>=1,a.write(g,b));a.e=0;a.f=b;break;case 33:break;case 34:b=(a.load(g)|a.c)&255;a.e=b>>7&1;a.f=b;a.c=b;11!=e&&(d+=c);break;case 35:a.push(a.c);break;case 36:a.Da=1;a.push(a.p|(0==a.f?1:0)<<1|a.ia<<2|a.Oa<<3|a.Da<<4|a.Pa<<5|a.ja<<6|a.e<<7);break;case 37:a.c=u(a);a.e=a.c>>7&1;a.f=a.c;break;
case 38:b=u(a);a.p=b&1;a.f=1==(b>>1&1)?0:1;a.ia=b>>2&1;a.Oa=b>>3&1;a.Da=b>>4&1;a.Pa=b>>5&1;a.ja=b>>6&1;a.e=b>>7&1;a.Pa=1;break;case 39:4==e?(b=a.c,c=a.p,a.p=b>>7&1,b=(b<<1&255)+c,a.c=b):(b=a.load(g),c=a.p,a.p=b>>7&1,b=(b<<1&255)+c,a.write(g,b));a.e=b>>7&1;a.f=b;break;case 40:4==e?(c=a.p<<7,a.p=a.c&1,b=(a.c>>1)+c,a.c=b):(b=a.load(g),c=a.p<<7,a.p=b&1,b=(b>>1)+c,a.write(g,b));a.e=b>>7&1;a.f=b;break;case 41:b=u(a);a.p=b&1;a.f=0==(b>>1&1)?1:0;a.ia=b>>2&1;a.Oa=b>>3&1;a.Da=b>>4&1;a.Pa=b>>5&1;a.ja=b>>6&1;
a.e=b>>7&1;a.i=u(a);a.i+=u(a)<<8;if(65535==a.i)return;a.i--;a.Pa=1;break;case 42:a.i=u(a);a.i+=u(a)<<8;if(65535==a.i)return;break;case 43:b=a.c-a.load(g)-(1-a.p);a.e=b>>7&1;a.f=b&255;a.ja=0!=((a.c^b)&128)&&0!=((a.c^a.load(g))&128)?1:0;a.p=0>b?0:1;a.c=b&255;11!=e&&(d+=c);break;case 44:a.p=1;break;case 45:a.Oa=1;break;case 46:a.ia=1;break;case 47:a.write(g,a.c);break;case 48:a.write(g,a.r);break;case 49:a.write(g,a.v);break;case 50:a.r=a.c;a.e=a.c>>7&1;a.f=a.c;break;case 51:a.v=a.c;a.e=a.c>>7&1;a.f=
a.c;break;case 52:a.r=a.Z-256;a.e=a.Z>>7&1;a.f=a.r;break;case 53:a.c=a.r;a.e=a.r>>7&1;a.f=a.r;break;case 54:a.Z=a.r+256;a.Z=256|a.Z&255;break;case 55:a.c=a.v;a.e=a.v>>7&1;a.f=a.v;break;default:a.a.stop(),a.a.Cg="Game crashed, invalid opcode at address $"+f.toString(16)}return d}
h.lb.Qe=function(){this.pc=new Uint32Array(255);for(var a=0;255>a;a++)this.pc[a]=255;y(this,this.mb,105,this.Ca,2,2);y(this,this.mb,101,this.C,2,3);y(this,this.mb,117,this.U,2,4);y(this,this.mb,109,this.w,3,4);y(this,this.mb,125,this.W,3,4);y(this,this.mb,121,this.Za,3,4);y(this,this.mb,97,this.jb,2,6);y(this,this.mb,113,this.ib,2,5);y(this,this.nb,41,this.Ca,2,2);y(this,this.nb,37,this.C,2,3);y(this,this.nb,53,this.U,2,4);y(this,this.nb,45,this.w,3,4);y(this,this.nb,61,this.W,3,4);y(this,this.nb,
57,this.Za,3,4);y(this,this.nb,33,this.jb,2,6);y(this,this.nb,49,this.ib,2,5);y(this,this.xc,10,this.fd,1,2);y(this,this.xc,6,this.C,2,5);y(this,this.xc,22,this.U,2,6);y(this,this.xc,14,this.w,3,6);y(this,this.xc,30,this.W,3,7);y(this,this.Hf,144,this.kb,2,2);y(this,this.If,176,this.kb,2,2);y(this,this.Jf,240,this.kb,2,2);y(this,this.Ke,36,this.C,2,3);y(this,this.Ke,44,this.w,3,4);y(this,this.Kf,48,this.kb,2,2);y(this,this.Lf,208,this.kb,2,2);y(this,this.Mf,16,this.kb,2,2);y(this,this.Nf,0,this.u,
1,7);y(this,this.Of,80,this.kb,2,2);y(this,this.Pf,112,this.kb,2,2);y(this,this.Qf,24,this.u,1,2);y(this,this.Rf,216,this.u,1,2);y(this,this.Sf,88,this.u,1,2);y(this,this.Tf,184,this.u,1,2);y(this,this.ob,201,this.Ca,2,2);y(this,this.ob,197,this.C,2,3);y(this,this.ob,213,this.U,2,4);y(this,this.ob,205,this.w,3,4);y(this,this.ob,221,this.W,3,4);y(this,this.ob,217,this.Za,3,4);y(this,this.ob,193,this.jb,2,6);y(this,this.ob,209,this.ib,2,5);y(this,this.Xd,224,this.Ca,2,2);y(this,this.Xd,228,this.C,2,
3);y(this,this.Xd,236,this.w,3,4);y(this,this.Yd,192,this.Ca,2,2);y(this,this.Yd,196,this.C,2,3);y(this,this.Yd,204,this.w,3,4);y(this,this.jd,198,this.C,2,5);y(this,this.jd,214,this.U,2,6);y(this,this.jd,206,this.w,3,6);y(this,this.jd,222,this.W,3,7);y(this,this.Uf,202,this.u,1,2);y(this,this.Vf,136,this.u,1,2);y(this,this.pb,73,this.Ca,2,2);y(this,this.pb,69,this.C,2,3);y(this,this.pb,85,this.U,2,4);y(this,this.pb,77,this.w,3,4);y(this,this.pb,93,this.W,3,4);y(this,this.pb,89,this.Za,3,4);y(this,
this.pb,65,this.jb,2,6);y(this,this.pb,81,this.ib,2,5);y(this,this.kd,230,this.C,2,5);y(this,this.kd,246,this.U,2,6);y(this,this.kd,238,this.w,3,6);y(this,this.kd,254,this.W,3,7);y(this,this.Wf,232,this.u,1,2);y(this,this.Xf,200,this.u,1,2);y(this,this.Le,76,this.w,3,3);y(this,this.Le,108,this.wf,3,5);y(this,this.Yf,32,this.w,3,6);y(this,this.qb,169,this.Ca,2,2);y(this,this.qb,165,this.C,2,3);y(this,this.qb,181,this.U,2,4);y(this,this.qb,173,this.w,3,4);y(this,this.qb,189,this.W,3,4);y(this,this.qb,
185,this.Za,3,4);y(this,this.qb,161,this.jb,2,6);y(this,this.qb,177,this.ib,2,5);y(this,this.yc,162,this.Ca,2,2);y(this,this.yc,166,this.C,2,3);y(this,this.yc,182,this.Fe,2,4);y(this,this.yc,174,this.w,3,4);y(this,this.yc,190,this.Za,3,4);y(this,this.zc,160,this.Ca,2,2);y(this,this.zc,164,this.C,2,3);y(this,this.zc,180,this.U,2,4);y(this,this.zc,172,this.w,3,4);y(this,this.zc,188,this.W,3,4);y(this,this.Ac,74,this.fd,1,2);y(this,this.Ac,70,this.C,2,5);y(this,this.Ac,86,this.U,2,6);y(this,this.Ac,
78,this.w,3,6);y(this,this.Ac,94,this.W,3,7);y(this,this.Zf,234,this.u,1,2);y(this,this.rb,9,this.Ca,2,2);y(this,this.rb,5,this.C,2,3);y(this,this.rb,21,this.U,2,4);y(this,this.rb,13,this.w,3,4);y(this,this.rb,29,this.W,3,4);y(this,this.rb,25,this.Za,3,4);y(this,this.rb,1,this.jb,2,6);y(this,this.rb,17,this.ib,2,5);y(this,this.$f,72,this.u,1,3);y(this,this.ag,8,this.u,1,3);y(this,this.bg,104,this.u,1,4);y(this,this.cg,40,this.u,1,4);y(this,this.Bc,42,this.fd,1,2);y(this,this.Bc,38,this.C,2,5);y(this,
this.Bc,54,this.U,2,6);y(this,this.Bc,46,this.w,3,6);y(this,this.Bc,62,this.W,3,7);y(this,this.Cc,106,this.fd,1,2);y(this,this.Cc,102,this.C,2,5);y(this,this.Cc,118,this.U,2,6);y(this,this.Cc,110,this.w,3,6);y(this,this.Cc,126,this.W,3,7);y(this,this.dg,64,this.u,1,6);y(this,this.eg,96,this.u,1,6);y(this,this.sb,233,this.Ca,2,2);y(this,this.sb,229,this.C,2,3);y(this,this.sb,245,this.U,2,4);y(this,this.sb,237,this.w,3,4);y(this,this.sb,253,this.W,3,4);y(this,this.sb,249,this.Za,3,4);y(this,this.sb,
225,this.jb,2,6);y(this,this.sb,241,this.ib,2,5);y(this,this.fg,56,this.u,1,2);y(this,this.gg,248,this.u,1,2);y(this,this.hg,120,this.u,1,2);y(this,this.Nb,133,this.C,2,3);y(this,this.Nb,149,this.U,2,4);y(this,this.Nb,141,this.w,3,4);y(this,this.Nb,157,this.W,3,5);y(this,this.Nb,153,this.Za,3,5);y(this,this.Nb,129,this.jb,2,6);y(this,this.Nb,145,this.ib,2,6);y(this,this.Zd,134,this.C,2,3);y(this,this.Zd,150,this.Fe,2,4);y(this,this.Zd,142,this.w,3,4);y(this,this.$d,132,this.C,2,3);y(this,this.$d,
148,this.U,2,4);y(this,this.$d,140,this.w,3,4);y(this,this.ig,170,this.u,1,2);y(this,this.jg,168,this.u,1,2);y(this,this.kg,186,this.u,1,2);y(this,this.lg,138,this.u,1,2);y(this,this.mg,154,this.u,1,2);y(this,this.ng,152,this.u,1,2);new Uint8Array([7,6,2,8,3,3,5,5,3,2,2,2,4,4,6,6,2,5,2,8,4,4,6,6,2,4,2,7,4,4,7,7,6,6,2,8,3,3,5,5,4,2,2,2,4,4,6,6,2,5,2,8,4,4,6,6,2,4,2,7,4,4,7,7,6,6,2,8,3,3,5,5,3,2,2,2,3,4,6,6,2,5,2,8,4,4,6,6,2,4,2,7,4,4,7,7,6,6,2,8,3,3,5,5,4,2,2,2,5,4,6,6,2,5,2,8,4,4,6,6,2,4,2,7,4,4,
7,7,2,6,2,6,3,3,3,3,2,2,2,2,4,4,4,4,2,6,2,6,4,4,4,4,2,5,2,5,5,5,5,5,2,6,2,6,3,3,3,3,2,2,2,2,4,4,4,4,2,5,2,5,4,4,4,4,2,4,2,4,4,4,4,4,2,6,2,8,3,3,5,5,2,2,2,2,4,4,6,6,2,5,2,8,4,4,6,6,2,4,2,7,4,4,7,7,2,6,3,8,3,3,5,5,2,2,2,2,4,4,6,6,2,5,2,8,4,4,6,6,2,4,2,7,4,4,7,7])};
h.lb.Qe.prototype={mb:0,nb:1,xc:2,Hf:3,If:4,Jf:5,Ke:6,Kf:7,Lf:8,Mf:9,Nf:10,Of:11,Pf:12,Qf:13,Rf:14,Sf:15,Tf:16,ob:17,Xd:18,Yd:19,jd:20,Uf:21,Vf:22,pb:23,kd:24,Wf:25,Xf:26,Le:27,Yf:28,qb:29,yc:30,zc:31,Ac:32,Zf:33,rb:34,$f:35,ag:36,bg:37,cg:38,Bc:39,Cc:40,dg:41,eg:42,sb:43,fg:44,gg:45,hg:46,Nb:47,Zd:48,$d:49,ig:50,jg:51,kg:52,lg:53,mg:54,ng:55,C:0,kb:1,u:2,w:3,fd:4,Ca:5,U:6,Fe:7,W:8,Za:9,jb:10,ib:11,wf:12};function y(a,b,c,d,e,f){a.pc[c]=b&255|(d&255)<<8|(e&255)<<16|(f&255)<<24};h.ec=function(){var a=0;this.La=new Uint8Array(8);for(a=0;8>a;a++)this.La[a]=64;this.Va=new Uint8Array(8);for(a=0;8>a;a++)this.Va[a]=64};h.ec.prototype={$e:function(a){!z(this,a.keyCode,65)&&a.preventDefault&&a.preventDefault()},bf:function(a){!z(this,a.keyCode,64)&&a.preventDefault&&a.preventDefault()},af:function(a){a.preventDefault()}};
function z(a,b,c){switch(b){case 88:a.La[0]=c;break;case 89:a.La[1]=c;break;case 90:a.La[1]=c;break;case 17:a.La[2]=c;break;case 13:a.La[3]=c;break;case 38:a.La[4]=c;break;case 40:a.La[5]=c;break;case 37:a.La[6]=c;break;case 39:a.La[7]=c;break;case 103:a.Va[0]=c;break;case 105:a.Va[1]=c;break;case 99:a.Va[2]=c;break;case 97:a.Va[3]=c;break;case 104:a.Va[4]=c;break;case 98:a.Va[5]=c;break;case 100:a.Va[6]=c;break;case 102:a.Va[7]=c;break;default:return!0}return!1};h.m={};h.m[0]=function(a){this.a=a};
h.m[0].prototype={reset:function(){this.Cd=this.Ab=this.zb=0;this.Hd=!1;this.Jd=this.Id=null},write:function(a,b){8192>a?this.a.g.o[a&2047]=b:16407<a?this.a.g.o[a]=b:8199<a&&16384>a?A(this,8192+(a&7),b):A(this,a,b)},Ig:function(a,b){8192>a?this.a.g.o[a&2047]=b:16407<a?this.a.g.o[a]=b:8199<a&&16384>a?A(this,8192+(a&7),b):A(this,a,b)},load:function(a){a&=65535;return 16407<a?this.a.g.o[a]:8192<=a?ea(this,a):this.a.g.o[a&2047]},oc:function(){!this.a.b.valid||1>this.a.b.K?alert("NoMapper: Invalid ROM! Unable to load."):
(1<this.a.b.K?(C(this,0,32768),C(this,1,49152)):(C(this,0,32768),C(this,0,49152)),D(this),G(this),w(this.a.g,this.a.g.md))},Fg:function(a,b){if(0!==this.a.b.B){H(this.a.n);var c=Math.floor(a/2)%this.a.b.B;h.sa.Pb(this.a.b.Ya[c],a%2*2048,this.a.n.Q,b,2048);for(var c=this.a.b.Mb[c],d=b>>4,e=0;128>e;e++)this.a.n.J[d+e]=c[(a%2<<7)+e]}},fe:function(){},Dg:function(){},toJSON:function(){return{joy1StrobeState:this.zb,joy2StrobeState:this.Ab,joypadLastWrite:this.Cd}},F:function(a){this.zb=a.joy1StrobeState;
this.Ab=a.joy2StrobeState;this.Cd=a.joypadLastWrite}};function I(a,b,c){h.sa.Pb(a.a.b.b[Math.floor(b/2)%a.a.b.K],b%2*8192,a.a.g.o,c,8192)}function J(a,b,c){if(0!==a.a.b.B){H(a.a.n);var d=Math.floor(b/4)%a.a.b.B;h.sa.Pb(a.a.b.Ya[d],0,a.a.n.Q,b%4*1024,1024);d=a.a.b.Mb[d];c>>=4;for(var e=0;64>e;e++)a.a.n.J[c+e]=d[(b%4<<6)+e]}}function K(a,b){0!==a.a.b.B&&(H(a.a.n),L(a,b%a.a.b.B,0),L(a,(b+1)%a.a.b.B,4096))}
function L(a,b,c){0!==a.a.b.B&&(H(a.a.n),h.sa.Pb(a.a.b.Ya[b%a.a.b.B],0,a.a.n.Q,c,4096),h.sa.Pb(a.a.b.Mb[b%a.a.b.B],0,a.a.n.J,c>>4,256))}function C(a,b,c){b%=a.a.b.K;h.sa.Pb(a.a.b.b[b],0,a.a.g.o,c,16384)}function G(a){if(a.a.b.ce){var b=a.a.b.ce;null!==b&&8192==b.length&&h.sa.Pb(b,0,a.a.g.o,24576,8192)}}function D(a){0<a.a.b.B&&(1==a.a.b.B?(L(a,0,0),L(a,0,4096)):(L(a,0,0),L(a,1,4096)))}
function M(a){var b;switch(a.Ab){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:b=a.a.Qc.Va[a.Ab];break;case 8:case 9:case 10:case 11:case 12:case 13:case 14:case 15:case 16:case 17:case 18:b=0;break;case 19:b=1;break;default:b=0}a.Ab++;24==a.Ab&&(a.Ab=0);return b}
function A(a,b,c){switch(b){case 8192:a.a.g.o[b]=c;fa(a.a.n,c);break;case 8193:a.a.g.o[b]=c;ga(a.a.n,c);break;case 8195:a.a.n.Ua=c;break;case 8196:a=a.a.n;a.hb[a.Ua]=c;N(a,a.Ua,c);a.Ua++;a.Ua%=256;break;case 8197:a=a.a.n;H(a);a.cb?(a.Ta=c>>3&31,a.Vc=c&7):(a.Db=c&7,a.ea=c>>3&31);a.cb=!a.cb;break;case 8198:a=a.a.n;a.cb?(a.Db=c>>4&3,a.Eb=c>>3&1,a.Sa=c>>2&1,a.ea=a.ea&7|(c&3)<<3):(H(a),a.ea=a.ea&24|c>>5&7,a.Ta=c&31,a.ta=a.Db,a.ba=a.Eb,a.aa=a.Sa,a.S=a.ea,a.va=a.Ta,O(a,a.L-20));a.cb=!a.cb;P(a);break;case 8199:a=
a.a.n;H(a);P(a);Q(a);8192<=a.T?(b=a.T,16128<=b&&16160>b?16128==b||16144==b?(S(a,16128,c),S(a,16144,c)):16132==b||16148==b?(S(a,16132,c),S(a,16148,c)):16136==b||16152==b?(S(a,16136,c),S(a,16152,c)):16140==b||16156==b?(S(a,16140,c),S(a,16156,c)):S(a,b,c):b<a.Na.length?S(a,a.Na[b],c):alert("Invalid VRAM address: "+b.toString(16))):S(a,a.T,c);a.T+=1==a.Gc?32:1;ha(a);ia(a);break;case 16404:a=a.a.n;c*=256;for(var d=a.Ua;256>d;d++)b=a.a.g.o[c+d],a.hb[d]=b,N(a,d,b);c=a.a.g;c.ma+=513;break;case 16405:a.a.G.R(b,
c);break;case 16406:0===(c&1)&&1===(a.Cd&1)&&(a.zb=0,a.Ab=0);a.Cd=c;break;case 16407:a.a.G.R(b,c);break;default:16384<=b&&16407>=b&&a.a.G.R(b,c)}}
function ea(a,b){switch(b>>12){case 2:case 3:switch(b&7){case 0:return a.a.g.o[8192];case 1:return a.a.g.o[8193];case 2:var c=a.a.n,d=c.a.g.o[8194];c.cb=!0;q(c,c.ae,!1);return d;case 3:return 0;case 4:return c=a.a.n,c.hb[c.Ua];case 5:return 0;case 6:return 0;case 7:return c=a.a.n,P(c),Q(c),16127>=c.T?(d=c.Vd,c.Vd=8192>c.T?c.Q[c.T]:c.Q[c.Na[c.T]]):d=c.Q[c.Na[c.T]],c.T+=1==c.Gc?32:1,ia(c),ha(c),d}break;case 4:switch(b-16405){case 0:return a.a.G.gf(b);case 1:switch(a.zb){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:c=
a.a.Qc.La[a.zb];break;case 8:case 9:case 10:case 11:case 12:case 13:case 14:case 15:case 16:case 17:case 18:c=0;break;case 19:c=1;break;default:c=0}a.zb++;24==a.zb&&(a.zb=0);return c;case 2:if(a.Hd){for(var c=Math.max(0,a.Id-4),d=Math.min(256,a.Id+4),e=Math.max(0,a.Jd-4),f=Math.min(240,a.Jd+4),g=0;e<f;e++)for(var l=c;l<d;l++)if(16777215==a.a.n.buffer[(e<<8)+l]){g|=8;console.debug("Clicked on white!");break}g|=a.Hd?16:0;return(M(a)|g)&65535}return M(a)}}return 0}h.m[1]=function(a){this.a=a};
h.m[1].prototype=new h.m[0];h.m[1].prototype.reset=function(){h.m[0].prototype.reset.apply(this);this.df=this.fb=this.Cb=this.ac=0;this.Uc=this.Tc=1;this.lf=this.Zc=this.Fb=this.vc=0};
h.m[1].prototype.write=function(a,b){if(32768>a)h.m[0].prototype.write.apply(this,arguments);else if(0!==(b&128))this.ac=this.Cb=0,0===ja(a)&&(this.Uc=this.Tc=1);else if(this.ac=this.ac&255-(1<<this.Cb)|(b&1)<<this.Cb,this.Cb++,5==this.Cb){var c=this.ac,d;switch(ja(a)){case 0:d=c&3;d!==this.fb&&(this.fb=d,0===(this.fb&2)?s(this.a.n,this.a.b.Ue):0!==(this.fb&1)?s(this.a.n,this.a.b.hd):s(this.a.n,this.a.b.nd));this.Tc=c>>2&1;this.Uc=c>>3&1;this.vc=c>>4&1;break;case 1:this.Fb=c>>4&1;0<this.a.b.B&&(0===
this.vc?0===this.Fb?K(this,c&15):K(this,Math.floor(this.a.b.B/2)+(c&15)):0===this.Fb?L(this,c&15,0):L(this,Math.floor(this.a.b.B/2)+(c&15),0));break;case 2:this.Zc=c>>4&1;0<this.a.b.B&&1===this.vc&&(0===this.Zc?L(this,c&15,4096):L(this,Math.floor(this.a.b.B/2)+(c&15),4096));break;default:d=0,32<=this.a.b.K?0===this.vc?1===this.Fb&&(d=16):d=(this.Fb|this.Zc<<1)<<3:16<=this.a.b.K&&1===this.Fb&&(d=8),0===this.Uc?(c=d+(c&15),C(this,2*c%this.a.b.K,32768),C(this,(2*c+1)%this.a.b.K,49152)):(c=2*d+(c&15),
0===this.Tc?C(this,c,49152):C(this,c,32768))}this.Cb=this.ac=0}};function ja(a){return 32768<=a&&40959>=a?0:40960<=a&&49151>=a?1:49152<=a&&57343>=a?2:3}h.m[1].prototype.oc=function(){this.a.b.valid?(C(this,0,32768),C(this,this.a.b.K-1,49152),D(this),G(this),w(this.a.g,this.a.g.md)):alert("MMC1: Invalid ROM! Unable to load.")};
h.m[1].prototype.toJSON=function(){var a=h.m[0].prototype.toJSON.apply(this);a.mirroring=this.fb;a.oneScreenMirroring=this.df;a.prgSwitchingArea=this.Tc;a.prgSwitchingSize=this.Uc;a.vromSwitchingSize=this.vc;a.romSelectionReg0=this.Fb;a.romSelectionReg1=this.Zc;a.romBankSelect=this.lf;a.regBuffer=this.ac;a.regBufferCounter=this.Cb;return a};
h.m[1].prototype.F=function(a){h.m[0].prototype.F.apply(this,a);this.fb=a.mirroring;this.df=a.oneScreenMirroring;this.Tc=a.prgSwitchingArea;this.Uc=a.prgSwitchingSize;this.vc=a.vromSwitchingSize;this.Fb=a.romSelectionReg0;this.Zc=a.romSelectionReg1;this.lf=a.romBankSelect;this.ac=a.regBuffer;this.Cb=a.regBufferCounter};h.m[2]=function(a){this.a=a};h.m[2].prototype=new h.m[0];h.m[2].prototype.write=function(a,b){32768>a?h.m[0].prototype.write.apply(this,arguments):C(this,b,32768)};
h.m[2].prototype.oc=function(){this.a.b.valid?(C(this,0,32768),C(this,this.a.b.K-1,49152),D(this),w(this.a.g,this.a.g.md)):alert("UNROM: Invalid ROM! Unable to load.")};h.m[4]=function(a){this.a=a;this.Bf=0;this.Cf=1;this.xf=2;this.yf=3;this.zf=4;this.Af=5;this.Df=6;this.Ef=7;this.Pc=this.Ad=this.lc=this.ef=this.$a=this.$b=this.rd=null;this.Zb=!1};h.m[4].prototype=new h.m[0];
h.m[4].prototype.write=function(a,b){if(32768>a)h.m[0].prototype.write.apply(this,arguments);else switch(a){case 32768:this.rd=b&7;var c=b>>6&1;c!=this.$b&&(this.Zb=!0);this.$b=c;this.$a=b>>7&1;break;case 32769:c=b;switch(this.rd){case this.Bf:0===this.$a?(J(this,c,0),J(this,c+1,1024)):(J(this,c,4096),J(this,c+1,5120));break;case this.Cf:0===this.$a?(J(this,c,2048),J(this,c+1,3072)):(J(this,c,6144),J(this,c+1,7168));break;case this.xf:0===this.$a?J(this,c,4096):J(this,c,0);break;case this.yf:0===
this.$a?J(this,c,5120):J(this,c,1024);break;case this.zf:0===this.$a?J(this,c,6144):J(this,c,2048);break;case this.Af:0===this.$a?J(this,c,7168):J(this,c,3072);break;case this.Df:this.Zb&&(0===this.$b?I(this,2*(this.a.b.K-1),49152):I(this,2*(this.a.b.K-1),32768),this.Zb=!1);0===this.$b?I(this,c,32768):I(this,c,49152);break;case this.Ef:I(this,c,40960),this.Zb&&(0===this.$b?I(this,2*(this.a.b.K-1),49152):I(this,2*(this.a.b.K-1),32768),this.Zb=!1)}break;case 40960:0!==(b&1)?s(this.a.n,this.a.b.hd):
s(this.a.n,this.a.b.nd);break;case 49152:this.lc=b;break;case 49153:this.Ad=b;break;case 57344:this.Pc=0;break;case 57345:this.Pc=1}};h.m[4].prototype.oc=function(){this.a.b.valid?(I(this,2*(this.a.b.K-1),49152),I(this,2*(this.a.b.K-1)+1,57344),I(this,0,32768),I(this,1,40960),D(this),G(this),w(this.a.g,this.a.g.md)):alert("MMC3: Invalid ROM! Unable to load.")};h.m[4].prototype.fe=function(){1==this.Pc&&(this.lc--,0>this.lc&&(w(this.a.g,this.a.g.ld),this.lc=this.Ad))};
h.m[4].prototype.toJSON=function(){var a=h.m[0].prototype.toJSON.apply(this);a.command=this.rd;a.prgAddressSelect=this.$b;a.chrAddressSelect=this.$a;a.pageNumber=this.ef;a.irqCounter=this.lc;a.irqLatchValue=this.Ad;a.irqEnable=this.Pc;a.prgAddressChanged=this.Zb;return a};
h.m[4].prototype.F=function(a){h.m[0].prototype.F.apply(this,a);this.rd=a.command;this.$b=a.prgAddressSelect;this.$a=a.chrAddressSelect;this.ef=a.pageNumber;this.lc=a.irqCounter;this.Ad=a.irqLatchValue;this.Pc=a.irqEnable;this.Zb=a.prgAddressChanged};h.X=function(a){this.a=a;this.Aa=new h.X.Wd(this,!0);this.Ba=new h.X.Wd(this,!1);this.qa=new h.X.Ie(this);this.Ga=new h.X.He(this);this.ca=new h.X.Ge(this);this.yd=4;this.kc=2048;this.We=8192;this.gc=0;this.mf=44100;this.Jb=this.Ib=this.O=this.N=this.Fd=null;this.$c=Array(2*this.We);this.Lc=!1;this.Kc=null;this.zd=!1;this.Pd=this.Mc=this.bc=this.Ec=this.wa=this.Wb=null;this.Wa=0;this.I=this.fa=this.pa=this.ha=this.ga=null;this.ge=this.Ye=this.bd=this.ad=this.Md=this.Ld=0;this.D=256;this.re=this.qe=
this.vd=this.pf=this.qf=this.tf=this.sf=this.rf=this.xe=this.ye=this.Be=this.Ae=this.ze=null;a=this.Yb=[80,170,100,150,128];for(var b=0;5>b;b++)this.Yb[b]=a[b];this.ze=this.Yb[0]*this.D>>8;this.Ae=this.Yb[1]*this.D>>8;this.Be=this.Yb[2]*this.D>>8;this.ye=this.Yb[3]*this.D>>8;this.xe=this.Yb[4]*this.D>>8;this.rf=this.D-this.ze;this.sf=this.D-this.Ae;this.tf=this.D-this.Be;this.qf=this.D-this.ye;this.pf=this.D-this.xe;this.Fd=[10,254,20,2,40,4,80,6,160,8,60,10,14,12,26,14,12,16,24,18,48,20,96,22,192,
24,72,26,16,28,32,30];this.N=Array(16);this.N[0]=3424;this.N[1]=3040;this.N[2]=2720;this.N[3]=2560;this.N[4]=2288;this.N[5]=2032;this.N[6]=1808;this.N[7]=1712;this.N[8]=1520;this.N[9]=1280;this.N[10]=1136;this.N[11]=1024;this.N[12]=848;this.N[13]=672;this.N[14]=576;this.N[15]=432;this.O=Array(16);this.O[0]=4;this.O[1]=8;this.O[2]=16;this.O[3]=32;this.O[4]=64;this.O[5]=96;this.O[6]=128;this.O[7]=160;this.O[8]=202;this.O[9]=254;this.O[10]=380;this.O[11]=508;this.O[12]=762;this.O[13]=1016;this.O[14]=
2034;this.O[15]=4068;var c,d=b=0;this.Ib=Array(512);this.Jb=Array(3264);for(a=0;512>a;a++)c=95.52/(8128/(a/16)+100),c*=.98411,c*=5E4,c=Math.floor(c),this.Ib[a]=c,c>b&&(b=c);for(a=0;3264>a;a++)c=163.67/(24329/(a/16)+100),c*=.98411,c*=5E4,c=Math.floor(c),this.Jb[a]=c,c>d&&(d=c);this.Ye=b+d;this.ge=this.Ye/2;for(a=0;20>a;a++)16===a?this.R(16400,16):this.R(16384+a,0);this.reset()};
h.X.prototype={reset:function(){this.mf=this.a.P.sampleRate;this.Pd=Math.floor(1024*this.a.P.CPU_FREQ_NTSC*this.a.P.ug/(60*this.mf));this.Mc=Math.floor(14915*this.a.P.ug/60);this.gc=this.bc=0;ka(this,0);this.Ec=this.wa=this.Wb=0;this.kc=2048;this.zd=this.Lc=!1;this.wa=0===this.Ec?4:0;this.Aa.reset();this.Ba.reset();this.qa.reset();this.Ga.reset();this.ca.reset();this.fa=this.pa=this.ha=this.ga=this.I=this.gc=0;this.Lc=!1;this.yd=4;this.bd=this.ad=this.Md=this.Ld=0;this.qe=-5E5;this.re=5E5},gf:function(){var a;
a=0|this.Aa.wb();a|=this.Ba.wb()<<1;a|=this.qa.wb()<<2;a|=this.Ga.wb()<<3;a|=this.ca.wb()<<4;a|=(this.Kc&&this.Lc?1:0)<<6;a|=(this.ca.Vb?1:0)<<7;this.Kc=!1;this.ca.Vb=!1;return a&65535},R:function(a,b){16384<=a&&16388>a?this.Aa.R(a,b):16388<=a&&16392>a?this.Ba.R(a,b):16392<=a&&16396>a?this.qa.R(a,b):16396<=a&&16399>=a?this.Ga.R(a,b):16400===a?this.ca.R(a,b):16401===a?this.ca.R(a,b):16402===a?this.ca.R(a,b):16403===a?this.ca.R(a,b):16405===a?(ka(this,b),0!==b&&0<this.kc&&(this.zd=!0),this.ca.R(a,b)):
16407===a&&(this.Ec=b>>7&1,this.Wb=0,this.Kc=!1,this.Lc=0===(b>>6&1),0===this.Ec?this.wa=this.yd=4:(this.yd=5,this.wa=0,la(this)))},gb:function(){var a,b;0<this.I?(this.ga<<=4,this.ga=Math.floor(this.ga/this.I),this.ha<<=4,this.ha=Math.floor(this.ha/this.I),this.pa=Math.floor(this.pa/this.I),this.fa<<=4,this.fa=Math.floor(this.fa/this.I),this.I=0):(this.ga=this.Aa.A<<4,this.ha=this.Ba.A<<4,this.pa=this.qa.A,this.fa=this.ca.gb<<4);var c=Math.floor((this.Ga.fc<<4)/this.Ga.I);this.Ga.fc=c>>4;this.Ga.I=
1;a=this.ga*this.ze+this.ha*this.Ae>>8;b=3*this.pa*this.Be+(c<<1)*this.ye+this.fa*this.xe>>8;a>=this.Ib.length&&(a=this.Ib.length-1);b>=this.Jb.length&&(b=this.Jb.length-1);var d=this.Ib[a]+this.Jb[b]-this.ge;a=this.ga*this.rf+this.ha*this.sf>>8;b=3*this.pa*this.tf+(c<<1)*this.qf+this.fa*this.pf>>8;a>=this.Ib.length&&(a=this.Ib.length-1);b>=this.Jb.length&&(b=this.Jb.length-1);a=this.Ib[a]+this.Jb[b]-this.ge;d-=this.Ld;this.Ld+=d;d=this.ad+=d-(this.ad>>10);a-=this.Md;this.Md+=a;a=this.bd+=a-(this.bd>>
10);d>this.qe&&(this.qe=d);d<this.re&&(this.re=d);this.$c[this.gc++]=d;this.$c[this.gc++]=a;this.gc===this.$c.length&&(this.a.ui.uf(this.$c),this.$c=Array(2*this.We),this.gc=0);this.fa=this.pa=this.ha=this.ga=0}};function la(a){a.wa++;a.wa>=a.yd&&(a.wa=0);if(1===a.wa||3===a.wa)a.qa.hc(),a.Aa.hc(),a.Ba.hc(),a.Ga.hc(),ma(a.Aa),ma(a.Ba);if(0<=a.wa&&4>a.wa){a.Aa.qd();a.Ba.qd();a.Ga.qd();var b=a.qa;b.Ed?(b.nc=b.pe,T(b)):0<b.nc&&(b.nc--,T(b));b.Dd||(b.Ed=!1)}3===a.wa&&0===a.Ec&&(a.Kc=!0)}
function k(a,b){if(0<a.kc&&a.zd)a.kc-=b,0>=a.kc&&(a.zd=!1);else{b+=a.vd;var c=a.Pd-a.bc;b<<10>c?(a.vd=(b<<10)-c>>10,b-=a.vd):a.vd=0;var d=a.ca,e=a.qa,f=a.Aa,g=a.Ba,c=a.Ga;if(d.isEnabled)for(d.sc-=b<<3;0>=d.sc&&0<d.ud;){d.sc+=d.ud;var l=d;l.ne&&(0===(l.data&1)?0<l.vb&&l.vb--:63>l.vb&&l.vb++,l.gb=l.isEnabled?(l.vb<<1)+l.sd:0,l.data>>=1);l.td--;if(0>=l.td){l.ne=!1;var m=l;0===m.Ha&&m.rc===m.Ne&&(m.Bb=m.Sc,m.Ha=m.qc);if(0<m.Ha){var n=m;n.data=n.G.a.k.load(n.Bb);var p=n.G.a.g;p.ma+=4;n.Ha--;n.Bb++;65535<
n.Bb&&(n.Bb=32768);n.ne=!0;0===m.Ha&&m.rc===m.Me&&(m.Vb=!0)}l.td=8}l.Vb&&w(l.G.a.g,l.G.a.g.ld)}if(0<e.d)for(e.s-=b;0>=e.s;)e.s+=e.d+1,0<e.nc&&0<e.q&&(e.Kb++,e.Kb&=31,e.isEnabled&&(e.A=16<=e.Kb?e.Kb&15:15-(e.Kb&15),e.A<<=4));f.s-=b;0>=f.s&&(f.s+=f.d+1<<1,f.Hb++,f.Hb&=7,f.Xa());g.s-=b;0>=g.s&&(g.s+=g.d+1<<1,g.Hb++,g.Hb&=7,g.Xa());d=b;if(0<c.s-d)c.s-=d,c.I+=d,c.fc+=d*c.A;else for(;0<d--;)0>=--c.s&&0<c.d&&(c.cc<<=1,c.dd=(c.cc<<(0===c.te?1:6)^c.cc)&32768,0!==c.dd?(c.cc|=1,c.Nd=0,c.A=0):(c.Nd=1,c.A=c.isEnabled&&
0<c.q?c.D:0),c.s+=c.d),c.fc+=c.A,c.I++;a.Lc&&a.Kc&&w(a.a.g,a.a.g.ld);a.Wb+=b<<1;a.Wb>=a.Mc&&(a.Wb-=a.Mc,la(a));c=b;a.qa.ue&&(a.Wa=Math.floor((a.qa.s<<4)/(a.qa.d+1)),16<a.Wa&&(a.Wa=16),16<=a.qa.Kb&&(a.Wa=16-a.Wa),a.Wa+=a.qa.A);2===c?(a.pa+=a.Wa<<1,a.fa+=a.ca.gb<<1,a.ga+=a.Aa.A<<1,a.ha+=a.Ba.A<<1,a.I+=2):4===c?(a.pa+=a.Wa<<2,a.fa+=a.ca.gb<<2,a.ga+=a.Aa.A<<2,a.ha+=a.Ba.A<<2,a.I+=4):(a.pa+=c*a.Wa,a.fa+=c*a.ca.gb,a.ga+=c*a.Aa.A,a.ha+=c*a.Ba.A,a.I+=c);a.bc+=b<<10;a.bc>=a.Pd&&(a.gb(),a.bc-=a.Pd)}}
function ka(a,b){a.Aa.Gb(0!==(b&1));a.Ba.Gb(0!==(b&2));a.qa.Gb(0!==(b&4));a.Ga.Gb(0!==(b&8));a.ca.Gb(0!==(b&16))}h.X.Ge=function(a){this.G=a;this.Oe=0;this.Ne=1;this.Me=2;this.ne=this.isEnabled=null;this.Vb=!1;this.data=this.sd=this.gb=this.sc=this.Ha=this.qc=this.Bb=this.Sc=this.vb=this.td=this.ud=this.rc=null;this.reset()};
h.X.Ge.prototype={R:function(a,b){if(16400===a){0===b>>6?this.rc=this.Oe:1===(b>>6&1)?this.rc=this.Ne:2===b>>6&&(this.rc=this.Me);0===(b&128)&&(this.Vb=!1);var c=b&15;this.ud=0<=c&&16>c?this.G.N[c]:0}else 16401===a?(this.vb=b>>1&63,this.sd=b&1,this.gb=(this.vb<<1)+this.sd):16402===a?this.Bb=this.Sc=b<<6|49152:16403===a?this.Ha=this.qc=(b<<4)+1:16405===a&&(0===(b>>4&1)?this.Ha=0:(this.Bb=this.Sc,this.Ha=this.qc),this.Vb=!1)},Gb:function(a){!this.isEnabled&&a&&(this.Ha=this.qc);this.isEnabled=a},wb:function(){return 0!==
this.Ha&&this.isEnabled?1:0},reset:function(){this.Vb=this.isEnabled=!1;this.rc=this.Oe;this.data=this.sc=this.sd=this.gb=this.Ha=this.qc=this.Bb=this.Sc=this.vb=this.td=this.ud=0}};h.X.He=function(a){this.G=a;this.D=this.da=this.ab=this.na=this.d=this.s=this.q=this.Tb=this.Fa=this.Sb=this.bb=this.isEnabled=null;this.cc=16384;this.A=this.te=this.Nd=null;this.fc=0;this.I=1;this.dd=null;this.reset()};
h.X.He.prototype={reset:function(){this.d=this.s=0;this.isEnabled=!1;this.q=0;this.Sb=this.bb=this.Fa=!1;this.D=this.da=this.ab=this.na=0;this.cc=1;this.dd=this.A=this.te=this.Nd=0},hc:function(){this.Fa&&0<this.q&&(this.q--,0===this.q&&this.Xa())},qd:function(){this.Tb?(this.Tb=!1,this.ab=this.na+1,this.da=15):0>=--this.ab&&(this.ab=this.na+1,0<this.da?this.da--:this.da=this.Sb?15:0);this.D=this.bb?this.na:this.da;this.Xa()},Xa:function(){this.isEnabled&&0<this.q&&(this.A=this.Nd*this.D)},R:function(a,
b){if(16396===a)this.bb=0!==(b&16),this.na=b&15,this.Sb=0!==(b&32),this.Fa=0===(b&32),this.D=this.bb?this.na:this.da;else if(16398===a){var c=b&15;this.d=0<=c&&16>c?this.G.O[c]:0;this.te=b>>7}else 16399===a&&(this.q=this.G.Fd[(b&248)>>3],this.Tb=!0)},Gb:function(a){this.isEnabled=a;a||(this.q=0);this.Xa()},wb:function(){return 0!==this.q&&this.isEnabled?1:0}};
h.X.Wd=function(a,b){this.G=a;this.rg=[0,1,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,1,1,1,1,0,0,0,1,0,0,1,1,1,1,1];this.of=b;this.A=this.he=this.D=this.da=this.ab=this.na=this.uc=this.Td=this.Sd=this.Rd=this.Hb=this.q=this.d=this.s=this.De=this.Tb=this.Sb=this.bb=this.Ce=this.Fa=this.isEnabled=null;this.reset()};
h.X.Wd.prototype={reset:function(){this.he=this.D=this.da=this.ab=this.na=this.uc=this.Td=this.Sd=this.Rd=this.Hb=this.q=this.d=this.s=0;this.Sb=this.bb=this.Ce=this.Fa=this.isEnabled=!1},hc:function(){this.Fa&&0<this.q&&(this.q--,0===this.q&&this.Xa())},qd:function(){this.Tb?(this.Tb=!1,this.ab=this.na+1,this.da=15):0>=--this.ab&&(this.ab=this.na+1,0<this.da?this.da--:this.da=this.Sb?15:0);this.D=this.bb?this.na:this.da;this.Xa()},Xa:function(){this.A=this.isEnabled&&0<this.q&&7<this.d?0===this.Td&&
4095<this.d+(this.d>>this.uc)?0:this.D*this.rg[(this.he<<3)+this.Hb]:0},R:function(a,b){var c=this.of?0:4;a===16384+c?(this.bb=0!==(b&16),this.na=b&15,this.Sb=0!==(b&32),this.he=b>>6&3,this.Fa=0===(b&32),this.D=this.bb?this.na:this.da,this.Xa()):a===16385+c?(this.Ce=0!==(b&128),this.Sd=b>>4&7,this.Td=b>>3&1,this.uc=b&7,this.De=!0):a===16386+c?(this.d&=1792,this.d|=b):a===16387+c&&(this.d&=255,this.d|=(b&7)<<8,this.isEnabled&&(this.q=this.G.Fd[(b&248)>>3]),this.Tb=!0)},Gb:function(a){this.isEnabled=
a;a||(this.q=0);this.Xa()},wb:function(){return 0!==this.q&&this.isEnabled?1:0}};function ma(a){0>=--a.Rd&&(a.Rd=a.Sd+1,a.Ce&&0<a.uc&&7<a.d&&(0===a.Td?(a.d+=a.d>>a.uc,4095<a.d&&(a.d=4095)):a.d-=(a.d>>a.uc)-(a.of?1:0)));a.De&&(a.De=!1,a.Rd=a.Sd+1)}h.X.Ie=function(a){this.G=a;this.dd=this.A=this.pe=this.nc=this.q=this.Kb=this.d=this.s=this.Dd=this.Ed=this.Fa=this.ue=this.isEnabled=null;this.reset()};
h.X.Ie.prototype={reset:function(){this.Kb=this.d=this.s=0;this.ue=this.isEnabled=!1;this.q=0;this.Fa=!1;this.pe=this.nc=0;this.Ed=!0;this.Dd=!1;this.dd=0;this.A=15},hc:function(){this.Fa&&0<this.q&&(this.q--,0===this.q&&T(this))},wb:function(){return 0!==this.q&&this.isEnabled?1:0},gf:function(){return 0},R:function(a,b){16392===a?(this.Dd=0!==(b&128),this.pe=b&127,this.Fa=!this.Dd):16394===a?(this.d&=1792,this.d|=b):16395===a&&(this.d&=255,this.d|=(b&7)<<8,this.q=this.G.Fd[(b&248)>>3],this.Ed=!0);
T(this)},Gb:function(a){this.isEnabled=a;a||(this.q=0);T(this)}};function T(a){a.ue=a.isEnabled&&7<a.d&&0<a.nc&&0<a.q};h.Y=function(a){this.a=a;this.Xb=this.Na=this.ya=this.ic=this.l=this.J=this.Oc=this.dc=this.Nc=this.Ja=this.Ia=this.de=this.xb=this.ra=this.tc=this.Ka=this.t=this.la=this.Rb=this.eb=this.L=this.nf=this.Lb=this.oa=this.od=this.ff=this.buffer=this.tb=this.ub=this.Od=this.Vc=this.Ta=this.ea=this.Sa=this.Eb=this.Db=this.va=this.S=this.aa=this.ba=this.ta=this.Ub=this.wd=this.xd=this.Qa=this.xa=this.Hc=this.le=this.Gc=this.Ic=this.ke=this.jc=this.me=this.Qd=this.Rc=this.Lb=this.Fc=this.cf=this.Wc=this.ic=
this.Ua=this.cb=this.Vd=this.ed=this.T=this.hb=this.Q=null;this.zg=!1;this.ee=!0;this.reset()};
h.Y.prototype={Ve:6,ae:7,reset:function(){var a;this.Q=new Uint8Array(32768);this.hb=new Uint8Array(256);for(a=0;a<this.Q.length;a++)this.Q[a]=0;for(a=0;a<this.hb.length;a++)this.hb[a]=0;this.ed=this.T=null;this.Vd=0;this.cb=!0;this.Ua=0;this.ic=-1;this.Lb=this.Fc=this.cf=this.Wc=!1;this.Rc=0;this.Qd=null;this.Od=this.Vc=this.Ta=this.ea=this.Sa=this.Eb=this.Db=this.va=this.S=this.aa=this.ba=this.ta=this.Ub=this.wd=this.xd=this.Qa=this.xa=this.Hc=this.le=this.Gc=this.Ic=this.ke=this.jc=this.me=0;this.ub=
null;this.tb=Array(32);this.buffer=Array(61440);this.ff=Array(61440);this.od=Array(61440);this.oa=Array(61440);this.Lb=null;this.nf=Array(32);this.L=0;this.eb=-1;this.Rb=0;this.la=Array(64);this.t=Array(64);this.Ka=Array(64);this.tc=Array(64);this.ra=Array(64);this.xb=Array(64);this.de=Array(64);this.Ja=this.Ia=0;this.Nc=!1;this.dc=Array(16);this.Oc=Array(16);this.J=Array(512);for(a=0;512>a;a++)this.J[a]=new h.Y.be;this.l=Array(4);this.ic=-1;this.ya=Array(4);for(a=0;4>a;a++)this.ya[a]=new h.Y.Pe(32,
32,"Nt"+a);this.Na=Array(32768);for(a=0;32768>a;a++)this.Na[a]=a;a=this.Xb=new h.Y.Re;a.Qb=[5395026,11796480,10485760,11599933,7602281,91,95,6208,12048,543240,26368,1196544,7153664,0,0,0,12899815,16728064,14421538,16729963,14090399,6818519,6588,21681,27227,35843,43776,2918400,10777088,0,0,0,16316664,16755516,16742785,16735173,16730354,14633471,4681215,46327,57599,58229,259115,7911470,15065624,7895160,0,0,16777215,16773822,16300216,16300248,16758527,16761855,13095423,10148607,8973816,8650717,12122296,
16119980,16777136,16308472,0,0];for(var b,c,d,e,f,g,l,m=0;8>m;m++)for(l=g=f=1,0!==(m&1)&&(l=f=.75),0!==(m&2)&&(g=f=.75),0!==(m&4)&&(l=g=.75),a.je[m]=Array(64),e=0;64>e;e++)d=a.Qb[e],b=Math.floor((d>>16&255)*f),c=Math.floor((d>>8&255)*g),d=Math.floor((d&255)*l),a.je[m][e]=b<<16|c<<8|d;U(a,0);fa(this,0);ga(this,0)},Ob:{Q:"vramMem",hb:"spriteMem",ta:"cntFV",ba:"cntV",aa:"cntH",S:"cntVT",va:"cntHT",Db:"regFV",Eb:"regV",Sa:"regH",ea:"regVT",Ta:"regHT",Vc:"regFH",Od:"regS",T:"vramAddress",ed:"vramTmpAddress",
me:"f_nmiOnVblank",jc:"f_spriteSize",ke:"f_bgPatternTable",Ic:"f_spPatternTable",Gc:"f_addrInc",le:"f_nTblAddress",Hc:"f_color",xa:"f_spVisibility",Qa:"f_bgVisibility",xd:"f_spClipping",wd:"f_bgClipping",Ub:"f_dispType",Vd:"vramBufferedReadValue",cb:"firstWrite",ic:"currentMirroring",Na:"vramMirrorTable",l:"ntable1",Ua:"sramAddress",Nc:"hitSpr0",dc:"sprPalette",Oc:"imgPalette",Rb:"curX",L:"scanline",eb:"lastRenderedScanline",ub:"curNt",tb:"attrib",buffer:"buffer",od:"bgbuffer",oa:"pixrendered",Wc:"requestEndFrame",
cf:"nmiOk",Fc:"dummyCycleToggle",Rc:"nmiCounter",Lb:"validTileData",Qd:"scanlineAlreadyRendered"},toJSON:function(){var a,b=h.sa.toJSON(this);b.nameTable=[];for(a=0;a<this.ya.length;a++)b.nameTable[a]=this.ya[a].toJSON();b.ptTile=[];for(a=0;a<this.J.length;a++)b.ptTile[a]=this.J[a].toJSON();return b},F:function(a){var b;h.sa.F(this,a);for(b=0;b<this.ya.length;b++)this.ya[b].F(a.nameTable[b]);for(b=0;b<this.J.length;b++)this.J[b].F(a.ptTile[b]);for(b=0;b<this.hb.length;b++)N(this,b,this.hb[b])}};
function N(a,b,c){var d=Math.floor(b/4);0===d&&O(a,a.L-20);0===b%4?a.t[d]=c:1==b%4?a.Ka[d]=c:2==b%4?(a.ra[d]=0!==(c&128),a.xb[d]=0!==(c&64),a.de[d]=0!==(c&32),a.tc[d]=(c&3)<<2):3==b%4&&(a.la[d]=c)}function V(a,b,c,d){a.ya[b].Ud[c]=d;O(a,a.L-20)}function na(a){var b;for(b=0;16>b;b++)a.Oc[b]=0===a.Ub?a.Xb.Qb[a.Q[16128+b]&63]:a.Xb.Qb[a.Q[16128+b]&32];for(b=0;16>b;b++)a.dc[b]=0===a.Ub?a.Xb.Qb[a.Q[16144+b]&63]:a.Xb.Qb[a.Q[16144+b]&32]}
function S(a,b,c){a.Q[b]=c;if(8192>b){a.Q[b]=c;var d=Math.floor(b/16),e=b%16;8>e?W(a.J[d],e,c,a.Q[b+8]):W(a.J[d],e-8,a.Q[b-8],c)}else 8192<=b&&9152>b?V(a,a.l[0],b-8192,c):9152<=b&&9216>b?X(a.ya[a.l[0]],b-9152,c):9216<=b&&10176>b?V(a,a.l[1],b-9216,c):10176<=b&&10240>b?X(a.ya[a.l[1]],b-10176,c):10240<=b&&11200>b?V(a,a.l[2],b-10240,c):11200<=b&&11264>b?X(a.ya[a.l[2]],b-11200,c):11264<=b&&12224>b?V(a,a.l[3],b-11264,c):12224<=b&&12288>b?X(a.ya[a.l[3]],b-12224,c):16128<=b&&16160>b&&na(a)}
function O(a,b){a.Ia=-1;a.Ja=-1;var c,d=0===a.Ic?0:256,e,f,g;e=a.la[0];c=a.t[0]+1;if(0===a.jc){if(c<=b&&c+8>b&&-7<=e&&256>e)if(d=a.J[a.Ka[0]+d],c=a.ra[0]?7-(b-c):b-c,c*=8,g=256*b+e,a.xb[0])for(f=7;0<=f;f--){if(0<=e&&256>e&&0<=g&&61440>g&&0!==a.oa[g]&&0!==d.ka[c+f])return a.Ia=g%256,a.Ja=b,!0;e++;g++}else for(f=0;8>f;f++){if(0<=e&&256>e&&0<=g&&61440>g&&0!==a.oa[g]&&0!==d.ka[c+f])return a.Ia=g%256,a.Ja=b,!0;e++;g++}}else if(c<=b&&c+16>b&&-7<=e&&256>e)if(c=a.ra[0]?15-(b-c):b-c,8>c?d=a.J[a.Ka[0]+(a.ra[0]?
1:0)+(0!==(a.Ka[0]&1)?255:0)]:(d=a.J[a.Ka[0]+(a.ra[0]?0:1)+(0!==(a.Ka[0]&1)?255:0)],c=a.ra[0]?15-c:c-8),c*=8,g=256*b+e,a.xb[0])for(f=7;0<=f;f--){if(0<=e&&256>e&&0<=g&&61440>g&&0!==a.oa[g]&&0!==d.ka[c+f])return a.Ia=g%256,a.Ja=b,!0;e++;g++}else for(f=0;8>f;f++){if(0<=e&&256>e&&0<=g&&61440>g&&0!==a.oa[g]&&0!==d.ka[c+f])return a.Ia=g%256,a.Ja=b,!0;e++;g++}return!1}
function oa(a,b,c,d){if(1===a.xa)for(var e=0;64>e;e++)if(a.de[e]==d&&0<=a.la[e]&&256>a.la[e]&&a.t[e]+8>=b&&a.t[e]<b+c)if(0===a.jc)a.ve=0,a.we=8,a.t[e]<b&&(a.ve=b-a.t[e]-1),a.t[e]+8>b+c&&(a.we=b+c-a.t[e]+1),0===a.Ic?Y(a.J[a.Ka[e]],a.buffer,a.ve,a.we,a.la[e],a.t[e]+1,a.tc[e],a.dc,a.xb[e],a.ra[e],e,a.oa):Y(a.J[a.Ka[e]+256],a.buffer,a.ve,a.we,a.la[e],a.t[e]+1,a.tc[e],a.dc,a.xb[e],a.ra[e],e,a.oa);else{var f=a.Ka[e];0!==(f&1)&&(f=a.Ka[e]-1+256);var g=0,l=8;a.t[e]<b&&(g=b-a.t[e]-1);a.t[e]+8>b+c&&(l=b+c-
a.t[e]);Y(a.J[f+(a.ra[e]?1:0)],a.buffer,g,l,a.la[e],a.t[e]+1,a.tc[e],a.dc,a.xb[e],a.ra[e],e,a.oa);g=0;l=8;a.t[e]+8<b&&(g=b-(a.t[e]+8+1));a.t[e]+16>b+c&&(l=b+c-(a.t[e]+8));Y(a.J[f+(a.ra[e]?0:1)],a.buffer,g,l,a.la[e],a.t[e]+1+8,a.tc[e],a.dc,a.xb[e],a.ra[e],e,a.oa)}}
function pa(a,b,c){var d=0===a.Od?0:256,e=(c<<8)-a.Vc;a.ub=a.l[a.ba+a.ba+a.aa];a.va=a.Ta;a.aa=a.Sa;a.ub=a.l[a.ba+a.ba+a.aa];if(240>c&&0<=c-a.ta){var f=a.ta<<3,g=a.nf,l=a.tb,m=a.J,n=a.ya,p=a.Oc,v=a.oa;b=b?a.od:a.buffer;for(var r,t,B,E=0;32>E;E++){if(0<=c){a.Lb?(r=g[E],t=r.ka,B=l[E]):(t=n[a.ub],r=m[d+t.Ud[a.S*t.width+a.va]],t=r.ka,B=n[a.ub],B=B.tb[a.S*B.width+a.va],g[E]=r,l[E]=B);var F=0,R=(E<<3)-a.Vc;if(-8<R)if(0>R&&(e-=R,F=-R),r.Kd[a.ta])for(;8>F;F++)b[e]=p[t[f+F]+B],v[e]|=256,e++;else for(;8>F;F++)r=
t[f+F],0!==r&&(b[e]=p[r+B],v[e]|=256),e++}32==++a.va&&(a.va=0,a.aa++,a.aa%=2,a.ub=a.l[(a.ba<<1)+a.aa])}a.Lb=!0}a.ta++;8==a.ta&&(a.ta=0,a.S++,30==a.S?(a.S=0,a.ba++,a.ba%=2,a.ub=a.l[(a.ba<<1)+a.aa]):32==a.S&&(a.S=0),a.Lb=!1)}function qa(a,b,c){1==a.xa&&oa(a,b,c,!0);if(1==a.Qa){var d=b+c<<8;61440<d&&(d=61440);for(var e=a.buffer,f=a.od,g=a.oa,l=b<<8;l<d;l++)255<g[l]&&(e[l]=f[l])}1==a.xa&&oa(a,b,c,!1);a.Lb=!1}function H(a){21<=a.L&&260>=a.L&&(qa(a,a.eb+1,a.L-21-a.eb),a.eb=a.L-21)}
function P(a){var b=(a.ta&7)<<4,b=b|(a.ba&1)<<3,b=b|(a.aa&1)<<2,b=b|a.S>>3&3,c=(a.S&7)<<5,c=c|a.va&31;a.T=(b<<8|c)&32767}function Q(a){var b=(a.Db&7)<<4,b=b|(a.Eb&1)<<3,b=b|(a.Sa&1)<<2,b=b|a.ea>>3&3,c=(a.ea&7)<<5,c=c|a.Ta&31;a.ed=(b<<8|c)&32767}function ia(a){var b=a.T>>8&255;a.ta=b>>4&3;a.ba=b>>3&1;a.aa=b>>2&1;a.S=a.S&7|(b&3)<<3;b=a.T&255;a.S=a.S&24|b>>5&7;a.va=b&31}
function ha(a){var b=a.ed>>8&255;a.Db=b>>4&7;a.Eb=b>>3&1;a.Sa=b>>2&1;a.ea=a.ea&7|(b&3)<<3;b=a.ed&255;a.ea=a.ea&24|b>>5&7;a.Ta=b&31}function q(a,b,c){b=1<<b;a.a.g.o[8194]=a.a.g.o[8194]&255-b|(c?b:0)}function ga(a,b){H(a);a.Hc=b>>5&7;a.xa=b>>4&1;a.Qa=b>>3&1;a.xd=b>>2&1;a.wd=b>>1&1;a.Ub=b&1;0===a.Ub&&U(a.Xb,a.Hc);na(a)}function fa(a,b){H(a);a.me=b>>7&1;a.jc=b>>5&1;a.ke=b>>4&1;a.Ic=b>>3&1;a.Gc=b>>2&1;a.le=b&3;a.Eb=b>>1&1;a.Sa=b&1;a.Od=b>>4&1}
function aa(a){var b=0;if(0===a.Ub)b=a.Oc[0];else switch(a.Hc){case 0:b=0;break;case 1:b=65280;break;case 2:b=16711680;break;case 3:b=0;break;case 4:b=255;break;default:b=0}var c=a.buffer,d;for(d=0;61440>d;d++)c[d]=b;a=a.oa;for(d=0;d<a.length;d++)a[d]=65}
function da(a){switch(a.L){case 19:a.Fc&&(a.Rb=1,a.Fc=!a.Fc);break;case 20:q(a,a.ae,!1);q(a,a.Ve,!1);a.Nc=!1;a.Ia=-1;a.Ja=-1;if(1==a.Qa||1==a.xa)a.ta=a.Db,a.ba=a.Eb,a.aa=a.Sa,a.S=a.ea,a.va=a.Ta,1==a.Qa&&pa(a,!1,0);1==a.Qa&&1==a.xa&&O(a,0);1!=a.Qa&&1!=a.xa||a.a.k.fe();break;case 261:q(a,a.ae,!0);a.Wc=!0;a.Rc=9;a.L=-1;break;default:21<=a.L&&260>=a.L&&(1==a.Qa&&(a.Qd||(a.va=a.Ta,a.aa=a.Sa,pa(a,!0,a.L+1-21)),a.Qd=!1,!a.Nc&&1==a.xa&&-7<=a.la[0]&&256>a.la[0]&&a.t[0]+1<=a.L-20&&a.t[0]+1+(0===a.jc?8:16)>=
a.L-20&&O(a,a.L-20)&&(a.Nc=!0)),1!=a.Qa&&1!=a.xa||a.a.k.fe())}a.L++;Q(a);P(a)}
function ca(a){w(a.a.g,a.a.g.og);239>a.eb&&qa(a,a.eb+1,240-a.eb);var b,c,d=a.buffer;if(a.zg){if(0<=a.la[0]&&256>a.la[0]&&0<=a.t[0]&&240>a.t[0]){for(b=0;256>b;b++)d[(a.t[0]<<8)+b]=16733525;for(b=0;240>b;b++)d[(b<<8)+a.la[0]]=16733525}if(0<=a.Ia&&256>a.Ia&&0<=a.Ja&&240>a.Ja){for(b=0;256>b;b++)d[(a.Ja<<8)+b]=5635925;for(b=0;240>b;b++)d[(b<<8)+a.Ia]=5635925}}if(a.ee||0===a.wd||0===a.xd)for(c=0;240>c;c++)for(b=0;8>b;b++)d[(c<<8)+b]=0;if(a.ee)for(c=0;240>c;c++)for(b=0;8>b;b++)d[(c<<8)+255-b]=0;if(a.ee)for(c=
0;8>c;c++)for(b=0;256>b;b++)d[(c<<8)+b]=0,d[(239-c<<8)+b]=0;a.a.P.showDisplay&&a.a.ui.vf(d,a.ff);a.eb=-1}function Z(a,b,c,d){for(var e=0;e<d;e++)a.Na[b+e]=c+e}
function s(a,b){if(b!=a.ic){a.ic=b;H(a);null===a.Na&&(a.Na=Array(32768));for(var c=0;32768>c;c++)a.Na[c]=c;Z(a,16160,16128,32);Z(a,16192,16128,32);Z(a,16256,16128,32);Z(a,16320,16128,32);Z(a,12288,8192,3840);Z(a,16384,0,16384);b==a.a.b.hd?(a.l[0]=0,a.l[1]=0,a.l[2]=1,a.l[3]=1,Z(a,9216,8192,1024),Z(a,11264,10240,1024)):b==a.a.b.nd?(a.l[0]=0,a.l[1]=1,a.l[2]=0,a.l[3]=1,Z(a,10240,8192,1024),Z(a,11264,9216,1024)):b==a.a.b.Ue?(a.l[0]=0,a.l[1]=0,a.l[2]=0,a.l[3]=0,Z(a,9216,8192,1024),Z(a,10240,8192,1024),
Z(a,11264,8192,1024)):b==a.a.b.qg?(a.l[0]=1,a.l[1]=1,a.l[2]=1,a.l[3]=1,Z(a,9216,9216,1024),Z(a,10240,9216,1024),Z(a,11264,9216,1024)):(a.l[0]=0,a.l[1]=1,a.l[2]=2,a.l[3]=3)}}h.Y.Pe=function(a,b,c){this.width=a;this.height=b;this.name=c;this.Ud=Array(a*b);this.tb=Array(a*b)};h.Y.Pe.prototype={toJSON:function(){return{tile:this.Ud,attrib:this.tb}},F:function(a){this.Ud=a.tile;this.tb=a.attrib}};
function X(a,b,c){var d=b%8*4;b=4*Math.floor(b/8);for(var e,f,g,l=0;2>l;l++)for(var m=0;2>m;m++){e=c>>2*(2*l+m)&3;for(var n=0;2>n;n++)for(var p=0;2>p;p++)f=d+2*m+p,g=b+2*l+n,a.tb[g*a.width+f]=e<<2&12}}h.Y.Re=function(){this.Qb=Array(64);this.je=Array(8);this.Xe=-1};h.Y.Re.prototype={reset:function(){U(this,0)}};function U(a,b){if(b!=a.Xe){a.Xe=b;for(var c=0;64>c;c++)a.Qb[c]=a.je[b][c]}}h.Y.be=function(){this.ka=Array(64);this.H=this.za=this.y=this.x=this.M=this.j=null;this.Kd=Array(8)};
h.Y.be.prototype={toJSON:function(){return{opaque:this.Kd,pix:this.ka}},F:function(a){this.Kd=a.opaque;this.ka=a.pix}};
function Y(a,b,c,d,e,f,g,l,m,n,p,v){var r=0,t=8;if(!(-7>e||256<=e||-7>f||240<=f))if(0>e&&(r-=e),256<=e+t&&(t=256-e),0>f&&(c-=f),240<=f+d&&(d=240-f),m||n)if(m&&!n)for(a.j=(f<<8)+e,a.M=7,a.y=0;8>a.y;a.y++){for(a.x=0;8>a.x;a.x++)a.x>=r&&a.x<t&&a.y>=c&&a.y<d&&(a.za=a.ka[a.M],a.H=v[a.j],0!==a.za&&p<=(a.H&255)&&(b[a.j]=l[a.za+g],a.H=a.H&3840|p,v[a.j]=a.H)),a.j++,a.M--;a.j-=8;a.j+=256;a.M+=16}else if(n&&!m)for(a.j=(f<<8)+e,a.M=56,a.y=0;8>a.y;a.y++){for(a.x=0;8>a.x;a.x++)a.x>=r&&a.x<t&&a.y>=c&&a.y<d&&(a.za=
a.ka[a.M],a.H=v[a.j],0!==a.za&&p<=(a.H&255)&&(b[a.j]=l[a.za+g],a.H=a.H&3840|p,v[a.j]=a.H)),a.j++,a.M++;a.j-=8;a.j+=256;a.M-=16}else for(a.j=(f<<8)+e,a.M=63,a.y=0;8>a.y;a.y++){for(a.x=0;8>a.x;a.x++)a.x>=r&&a.x<t&&a.y>=c&&a.y<d&&(a.za=a.ka[a.M],a.H=v[a.j],0!==a.za&&p<=(a.H&255)&&(b[a.j]=l[a.za+g],a.H=a.H&3840|p,v[a.j]=a.H)),a.j++,a.M--;a.j-=8;a.j+=256}else for(a.j=(f<<8)+e,a.M=0,a.y=0;8>a.y;a.y++){for(a.x=0;8>a.x;a.x++)a.x>=r&&a.x<t&&a.y>=c&&a.y<d&&(a.za=a.ka[a.M],a.H=v[a.j],0!==a.za&&p<=(a.H&255)&&
(b[a.j]=l[a.za+g],a.H=a.H&3840|p,v[a.j]=a.H)),a.j++,a.M++;a.j-=8;a.j+=256}}function W(a,b,c,d){a.M=b<<3;for(a.x=0;8>a.x;a.x++)a.ka[a.M+a.x]=(c>>7-a.x&1)+((d>>7-a.x&1)<<1),0===a.ka[a.M+a.x]&&(a.Kd[b]=!1)};h.Te=function(a){this.a=a;this.h=Array(92);for(a=0;92>a;a++)this.h[a]="Unknown Mapper";this.h[0]="Direct Access";this.h[1]="Nintendo MMC1";this.h[2]="UNROM";this.h[3]="CNROM";this.h[4]="Nintendo MMC3";this.h[5]="Nintendo MMC5";this.h[6]="FFE F4xxx";this.h[7]="AOROM";this.h[8]="FFE F3xxx";this.h[9]="Nintendo MMC2";this.h[10]="Nintendo MMC4";this.h[11]="Color Dreams Chip";this.h[12]="FFE F6xxx";this.h[15]="100-in-1 switch";this.h[16]="Bandai chip";this.h[17]="FFE F8xxx";this.h[18]="Jaleco SS8806 chip";
this.h[19]="Namcot 106 chip";this.h[20]="Famicom Disk System";this.h[21]="Konami VRC4a";this.h[22]="Konami VRC2a";this.h[23]="Konami VRC2a";this.h[24]="Konami VRC6";this.h[25]="Konami VRC4b";this.h[32]="Irem G-101 chip";this.h[33]="Taito TC0190/TC0350";this.h[34]="32kB ROM switch";this.h[64]="Tengen RAMBO-1 chip";this.h[65]="Irem H-3001 chip";this.h[66]="GNROM switch";this.h[67]="SunSoft3 chip";this.h[68]="SunSoft4 chip";this.h[69]="SunSoft5 FME-7 chip";this.h[71]="Camerica chip";this.h[78]="Irem 74HC161/32-based";
this.h[91]="Pirate HK-SF3 chip"};
h.Te.prototype={nd:0,hd:1,Gf:2,Ue:3,qg:4,Ea:null,b:null,Ya:null,Mb:null,K:null,B:null,fb:null,ce:null,Ag:null,Ze:null,Ra:null,valid:!1,load:function(a){var b,c;if(-1===a.indexOf("NES\u001a"))this.a.ui.Ma("Not a valid NES ROM.");else{this.Ea=new Uint8Array(16);for(b=0;16>b;b++)this.Ea[b]=a.charCodeAt(b)&255;this.K=this.Ea[4];this.B=2*this.Ea[5];this.fb=0!==(this.Ea[6]&1)?1:0;this.ce=0!==(this.Ea[6]&2);this.Ag=0!==(this.Ea[6]&4);this.Ze=0!==(this.Ea[6]&8);this.Ra=this.Ea[6]>>4|this.Ea[7]&240;c=!1;for(b=
8;16>b;b++)if(0!==this.Ea[b]){c=!0;break}c&&(this.Ra&=15);this.b=Array(this.K);var d=16;for(b=0;b<this.K;b++){this.b[b]=new Uint8Array(16384);for(c=0;16384>c&&!(d+c>=a.length);c++)this.b[b][c]=a.charCodeAt(d+c)&255;d+=16384}this.Ya=Array(this.B);for(b=0;b<this.B;b++){this.Ya[b]=new Uint8Array(4096);for(c=0;4096>c&&!(d+c>=a.length);c++)this.Ya[b][c]=a.charCodeAt(d+c)&255;d+=4096}this.Mb=Array(this.B);for(b=0;b<this.B;b++)for(this.Mb[b]=Array(256),c=0;256>c;c++)this.Mb[b][c]=new h.Y.be;for(a=0;a<this.B;a++)for(b=
0;4096>b;b++)c=b>>4,d=b%16,8>d?W(this.Mb[a][c],d,this.Ya[a][b],this.Ya[a][b+8]):W(this.Mb[a][c],d-8,this.Ya[a][b-8],this.Ya[a][b]);this.valid=!0}}};h.Ff=function(a){this.a=a;this.enable=function(){};this.Ma=function(){};this.uf=function(){};this.vf=function(){}};
"undefined"!==typeof jQuery&&function(a){a.fn.pg=function(b){function c(c){var f=this;f.a=c;f.root=a("<div></div>");f.screen=a('<canvas class="nes-screen" width="256" height="240"></canvas>').appendTo(f.root);f.screen[0].getContext?(f.wg=a('<div class="nes-roms"></div>').appendTo(f.root),f.Yc=a("<select></select>").appendTo(f.wg),f.controls=a('<div class="nes-controls"></div>').appendTo(f.root),f.buttons={pause:a('<input type="button" value="pause" class="nes-pause" disabled="disabled">').appendTo(f.controls),
kf:a('<input type="button" value="restart" class="nes-restart" disabled="disabled">').appendTo(f.controls),cd:a('<input type="button" value="enable sound" class="nes-enablesound">').appendTo(f.controls),zoom:a('<input type="button" value="zoom in" class="nes-zoom">').appendTo(f.controls)},f.status=a('<p class="nes-status">Booting up...</p>').appendTo(f.root),f.root.appendTo(d),f.Yc.change(function(){f.oc()}),f.buttons.pause.click(function(){f.a.yb?(f.a.stop(),f.Ma("Paused"),f.buttons.pause.attr("value",
"resume")):(f.a.start(),f.buttons.pause.attr("value","pause"))}),f.buttons.kf.click(function(){f.a.hf();f.a.start()}),f.buttons.cd.click(function(){f.a.P.emulateSound?(f.a.P.emulateSound=!1,f.buttons.cd.attr("value","enable sound")):(f.a.P.emulateSound=!0,f.buttons.cd.attr("value","disable sound"))}),f.Ee=!1,f.buttons.zoom.click(function(){f.Ee?(f.screen.animate({width:"256px",height:"240px"}),f.buttons.zoom.attr("value","zoom in"),f.Ee=!1):(f.screen.animate({width:"512px",height:"480px"}),f.buttons.zoom.attr("value",
"zoom out"),f.Ee=!0)}),a.offset&&f.screen.mousedown(function(a){f.a.k&&(f.a.k.Hd=!0,f.a.k.Id=a.pageX-f.screen.offset().left,f.a.k.Jd=a.pageY-f.screen.offset().top)}).mouseup(function(){setTimeout(function(){f.a.k&&(f.a.k.Hd=!1,f.a.k.Id=0,f.a.k.Jd=0)},500)}),"undefined"!=typeof b&&f.yg(b),f.Dc=f.screen[0].getContext("2d"),f.Dc.getImageData?(f.pd=f.Dc.getImageData(0,0,256,240),f.vg(),a(document).bind("keydown",function(a){f.a.Qc.$e(a)}).bind("keyup",function(a){f.a.Qc.bf(a)}).bind("keypress",function(a){f.a.Qc.af(a)}),
f.sg=new DynamicAudio({swf:c.P.swfPath+"dynamicaudio.swf"})):d.html("Your browser doesn't support writing pixels directly to the <code>&lt;canvas&gt;</code> tag. Try the latest versions of Google Chrome, Safari, Opera or Firefox!")):d.html("Your browser doesn't support the <code>&lt;canvas&gt;</code> tag. Try Google Chrome, Safari, Opera or Firefox!")}var d=this;c.prototype={oc:function(){var b=this;b.Ma("Downloading...");a.ajax({url:escape(b.Yc.val()),xhr:function(){var c=a.ajaxSettings.xhr();"undefined"!==
typeof c.overrideMimeType&&c.overrideMimeType("text/plain; charset=x-user-defined");return b.xhr=c},complete:function(a){h.sa.tg()?(a=JSNESBinaryToArray(a.responseBody).toArray(),a=String.fromCharCode.apply(void 0,a)):a=a.responseText;b.a.Gd(a);b.a.start();b.enable()}})},vg:function(){this.Dc.fillStyle="black";this.Dc.fillRect(0,0,256,240);for(var a=3;a<this.pd.data.length-3;a+=4)this.pd.data[a]=255},enable:function(){this.buttons.pause.attr("disabled",null);this.a.yb?this.buttons.pause.attr("value",
"pause"):this.buttons.pause.attr("value","resume");this.buttons.kf.attr("disabled",null);this.a.P.emulateSound?this.buttons.cd.attr("value","disable sound"):this.buttons.cd.attr("value","enable sound")},Ma:function(a){this.status.text(a)},yg:function(b){this.Yc.children().remove();a("<option>Select a ROM...</option>").appendTo(this.Yc);for(var c in b)if(b.hasOwnProperty(c)){for(var d=a("<optgroup></optgroup>").attr("label",c),l=0;l<b[c].length;l++)a("<option>"+b[c][l][0]+"</option>").attr("value",
b[c][l][1]).appendTo(d);this.Yc.append(d)}},uf:function(a){return this.sg.writeInt(a)},vf:function(a,b){var c=this.pd.data,d,m,n;for(m=0;61440>m;m++)d=a[m],d!=b[m]&&(n=4*m,c[n]=d&255,c[n+1]=d>>8&255,c[n+2]=d>>16&255,b[m]=d);this.Dc.putImageData(this.pd,0,0)}};return c}}(jQuery);window.$=$;$.fn.JSNESUI=$.fn.pg;window.JSNES=h;h.prototype.loadRom=h.prototype.Gd;h.prototype.start=h.prototype.start;h.prototype.frame=h.prototype.frame;h.prototype.reloadRom=h.prototype.hf;h.prototype.stop=h.prototype.stop;h.prototype.toJSON=h.prototype.toJSON;h.prototype.fromJSON=h.prototype.F;h.CPU=h.lb;h.CPU.prototype.toJSON=h.lb.prototype.toJSON;h.CPU.prototype.fromJSON=h.lb.prototype.F;h.PPU=h.Y;h.PPU.prototype.toJSON=h.Y.prototype.toJSON;h.PPU.prototype.fromJSON=h.Y.prototype.F;
h.Keyboard=h.ec;h.Keyboard.prototype.keyDown=h.ec.prototype.$e;h.Keyboard.prototype.keyUp=h.ec.prototype.bf;h.Keyboard.prototype.keyPress=h.ec.prototype.af;h.prototype.isRunning=h.prototype.yb;h.prototype.fpsFrameCount=h.prototype.Jc;h.prototype.limitFrames=h.prototype.Eg;h.prototype.romData=h.prototype.Xc;h.prototype.reset=h.prototype.reset;h.prototype.printFps=h.prototype.se;h.prototype.resetFps=h.prototype.jf;h.prototype.setFramerate=h.prototype.xg;h.prototype.setLimitFrames=h.prototype.Gg;
