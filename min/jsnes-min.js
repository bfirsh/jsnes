/*
JSNES, based on Jamie Sanders' vNES
Copyright (C) 2010 Ben Firshman

This program is free software: you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License
along with this program.  If not, see <http://www.gnu.org/licenses/>.
*/
'use strict';function g(a){this.Q={ui:g.Of,swfPath:"lib/",preferredFrameRate:60,fpsInterval:500,showDisplay:!0,emulateSound:!1,sampleRate:44100,CPU_FREQ_NTSC:1789772.5,CPU_FREQ_PAL:1773447.4};if("undefined"!=typeof a)for(var c in this.Q)"undefined"!=typeof a[c]&&(this.Q[c]=a[c]);this.lc=1E3/this.Q.preferredFrameRate;this.ui=new this.Q.ui(this);this.h=new g.mb(this);this.o=new g.Z(this);this.H=new g.Y(this);this.l=null;this.Rc=new g.fc;this.ui.Oa("Ready to load a ROM.")}g.VERSION="c4d61f5bf1042f8402ee";
g.prototype={Wb:!1,Lc:0,Yc:null,reset:function(){null!==this.l&&this.l.reset();this.h.reset();this.o.reset();this.H.reset()},start:function(){var a=this;null!==this.b&&this.b.valid?this.Wb||(this.Wb=!0,this.Cg=setInterval(function(){a.frame()},this.lc),this.sf(),this.ue(),this.fpsInterval=setInterval(function(){a.ue()},this.Q.fpsInterval)):this.ui.Oa("There is no ROM loaded, or it is invalid.")},frame:function(){var a=this.o,c=0;if(0===a.Ub)c=a.Pc[0];else switch(a.Jc){case 0:c=0;break;case 1:c=65280;
break;case 2:c=16711680;break;case 3:c=0;break;case 4:c=255;break;default:c=0}var d=a.buffer,f;for(f=0;61440>f;f++)d[f]=c;a=a.pa;for(f=0;f<a.length;f++)a[f]=65;var b=0;f=this.Q.emulateSound;a=this.h;c=this.o;d=this.H;a:for(;;){if(0===a.na){b:{var b=a,e=void 0,m=void 0;if(b.oc){e=b.q|(0===b.g?1:0)<<1|b.ja<<2|b.Qa<<3|b.Fa<<4|b.Ra<<5|b.ka<<6|b.f<<7;b.W=b.j;b.yc=b.ja;switch(b.Cd){case 0:if(0!=b.ja)break;var k=b;k.W++;k.push(k.W>>8&255);k.push(k.W&255);k.push(e);k.yc=1;k.hd=0;k.W=k.a.l.load(65534)|k.a.l.load(65535)<<
8;k.W--;break;case 1:k=b;0!=(k.a.l.load(8192)&128)&&(k.W++,k.push(k.W>>8&255),k.push(k.W&255),k.push(e),k.W=k.a.l.load(65530)|k.a.l.load(65531)<<8,k.W--);break;case 2:e=b,e.W=e.a.l.load(65532)|e.a.l.load(65533)<<8,e.W--}b.j=b.W;b.ja=b.yc;b.Fa=b.hd;b.oc=!1}var e=b.rc[b.a.l.load(b.j+1)],k=e>>24,m=0,n=e>>8&255,p=b.j;b.j+=e>>16&255;var l=0;switch(n){case 0:l=b.load(p+2);break;case 1:l=b.load(p+2);l=128>l?l+b.j:l+(b.j-256);break;case 3:l=h(b,p+2);break;case 4:l=b.d;break;case 5:l=b.j;break;case 6:l=b.load(p+
2)+b.s&255;break;case 7:l=b.load(p+2)+b.w&255;break;case 8:l=h(b,p+2);(l&65280)!=(l+b.s&65280)&&(m=1);l+=b.s;break;case 9:l=h(b,p+2);(l&65280)!=(l+b.w&65280)&&(m=1);l+=b.w;break;case 10:l=b.load(p+2);(l&65280)!=(l+b.s&65280)&&(m=1);l+=b.s;l&=255;l=h(b,l);break;case 11:l=h(b,b.load(p+2));(l&65280)!=(l+b.w&65280)&&(m=1);l+=b.w;break;case 12:l=h(b,p+2),l=8191>l?b.p[l]+(b.p[l&65280|(l&255)+1&255]<<8):b.a.l.load(l)+(b.a.l.load(l&65280|(l&255)+1&255)<<8)}l&=65535;switch(e&255){case 0:e=b.d+b.load(l)+b.q;
b.ka=0==((b.d^b.load(l))&128)&&0!=((b.d^e)&128)?1:0;b.q=255<e?1:0;b.f=e>>7&1;b.g=e&255;b.d=e&255;k+=m;break;case 1:b.d&=b.load(l);b.f=b.d>>7&1;b.g=b.d;11!=n&&(k+=m);break;case 2:4==n?(b.q=b.d>>7&1,b.d=b.d<<1&255,b.f=b.d>>7&1,b.g=b.d):(e=b.load(l),b.q=e>>7&1,e=e<<1&255,b.f=e>>7&1,b.g=e,b.write(l,e));break;case 3:0==b.q&&(k+=(p&65280)!=(l&65280)?2:1,b.j=l);break;case 4:1==b.q&&(k+=(p&65280)!=(l&65280)?2:1,b.j=l);break;case 5:0==b.g&&(k+=(p&65280)!=(l&65280)?2:1,b.j=l);break;case 6:e=b.load(l);b.f=e>>
7&1;b.ka=e>>6&1;e&=b.d;b.g=e;break;case 7:1==b.f&&(k++,b.j=l);break;case 8:0!=b.g&&(k+=(p&65280)!=(l&65280)?2:1,b.j=l);break;case 9:0==b.f&&(k+=(p&65280)!=(l&65280)?2:1,b.j=l);break;case 10:b.j+=2;b.push(b.j>>8&255);b.push(b.j&255);b.Fa=1;b.push(b.q|(0==b.g?1:0)<<1|b.ja<<2|b.Qa<<3|b.Fa<<4|b.Ra<<5|b.ka<<6|b.f<<7);b.ja=1;b.j=h(b,65534);b.j--;break;case 11:0==b.ka&&(k+=(p&65280)!=(l&65280)?2:1,b.j=l);break;case 12:1==b.ka&&(k+=(p&65280)!=(l&65280)?2:1,b.j=l);break;case 13:b.q=0;break;case 14:b.Qa=0;
break;case 15:b.ja=0;break;case 16:b.ka=0;break;case 17:e=b.d-b.load(l);b.q=0<=e?1:0;b.f=e>>7&1;b.g=e&255;k+=m;break;case 18:e=b.s-b.load(l);b.q=0<=e?1:0;b.f=e>>7&1;b.g=e&255;break;case 19:e=b.w-b.load(l);b.q=0<=e?1:0;b.f=e>>7&1;b.g=e&255;break;case 20:e=b.load(l)-1&255;b.f=e>>7&1;b.g=e;b.write(l,e);break;case 21:b.s=b.s-1&255;b.f=b.s>>7&1;b.g=b.s;break;case 22:b.w=b.w-1&255;b.f=b.w>>7&1;b.g=b.w;break;case 23:b.d=(b.load(l)^b.d)&255;b.f=b.d>>7&1;b.g=b.d;k+=m;break;case 24:e=b.load(l)+1&255;b.f=e>>
7&1;b.g=e;b.write(l,e&255);break;case 25:b.s=b.s+1&255;b.f=b.s>>7&1;b.g=b.s;break;case 26:b.w++;b.w&=255;b.f=b.w>>7&1;b.g=b.w;break;case 27:b.j=l-1;break;case 28:b.push(b.j>>8&255);b.push(b.j&255);b.j=l-1;break;case 29:b.d=b.load(l);b.f=b.d>>7&1;b.g=b.d;k+=m;break;case 30:b.s=b.load(l);b.f=b.s>>7&1;b.g=b.s;k+=m;break;case 31:b.w=b.load(l);b.f=b.w>>7&1;b.g=b.w;k+=m;break;case 32:4==n?(e=b.d&255,b.q=e&1,e>>=1,b.d=e):(e=b.load(l)&255,b.q=e&1,e>>=1,b.write(l,e));b.f=0;b.g=e;break;case 33:break;case 34:e=
(b.load(l)|b.d)&255;b.f=e>>7&1;b.g=e;b.d=e;11!=n&&(k+=m);break;case 35:b.push(b.d);break;case 36:b.Fa=1;b.push(b.q|(0==b.g?1:0)<<1|b.ja<<2|b.Qa<<3|b.Fa<<4|b.Ra<<5|b.ka<<6|b.f<<7);break;case 37:b.d=q(b);b.f=b.d>>7&1;b.g=b.d;break;case 38:e=q(b);b.q=e&1;b.g=1==(e>>1&1)?0:1;b.ja=e>>2&1;b.Qa=e>>3&1;b.Fa=e>>4&1;b.Ra=e>>5&1;b.ka=e>>6&1;b.f=e>>7&1;b.Ra=1;break;case 39:4==n?(e=b.d,m=b.q,b.q=e>>7&1,e=(e<<1&255)+m,b.d=e):(e=b.load(l),m=b.q,b.q=e>>7&1,e=(e<<1&255)+m,b.write(l,e));b.f=e>>7&1;b.g=e;break;case 40:4==
n?(m=b.q<<7,b.q=b.d&1,e=(b.d>>1)+m,b.d=e):(e=b.load(l),m=b.q<<7,b.q=e&1,e=(e>>1)+m,b.write(l,e));b.f=e>>7&1;b.g=e;break;case 41:e=q(b);b.q=e&1;b.g=0==(e>>1&1)?1:0;b.ja=e>>2&1;b.Qa=e>>3&1;b.Fa=e>>4&1;b.Ra=e>>5&1;b.ka=e>>6&1;b.f=e>>7&1;b.j=q(b);b.j+=q(b)<<8;if(65535==b.j){b=void 0;break b}b.j--;b.Ra=1;break;case 42:b.j=q(b);b.j+=q(b)<<8;if(65535==b.j){b=void 0;break b}break;case 43:e=b.d-b.load(l)-(1-b.q);b.f=e>>7&1;b.g=e&255;b.ka=0!=((b.d^e)&128)&&0!=((b.d^b.load(l))&128)?1:0;b.q=0>e?0:1;b.d=e&255;
11!=n&&(k+=m);break;case 44:b.q=1;break;case 45:b.Qa=1;break;case 46:b.ja=1;break;case 47:b.write(l,b.d);break;case 48:b.write(l,b.s);break;case 49:b.write(l,b.w);break;case 50:b.s=b.d;b.f=b.d>>7&1;b.g=b.d;break;case 51:b.w=b.d;b.f=b.d>>7&1;b.g=b.d;break;case 52:b.s=b.aa-256;b.f=b.aa>>7&1;b.g=b.s;break;case 53:b.d=b.s;b.f=b.s>>7&1;b.g=b.s;break;case 54:b.aa=b.s+256;b.aa=256|b.aa&255;break;case 55:b.d=b.w;b.f=b.w>>7&1;b.g=b.w;break;default:b.a.stop(),b.a.Mg="Game crashed, invalid opcode at address $"+
p.toString(16)}b=k}f&&s(d,b);b*=3}else 8<a.na?(b=24,f&&s(d,8),a.na-=8):(b=3*a.na,f&&s(d,a.na),a.na=0);for(;0<b;b--){c.Rb===c.Ka&&1===c.ya&&c.M-21===c.La&&u(c,c.df,!0);if(c.Xc&&(c.Sc--,0===c.Sc)){c.Xc=!1;f=c;w(f.a.h,f.a.h.xg);239>f.fb&&x(f,f.fb+1,240-f.fb);a=f;b=d=d=void 0;c=a.buffer;if(a.Jg){if(0<=a.ma[0]&&256>a.ma[0]&&0<=a.u[0]&&240>a.u[0]){for(d=0;256>d;d++)c[(a.u[0]<<8)+d]=16733525;for(d=0;240>d;d++)c[(d<<8)+a.ma[0]]=16733525}if(0<=a.Ka&&256>a.Ka&&0<=a.La&&240>a.La){for(d=0;256>d;d++)c[(a.La<<
8)+d]=5635925;for(d=0;240>d;d++)c[(d<<8)+a.Ka]=5635925}}if(a.ge||0===a.xd||0===a.yd)for(b=0;240>b;b++)for(d=0;8>d;d++)c[(b<<8)+d]=0;if(a.ge)for(b=0;240>b;b++)for(d=0;8>d;d++)c[(b<<8)+255-d]=0;if(a.ge)for(b=0;8>b;b++)for(d=0;256>d;d++)c[(b<<8)+d]=0,c[(239-b<<8)+d]=0;a.a.Q.showDisplay&&a.a.ui.Ef(c,a.pf);f.fb=-1;break a}c.Rb++;if(341===c.Rb){c.Rb=0;e=c;switch(e.M){case 19:e.Hc&&(e.Rb=1,e.Hc=!e.Hc);break;case 20:u(e,e.ce,!1);u(e,e.df,!1);e.Oc=!1;e.Ka=-1;e.La=-1;if(1==e.Sa||1==e.ya)e.va=e.Db,e.ca=e.Eb,
e.ba=e.Ua,e.T=e.fa,e.wa=e.Va,1==e.Sa&&y(e,!1,0);1==e.Sa&&1==e.ya&&z(e,0);1!=e.Sa&&1!=e.ya||e.a.l.he();break;case 261:u(e,e.ce,!0);e.Xc=!0;e.Sc=9;e.M=-1;break;default:21<=e.M&&260>=e.M&&(1==e.Sa&&(e.Rd||(e.wa=e.Va,e.ba=e.Ua,y(e,!0,e.M+1-21)),e.Rd=!1,!e.Oc&&1==e.ya&&-7<=e.ma[0]&&256>e.ma[0]&&e.u[0]+1<=e.M-20&&e.u[0]+1+(0===e.kc?8:16)>=e.M-20&&z(e,e.M-20)&&(e.Oc=!0)),1!=e.Sa&&1!=e.ya||e.a.l.he())}e.M++;A(e);C(e)}}}this.Lc++},ue:function(){var a=+new Date,c="Running";this.qe&&(c+=": "+(this.Lc/((a-this.qe)/
1E3)).toFixed(2)+" FPS");this.ui.Oa(c);this.Lc=0;this.qe=a},stop:function(){clearInterval(this.Cg);clearInterval(this.fpsInterval);this.Wb=!1},rf:function(){null!==this.Yc&&this.Hd(this.Yc)},Hd:function(a){this.Wb&&this.stop();this.ui.Oa("Loading ROM...");this.b=new g.bf(this);this.b.load(a);if(this.b.valid){this.reset();var c;c=this.b;"undefined"!==typeof g.n[c.Ta]?c=new g.n[c.Ta](c.a):(c.a.ui.Oa("This ROM uses a mapper not supported by JSNES: "+(0<=c.Ta&&c.Ta<c.i.length?c.i[c.Ta]:"Unknown Mapper, "+
c.Ta)+"("+c.Ta+")"),c=null);this.l=c;if(!this.l)return;this.l.qc();c=this.b;D(this.o,c.hf?c.Pf:0===c.gb?c.jd:c.od);this.Yc=a;this.ui.Oa("Successfully loaded. Ready to be started.")}else this.ui.Oa("Invalid ROM!");return this.b.valid},sf:function(){this.qe=null;this.Lc=0},Hg:function(a){this.Q.preferredFrameRate=a;this.lc=1E3/a;this.H.Rg(this.Q.sampleRate,!1)},toJSON:function(){return{romData:this.Yc,cpu:this.h.toJSON(),mmap:this.l.toJSON(),ppu:this.o.toJSON()}},G:function(a){this.Hd(a.romData);this.h.G(a.cpu);
this.l.G(a.mmap);this.o.G(a.ppu)}};g.ta={Pb:function(a,c,d,f,b){for(var e=0;e<b;++e)d[f+e]=a[c+e]},Lg:function(a){for(var c=Array(a.length),d=0;d<a.length;d++)c[d]=a[d];return c},G:function(a,c){for(var d in a.Ob)a.Ob.hasOwnProperty(d)&&(a[d]=c[a.Ob[d]])},toJSON:function(a){var c={},d;for(d in a.Ob)a.Ob.hasOwnProperty(d)&&(c[a.Ob[d]]=a[d]);return c},Dg:function(){return/msie/i.test(navigator.userAgent)&&!/opera/i.test(navigator.userAgent)}};g.mb=function(a){this.a=a;this.Cd=this.oc=this.na=this.rc=this.hd=this.Fa=this.Le=this.Ra=this.g=this.f=this.ka=this.yc=this.ja=this.Qa=this.q=this.af=this.W=this.j=this.aa=this.w=this.s=this.d=this.p=null;this.reset()};
g.mb.prototype={md:0,xg:1,nd:2,reset:function(){this.p=Array(65536);for(var a=0;8192>a;a++)this.p[a]=255;for(var c=0;4>c;c++)a=2048*c,this.p[a+8]=247,this.p[a+9]=239,this.p[a+10]=223,this.p[a+15]=191;for(a=8193;a<this.p.length;a++)this.p[a]=0;this.w=this.s=this.d=0;this.aa=511;this.W=this.j=32767;this.af=40;this.ja=this.g=this.q=0;this.Qa=1;this.Fa=0;this.Ra=1;this.Qa=this.q=this.f=this.ka=0;this.yc=this.ja=1;this.f=this.ka=0;this.hd=this.Fa=this.Le=this.Ra=this.g=1;this.rc=(new g.mb.Ze).rc;this.na=
0;this.oc=!1;this.Cd=null},load:function(a){return 8192>a?this.p[a&2047]:this.a.l.load(a)},write:function(a,c){8192>a?this.p[a&2047]=c:this.a.l.write(a,c)},push:function(a){this.a.l.write(this.aa,a);this.aa--;this.aa=256|this.aa&255},Ob:{p:"mem",na:"cyclesToHalt",oc:"irqRequested",Cd:"irqType",d:"REG_ACC",s:"REG_X",w:"REG_Y",aa:"REG_SP",j:"REG_PC",W:"REG_PC_NEW",af:"REG_STATUS",q:"F_CARRY",Qa:"F_DECIMAL",ja:"F_INTERRUPT",yc:"F_INTERRUPT_NEW",ka:"F_OVERFLOW",f:"F_SIGN",g:"F_ZERO",Ra:"F_NOTUSED",Le:"F_NOTUSED_NEW",
Fa:"F_BRK",hd:"F_BRK_NEW"},toJSON:function(){return g.ta.toJSON(this)},G:function(a){g.ta.G(this,a)}};function q(a){a.aa++;a.aa=256|a.aa&255;return a.a.l.load(a.aa)}function w(a,c){a.oc&&c==a.md||(a.oc=!0,a.Cd=c)}function h(a,c){return 8191>c?a.p[c&2047]|a.p[c+1&2047]<<8:a.a.l.load(c)|a.a.l.load(c+1)<<8}
g.mb.Ze=function(){this.rc=Array(256);for(var a=0;256>a;a++)this.rc[a]=255;G(this,this.nb,105,this.Ea,2,2);G(this,this.nb,101,this.D,2,3);G(this,this.nb,117,this.V,2,4);G(this,this.nb,109,this.A,3,4);G(this,this.nb,125,this.X,3,4);G(this,this.nb,121,this.$a,3,4);G(this,this.nb,97,this.kb,2,6);G(this,this.nb,113,this.jb,2,5);G(this,this.ob,41,this.Ea,2,2);G(this,this.ob,37,this.D,2,3);G(this,this.ob,53,this.V,2,4);G(this,this.ob,45,this.A,3,4);G(this,this.ob,61,this.X,3,4);G(this,this.ob,57,this.$a,
3,4);G(this,this.ob,33,this.kb,2,6);G(this,this.ob,49,this.jb,2,5);G(this,this.zc,10,this.gd,1,2);G(this,this.zc,6,this.D,2,5);G(this,this.zc,22,this.V,2,6);G(this,this.zc,14,this.A,3,6);G(this,this.zc,30,this.X,3,7);G(this,this.Qf,144,this.lb,2,2);G(this,this.Rf,176,this.lb,2,2);G(this,this.Sf,240,this.lb,2,2);G(this,this.Me,36,this.D,2,3);G(this,this.Me,44,this.A,3,4);G(this,this.Tf,48,this.lb,2,2);G(this,this.Uf,208,this.lb,2,2);G(this,this.Vf,16,this.lb,2,2);G(this,this.Wf,0,this.v,1,7);G(this,
this.Xf,80,this.lb,2,2);G(this,this.Yf,112,this.lb,2,2);G(this,this.Zf,24,this.v,1,2);G(this,this.$f,216,this.v,1,2);G(this,this.ag,88,this.v,1,2);G(this,this.bg,184,this.v,1,2);G(this,this.pb,201,this.Ea,2,2);G(this,this.pb,197,this.D,2,3);G(this,this.pb,213,this.V,2,4);G(this,this.pb,205,this.A,3,4);G(this,this.pb,221,this.X,3,4);G(this,this.pb,217,this.$a,3,4);G(this,this.pb,193,this.kb,2,6);G(this,this.pb,209,this.jb,2,5);G(this,this.Yd,224,this.Ea,2,2);G(this,this.Yd,228,this.D,2,3);G(this,this.Yd,
236,this.A,3,4);G(this,this.Zd,192,this.Ea,2,2);G(this,this.Zd,196,this.D,2,3);G(this,this.Zd,204,this.A,3,4);G(this,this.kd,198,this.D,2,5);G(this,this.kd,214,this.V,2,6);G(this,this.kd,206,this.A,3,6);G(this,this.kd,222,this.X,3,7);G(this,this.cg,202,this.v,1,2);G(this,this.dg,136,this.v,1,2);G(this,this.qb,73,this.Ea,2,2);G(this,this.qb,69,this.D,2,3);G(this,this.qb,85,this.V,2,4);G(this,this.qb,77,this.A,3,4);G(this,this.qb,93,this.X,3,4);G(this,this.qb,89,this.$a,3,4);G(this,this.qb,65,this.kb,
2,6);G(this,this.qb,81,this.jb,2,5);G(this,this.ld,230,this.D,2,5);G(this,this.ld,246,this.V,2,6);G(this,this.ld,238,this.A,3,6);G(this,this.ld,254,this.X,3,7);G(this,this.eg,232,this.v,1,2);G(this,this.fg,200,this.v,1,2);G(this,this.Ne,76,this.A,3,3);G(this,this.Ne,108,this.Ff,3,5);G(this,this.gg,32,this.A,3,6);G(this,this.rb,169,this.Ea,2,2);G(this,this.rb,165,this.D,2,3);G(this,this.rb,181,this.V,2,4);G(this,this.rb,173,this.A,3,4);G(this,this.rb,189,this.X,3,4);G(this,this.rb,185,this.$a,3,4);
G(this,this.rb,161,this.kb,2,6);G(this,this.rb,177,this.jb,2,5);G(this,this.Ac,162,this.Ea,2,2);G(this,this.Ac,166,this.D,2,3);G(this,this.Ac,182,this.He,2,4);G(this,this.Ac,174,this.A,3,4);G(this,this.Ac,190,this.$a,3,4);G(this,this.Bc,160,this.Ea,2,2);G(this,this.Bc,164,this.D,2,3);G(this,this.Bc,180,this.V,2,4);G(this,this.Bc,172,this.A,3,4);G(this,this.Bc,188,this.X,3,4);G(this,this.Cc,74,this.gd,1,2);G(this,this.Cc,70,this.D,2,5);G(this,this.Cc,86,this.V,2,6);G(this,this.Cc,78,this.A,3,6);G(this,
this.Cc,94,this.X,3,7);G(this,this.hg,234,this.v,1,2);G(this,this.sb,9,this.Ea,2,2);G(this,this.sb,5,this.D,2,3);G(this,this.sb,21,this.V,2,4);G(this,this.sb,13,this.A,3,4);G(this,this.sb,29,this.X,3,4);G(this,this.sb,25,this.$a,3,4);G(this,this.sb,1,this.kb,2,6);G(this,this.sb,17,this.jb,2,5);G(this,this.ig,72,this.v,1,3);G(this,this.jg,8,this.v,1,3);G(this,this.kg,104,this.v,1,4);G(this,this.lg,40,this.v,1,4);G(this,this.Dc,42,this.gd,1,2);G(this,this.Dc,38,this.D,2,5);G(this,this.Dc,54,this.V,
2,6);G(this,this.Dc,46,this.A,3,6);G(this,this.Dc,62,this.X,3,7);G(this,this.Ec,106,this.gd,1,2);G(this,this.Ec,102,this.D,2,5);G(this,this.Ec,118,this.V,2,6);G(this,this.Ec,110,this.A,3,6);G(this,this.Ec,126,this.X,3,7);G(this,this.mg,64,this.v,1,6);G(this,this.ng,96,this.v,1,6);G(this,this.tb,233,this.Ea,2,2);G(this,this.tb,229,this.D,2,3);G(this,this.tb,245,this.V,2,4);G(this,this.tb,237,this.A,3,4);G(this,this.tb,253,this.X,3,4);G(this,this.tb,249,this.$a,3,4);G(this,this.tb,225,this.kb,2,6);
G(this,this.tb,241,this.jb,2,5);G(this,this.og,56,this.v,1,2);G(this,this.pg,248,this.v,1,2);G(this,this.qg,120,this.v,1,2);G(this,this.Nb,133,this.D,2,3);G(this,this.Nb,149,this.V,2,4);G(this,this.Nb,141,this.A,3,4);G(this,this.Nb,157,this.X,3,5);G(this,this.Nb,153,this.$a,3,5);G(this,this.Nb,129,this.kb,2,6);G(this,this.Nb,145,this.jb,2,6);G(this,this.$d,134,this.D,2,3);G(this,this.$d,150,this.He,2,4);G(this,this.$d,142,this.A,3,4);G(this,this.ae,132,this.D,2,3);G(this,this.ae,148,this.V,2,4);G(this,
this.ae,140,this.A,3,4);G(this,this.rg,170,this.v,1,2);G(this,this.sg,168,this.v,1,2);G(this,this.tg,186,this.v,1,2);G(this,this.ug,138,this.v,1,2);G(this,this.vg,154,this.v,1,2);G(this,this.wg,152,this.v,1,2);this.c=Array(56);this.c[0]="ADC";this.c[1]="AND";this.c[2]="ASL";this.c[3]="BCC";this.c[4]="BCS";this.c[5]="BEQ";this.c[6]="BIT";this.c[7]="BMI";this.c[8]="BNE";this.c[9]="BPL";this.c[10]="BRK";this.c[11]="BVC";this.c[12]="BVS";this.c[13]="CLC";this.c[14]="CLD";this.c[15]="CLI";this.c[16]="CLV";
this.c[17]="CMP";this.c[18]="CPX";this.c[19]="CPY";this.c[20]="DEC";this.c[21]="DEX";this.c[22]="DEY";this.c[23]="EOR";this.c[24]="INC";this.c[25]="INX";this.c[26]="INY";this.c[27]="JMP";this.c[28]="JSR";this.c[29]="LDA";this.c[30]="LDX";this.c[31]="LDY";this.c[32]="LSR";this.c[33]="NOP";this.c[34]="ORA";this.c[35]="PHA";this.c[36]="PHP";this.c[37]="PLA";this.c[38]="PLP";this.c[39]="ROL";this.c[40]="ROR";this.c[41]="RTI";this.c[42]="RTS";this.c[43]="SBC";this.c[44]="SEC";this.c[45]="SED";this.c[46]=
"SEI";this.c[47]="STA";this.c[48]="STX";this.c[49]="STY";this.c[50]="TAX";this.c[51]="TAY";this.c[52]="TSX";this.c[53]="TXA";this.c[54]="TXS";this.c[55]="TYA"};
g.mb.Ze.prototype={nb:0,ob:1,zc:2,Qf:3,Rf:4,Sf:5,Me:6,Tf:7,Uf:8,Vf:9,Wf:10,Xf:11,Yf:12,Zf:13,$f:14,ag:15,bg:16,pb:17,Yd:18,Zd:19,kd:20,cg:21,dg:22,qb:23,ld:24,eg:25,fg:26,Ne:27,gg:28,rb:29,Ac:30,Bc:31,Cc:32,hg:33,sb:34,ig:35,jg:36,kg:37,lg:38,Dc:39,Ec:40,mg:41,ng:42,tb:43,og:44,pg:45,qg:46,Nb:47,$d:48,ae:49,rg:50,sg:51,tg:52,ug:53,vg:54,wg:55,D:0,lb:1,v:2,A:3,gd:4,Ea:5,V:6,He:7,X:8,$a:9,kb:10,jb:11,Ff:12};function G(a,c,d,f,b,e){a.rc[d]=c&255|(f&255)<<8|(b&255)<<16|(e&255)<<24};g.fc=function(){var a;this.keys={Oe:0,be:1,Se:2,Te:3,Ue:4,Pe:5,Qe:6,Re:7};this.Da=Array(8);for(a=0;a<this.Da.length;a++)this.Da[a]=64;this.Na=Array(8);for(a=0;a<this.Na.length;a++)this.Na[a]=64};g.fc.prototype={jf:function(a){!H(this,a.keyCode,65)&&a.preventDefault&&a.preventDefault()},lf:function(a){!H(this,a.keyCode,64)&&a.preventDefault&&a.preventDefault()},kf:function(a){a.preventDefault()}};
function H(a,c,d){switch(c){case 88:a.Da[a.keys.Oe]=d;break;case 89:a.Da[a.keys.be]=d;break;case 90:a.Da[a.keys.be]=d;break;case 17:a.Da[a.keys.Se]=d;break;case 13:a.Da[a.keys.Te]=d;break;case 38:a.Da[a.keys.Ue]=d;break;case 40:a.Da[a.keys.Pe]=d;break;case 37:a.Da[a.keys.Qe]=d;break;case 39:a.Da[a.keys.Re]=d;break;case 103:a.Na[a.keys.Oe]=d;break;case 105:a.Na[a.keys.be]=d;break;case 99:a.Na[a.keys.Se]=d;break;case 97:a.Na[a.keys.Te]=d;break;case 104:a.Na[a.keys.Ue]=d;break;case 98:a.Na[a.keys.Pe]=
d;break;case 100:a.Na[a.keys.Qe]=d;break;case 102:a.Na[a.keys.Re]=d;break;default:return!0}return!1};g.n={};g.n[0]=function(a){this.a=a};
g.n[0].prototype={reset:function(){this.Dd=this.Ab=this.zb=0;this.Id=!1;this.Kd=this.Jd=null},write:function(a,c){8192>a?this.a.h.p[a&2047]=c:16407<a?this.a.h.p[a]=c:8199<a&&16384>a?I(this,8192+(a&7),c):I(this,a,c)},Sg:function(a,c){8192>a?this.a.h.p[a&2047]=c:16407<a?this.a.h.p[a]=c:8199<a&&16384>a?I(this,8192+(a&7),c):I(this,a,c)},load:function(a){a&=65535;return 16407<a?this.a.h.p[a]:8192<=a?aa(this,a):this.a.h.p[a&2047]},qc:function(){!this.a.b.valid||1>this.a.b.L?alert("NoMapper: Invalid ROM! Unable to load."):
(1<this.a.b.L?(J(this,0,32768),J(this,1,49152)):(J(this,0,32768),J(this,0,49152)),K(this),L(this),w(this.a.h,this.a.h.nd))},Pg:function(a,c){if(0!==this.a.b.C){M(this.a.o);var d=Math.floor(a/2)%this.a.b.C;g.ta.Pb(this.a.b.Za[d],a%2*2048,this.a.o.R,c,2048);for(var d=this.a.b.Mb[d],f=c>>4,b=0;128>b;b++)this.a.o.K[f+b]=d[(a%2<<7)+b]}},he:function(){},Ng:function(){},toJSON:function(){return{joy1StrobeState:this.zb,joy2StrobeState:this.Ab,joypadLastWrite:this.Dd}},G:function(a){this.zb=a.joy1StrobeState;
this.Ab=a.joy2StrobeState;this.Dd=a.joypadLastWrite}};function N(a,c,d){g.ta.Pb(a.a.b.b[Math.floor(c/2)%a.a.b.L],c%2*8192,a.a.h.p,d,8192)}function O(a,c,d){if(0!==a.a.b.C){M(a.a.o);var f=Math.floor(c/4)%a.a.b.C;g.ta.Pb(a.a.b.Za[f],0,a.a.o.R,c%4*1024,1024);f=a.a.b.Mb[f];d>>=4;for(var b=0;64>b;b++)a.a.o.K[d+b]=f[(c%4<<6)+b]}}function ba(a,c){0!==a.a.b.C&&(M(a.a.o),P(a,c%a.a.b.C,0),P(a,(c+1)%a.a.b.C,4096))}
function P(a,c,d){0!==a.a.b.C&&(M(a.a.o),g.ta.Pb(a.a.b.Za[c%a.a.b.C],0,a.a.o.R,d,4096),g.ta.Pb(a.a.b.Mb[c%a.a.b.C],0,a.a.o.K,d>>4,256))}function J(a,c,d){c%=a.a.b.L;g.ta.Pb(a.a.b.b[c],0,a.a.h.p,d,16384)}function L(a){if(a.a.b.ee){var c=a.a.b.ee;null!==c&&8192==c.length&&g.ta.Pb(c,0,a.a.h.p,24576,8192)}}function K(a){0<a.a.b.C&&(1==a.a.b.C?(P(a,0,0),P(a,0,4096)):(P(a,0,0),P(a,1,4096)))}
function ca(a){var c;switch(a.Ab){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:c=a.a.Rc.Na[a.Ab];break;case 8:case 9:case 10:case 11:case 12:case 13:case 14:case 15:case 16:case 17:case 18:c=0;break;case 19:c=1;break;default:c=0}a.Ab++;24==a.Ab&&(a.Ab=0);return c}
function I(a,c,d){switch(c){case 8192:a.a.h.p[c]=d;da(a.a.o,d);break;case 8193:a.a.h.p[c]=d;ea(a.a.o,d);break;case 8195:a.a.o.Wa=d;break;case 8196:a=a.a.o;a.ib[a.Wa]=d;Q(a,a.Wa,d);a.Wa++;a.Wa%=256;break;case 8197:a=a.a.o;M(a);a.eb?(a.Va=d>>3&31,a.Wc=d&7):(a.Db=d&7,a.fa=d>>3&31);a.eb=!a.eb;break;case 8198:a=a.a.o;a.eb?(a.Db=d>>4&3,a.Eb=d>>3&1,a.Ua=d>>2&1,a.fa=a.fa&7|(d&3)<<3):(M(a),a.fa=a.fa&24|d>>5&7,a.Va=d&31,a.va=a.Db,a.ca=a.Eb,a.ba=a.Ua,a.T=a.fa,a.wa=a.Va,z(a,a.M-20));a.eb=!a.eb;C(a);break;case 8199:a=
a.a.o;M(a);C(a);A(a);8192<=a.U?(c=a.U,16128<=c&&16160>c?16128==c||16144==c?(S(a,16128,d),S(a,16144,d)):16132==c||16148==c?(S(a,16132,d),S(a,16148,d)):16136==c||16152==c?(S(a,16136,d),S(a,16152,d)):16140==c||16156==c?(S(a,16140,d),S(a,16156,d)):S(a,c,d):c<a.Pa.length?S(a,a.Pa[c],d):alert("Invalid VRAM address: "+c.toString(16))):S(a,a.U,d);a.U+=1==a.Ic?32:1;fa(a);ga(a);break;case 16404:a=a.a.o;d*=256;for(var f=a.Wa;256>f;f++)c=a.a.h.p[d+f],a.ib[f]=c,Q(a,f,c);d=a.a.h;d.na+=513;break;case 16405:a.a.H.S(c,
d);break;case 16406:0===(d&1)&&1===(a.Dd&1)&&(a.zb=0,a.Ab=0);a.Dd=d;break;case 16407:a.a.H.S(c,d);break;default:16384<=c&&16407>=c&&a.a.H.S(c,d)}}
function aa(a,c){switch(c>>12){case 2:case 3:switch(c&7){case 0:return a.a.h.p[8192];case 1:return a.a.h.p[8193];case 2:var d=a.a.o,f=d.a.h.p[8194];d.eb=!0;u(d,d.ce,!1);return f;case 3:return 0;case 4:return d=a.a.o,d.ib[d.Wa];case 5:return 0;case 6:return 0;case 7:return d=a.a.o,C(d),A(d),16127>=d.U?(f=d.Wd,d.Wd=8192>d.U?d.R[d.U]:d.R[d.Pa[d.U]]):f=d.R[d.Pa[d.U]],d.U+=1==d.Ic?32:1,ga(d),fa(d),f}break;case 4:switch(c-16405){case 0:return a.a.H.qf(c);case 1:switch(a.zb){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:d=
a.a.Rc.Da[a.zb];break;case 8:case 9:case 10:case 11:case 12:case 13:case 14:case 15:case 16:case 17:case 18:d=0;break;case 19:d=1;break;default:d=0}a.zb++;24==a.zb&&(a.zb=0);return d;case 2:if(a.Id){for(var d=Math.max(0,a.Jd-4),f=Math.min(256,a.Jd+4),b=Math.max(0,a.Kd-4),e=Math.min(240,a.Kd+4),m=0;b<e;b++)for(var k=d;k<f;k++)if(16777215==a.a.o.buffer[(b<<8)+k]){m|=8;console.debug("Clicked on white!");break}m|=a.Id?16:0;return(ca(a)|m)&65535}return ca(a)}}return 0}g.n[1]=function(a){this.a=a};
g.n[1].prototype=new g.n[0];g.n[1].prototype.reset=function(){g.n[0].prototype.reset.apply(this);this.nf=this.gb=this.Cb=this.bc=0;this.Vc=this.Uc=1;this.uf=this.$c=this.Fb=this.xc=0};
g.n[1].prototype.write=function(a,c){if(32768>a)g.n[0].prototype.write.apply(this,arguments);else if(0!==(c&128))this.bc=this.Cb=0,0===ha(a)&&(this.Vc=this.Uc=1);else if(this.bc=this.bc&255-(1<<this.Cb)|(c&1)<<this.Cb,this.Cb++,5==this.Cb){var d=this.bc,f;switch(ha(a)){case 0:f=d&3;f!==this.gb&&(this.gb=f,0===(this.gb&2)?D(this.a.o,this.a.b.cf):0!==(this.gb&1)?D(this.a.o,this.a.b.jd):D(this.a.o,this.a.b.od));this.Uc=d>>2&1;this.Vc=d>>3&1;this.xc=d>>4&1;break;case 1:this.Fb=d>>4&1;0<this.a.b.C&&(0===
this.xc?0===this.Fb?ba(this,d&15):ba(this,Math.floor(this.a.b.C/2)+(d&15)):0===this.Fb?P(this,d&15,0):P(this,Math.floor(this.a.b.C/2)+(d&15),0));break;case 2:this.$c=d>>4&1;0<this.a.b.C&&1===this.xc&&(0===this.$c?P(this,d&15,4096):P(this,Math.floor(this.a.b.C/2)+(d&15),4096));break;default:f=0,32<=this.a.b.L?0===this.xc?1===this.Fb&&(f=16):f=(this.Fb|this.$c<<1)<<3:16<=this.a.b.L&&1===this.Fb&&(f=8),0===this.Vc?(d=f+(d&15),J(this,2*d%this.a.b.L,32768),J(this,(2*d+1)%this.a.b.L,49152)):(d=2*f+(d&15),
0===this.Uc?J(this,d,49152):J(this,d,32768))}this.Cb=this.bc=0}};function ha(a){return 32768<=a&&40959>=a?0:40960<=a&&49151>=a?1:49152<=a&&57343>=a?2:3}g.n[1].prototype.qc=function(){this.a.b.valid?(J(this,0,32768),J(this,this.a.b.L-1,49152),K(this),L(this),w(this.a.h,this.a.h.nd)):alert("MMC1: Invalid ROM! Unable to load.")};
g.n[1].prototype.toJSON=function(){var a=g.n[0].prototype.toJSON.apply(this);a.mirroring=this.gb;a.oneScreenMirroring=this.nf;a.prgSwitchingArea=this.Uc;a.prgSwitchingSize=this.Vc;a.vromSwitchingSize=this.xc;a.romSelectionReg0=this.Fb;a.romSelectionReg1=this.$c;a.romBankSelect=this.uf;a.regBuffer=this.bc;a.regBufferCounter=this.Cb;return a};
g.n[1].prototype.G=function(a){g.n[0].prototype.G.apply(this,a);this.gb=a.mirroring;this.nf=a.oneScreenMirroring;this.Uc=a.prgSwitchingArea;this.Vc=a.prgSwitchingSize;this.xc=a.vromSwitchingSize;this.Fb=a.romSelectionReg0;this.$c=a.romSelectionReg1;this.uf=a.romBankSelect;this.bc=a.regBuffer;this.Cb=a.regBufferCounter};g.n[2]=function(a){this.a=a};g.n[2].prototype=new g.n[0];g.n[2].prototype.write=function(a,c){32768>a?g.n[0].prototype.write.apply(this,arguments):J(this,c,32768)};
g.n[2].prototype.qc=function(){this.a.b.valid?(J(this,0,32768),J(this,this.a.b.L-1,49152),K(this),w(this.a.h,this.a.h.nd)):alert("UNROM: Invalid ROM! Unable to load.")};g.n[4]=function(a){this.a=a;this.Kf=0;this.Lf=1;this.Gf=2;this.Hf=3;this.If=4;this.Jf=5;this.Mf=6;this.Nf=7;this.Qc=this.Bd=this.nc=this.of=this.ab=this.ac=this.sd=null;this.$b=!1};g.n[4].prototype=new g.n[0];
g.n[4].prototype.write=function(a,c){if(32768>a)g.n[0].prototype.write.apply(this,arguments);else switch(a){case 32768:this.sd=c&7;var d=c>>6&1;d!=this.ac&&(this.$b=!0);this.ac=d;this.ab=c>>7&1;break;case 32769:d=c;switch(this.sd){case this.Kf:0===this.ab?(O(this,d,0),O(this,d+1,1024)):(O(this,d,4096),O(this,d+1,5120));break;case this.Lf:0===this.ab?(O(this,d,2048),O(this,d+1,3072)):(O(this,d,6144),O(this,d+1,7168));break;case this.Gf:0===this.ab?O(this,d,4096):O(this,d,0);break;case this.Hf:0===
this.ab?O(this,d,5120):O(this,d,1024);break;case this.If:0===this.ab?O(this,d,6144):O(this,d,2048);break;case this.Jf:0===this.ab?O(this,d,7168):O(this,d,3072);break;case this.Mf:this.$b&&(0===this.ac?N(this,2*(this.a.b.L-1),49152):N(this,2*(this.a.b.L-1),32768),this.$b=!1);0===this.ac?N(this,d,32768):N(this,d,49152);break;case this.Nf:N(this,d,40960),this.$b&&(0===this.ac?N(this,2*(this.a.b.L-1),49152):N(this,2*(this.a.b.L-1),32768),this.$b=!1)}break;case 40960:0!==(c&1)?D(this.a.o,this.a.b.jd):
D(this.a.o,this.a.b.od);break;case 49152:this.nc=c;break;case 49153:this.Bd=c;break;case 57344:this.Qc=0;break;case 57345:this.Qc=1}};g.n[4].prototype.qc=function(){this.a.b.valid?(N(this,2*(this.a.b.L-1),49152),N(this,2*(this.a.b.L-1)+1,57344),N(this,0,32768),N(this,1,40960),K(this),L(this),w(this.a.h,this.a.h.nd)):alert("MMC3: Invalid ROM! Unable to load.")};g.n[4].prototype.he=function(){1==this.Qc&&(this.nc--,0>this.nc&&(w(this.a.h,this.a.h.md),this.nc=this.Bd))};
g.n[4].prototype.toJSON=function(){var a=g.n[0].prototype.toJSON.apply(this);a.command=this.sd;a.prgAddressSelect=this.ac;a.chrAddressSelect=this.ab;a.pageNumber=this.of;a.irqCounter=this.nc;a.irqLatchValue=this.Bd;a.irqEnable=this.Qc;a.prgAddressChanged=this.$b;return a};
g.n[4].prototype.G=function(a){g.n[0].prototype.G.apply(this,a);this.sd=a.command;this.ac=a.prgAddressSelect;this.ab=a.chrAddressSelect;this.of=a.pageNumber;this.nc=a.irqCounter;this.Bd=a.irqLatchValue;this.Qc=a.irqEnable;this.$b=a.prgAddressChanged};g.Y=function(a){this.a=a;this.Ba=new g.Y.Xd(this,!0);this.Ca=new g.Y.Xd(this,!1);this.ra=new g.Y.Ke(this);this.Ia=new g.Y.Je(this);this.da=new g.Y.Ie(this);this.zd=4;this.mc=2048;this.ef=8192;this.hc=0;this.vf=44100;this.Jb=this.Ib=this.P=this.O=this.Gd=null;this.ad=Array(2*this.ef);this.Nc=!1;this.Mc=null;this.Ad=!1;this.Qd=this.lc=this.cc=this.Gc=this.xa=this.Xb=null;this.Xa=0;this.J=this.ga=this.qa=this.ia=this.ha=null;this.je=this.gf=this.cd=this.bd=this.Nd=this.Md=0;this.F=256;this.te=this.se=
this.wd=this.yf=this.zf=this.Cf=this.Bf=this.Af=this.ze=this.Ae=this.De=this.Ce=this.Be=null;a=this.Zb=[80,170,100,150,128];for(var c=0;5>c;c++)this.Zb[c]=a[c];this.Be=this.Zb[0]*this.F>>8;this.Ce=this.Zb[1]*this.F>>8;this.De=this.Zb[2]*this.F>>8;this.Ae=this.Zb[3]*this.F>>8;this.ze=this.Zb[4]*this.F>>8;this.Af=this.F-this.Be;this.Bf=this.F-this.Ce;this.Cf=this.F-this.De;this.zf=this.F-this.Ae;this.yf=this.F-this.ze;this.Gd=[10,254,20,2,40,4,80,6,160,8,60,10,14,12,26,14,12,16,24,18,48,20,96,22,192,
24,72,26,16,28,32,30];this.O=Array(16);this.O[0]=3424;this.O[1]=3040;this.O[2]=2720;this.O[3]=2560;this.O[4]=2288;this.O[5]=2032;this.O[6]=1808;this.O[7]=1712;this.O[8]=1520;this.O[9]=1280;this.O[10]=1136;this.O[11]=1024;this.O[12]=848;this.O[13]=672;this.O[14]=576;this.O[15]=432;this.P=Array(16);this.P[0]=4;this.P[1]=8;this.P[2]=16;this.P[3]=32;this.P[4]=64;this.P[5]=96;this.P[6]=128;this.P[7]=160;this.P[8]=202;this.P[9]=254;this.P[10]=380;this.P[11]=508;this.P[12]=762;this.P[13]=1016;this.P[14]=
2034;this.P[15]=4068;var d,f=c=0;this.Ib=Array(512);this.Jb=Array(3264);for(a=0;512>a;a++)d=95.52/(8128/(a/16)+100),d*=.98411,d*=5E4,d=Math.floor(d),this.Ib[a]=d,d>c&&(c=d);for(a=0;3264>a;a++)d=163.67/(24329/(a/16)+100),d*=.98411,d*=5E4,d=Math.floor(d),this.Jb[a]=d,d>f&&(f=d);this.gf=c+f;this.je=this.gf/2;for(a=0;20>a;a++)16===a?this.S(16400,16):this.S(16384+a,0);this.reset()};
g.Y.prototype={reset:function(){this.vf=this.a.Q.sampleRate;this.Qd=Math.floor(1024*this.a.Q.CPU_FREQ_NTSC*this.a.Q.Eg/(60*this.vf));this.lc=Math.floor(14915*this.a.Q.Eg/60);this.hc=this.cc=0;ia(this,0);this.Gc=this.xa=this.Xb=0;this.mc=2048;this.Ad=this.Nc=!1;this.xa=0===this.Gc?4:0;this.Ba.reset();this.Ca.reset();this.ra.reset();this.Ia.reset();this.da.reset();this.ga=this.qa=this.ia=this.ha=this.J=this.hc=0;this.Nc=!1;this.zd=4;this.cd=this.bd=this.Nd=this.Md=0;this.se=-5E5;this.te=5E5},qf:function(){var a;
a=0|this.Ba.xb();a|=this.Ca.xb()<<1;a|=this.ra.xb()<<2;a|=this.Ia.xb()<<3;a|=this.da.xb()<<4;a|=(this.Mc&&this.Nc?1:0)<<6;a|=(this.da.Vb?1:0)<<7;this.Mc=!1;this.da.Vb=!1;return a&65535},S:function(a,c){16384<=a&&16388>a?this.Ba.S(a,c):16388<=a&&16392>a?this.Ca.S(a,c):16392<=a&&16396>a?this.ra.S(a,c):16396<=a&&16399>=a?this.Ia.S(a,c):16400===a?this.da.S(a,c):16401===a?this.da.S(a,c):16402===a?this.da.S(a,c):16403===a?this.da.S(a,c):16405===a?(ia(this,c),0!==c&&0<this.mc&&(this.Ad=!0),this.da.S(a,c)):
16407===a&&(this.Gc=c>>7&1,this.Xb=0,this.Mc=!1,this.Nc=0===(c>>6&1),0===this.Gc?this.xa=this.zd=4:(this.zd=5,this.xa=0,ja(this)))},hb:function(){var a,c;0<this.J?(this.ha<<=4,this.ha=Math.floor(this.ha/this.J),this.ia<<=4,this.ia=Math.floor(this.ia/this.J),this.qa=Math.floor(this.qa/this.J),this.ga<<=4,this.ga=Math.floor(this.ga/this.J),this.J=0):(this.ha=this.Ba.B<<4,this.ia=this.Ca.B<<4,this.qa=this.ra.B,this.ga=this.da.hb<<4);var d=Math.floor((this.Ia.gc<<4)/this.Ia.J);this.Ia.gc=d>>4;this.Ia.J=
1;a=this.ha*this.Be+this.ia*this.Ce>>8;c=3*this.qa*this.De+(d<<1)*this.Ae+this.ga*this.ze>>8;a>=this.Ib.length&&(a=this.Ib.length-1);c>=this.Jb.length&&(c=this.Jb.length-1);var f=this.Ib[a]+this.Jb[c]-this.je;a=this.ha*this.Af+this.ia*this.Bf>>8;c=3*this.qa*this.Cf+(d<<1)*this.zf+this.ga*this.yf>>8;a>=this.Ib.length&&(a=this.Ib.length-1);c>=this.Jb.length&&(c=this.Jb.length-1);a=this.Ib[a]+this.Jb[c]-this.je;f-=this.Md;this.Md+=f;f=this.bd+=f-(this.bd>>10);a-=this.Nd;this.Nd+=a;a=this.cd+=a-(this.cd>>
10);f>this.se&&(this.se=f);f<this.te&&(this.te=f);this.ad[this.hc++]=f;this.ad[this.hc++]=a;this.hc===this.ad.length&&(this.a.ui.Df(this.ad),this.ad=Array(2*this.ef),this.hc=0);this.ga=this.qa=this.ia=this.ha=0}};function ja(a){a.xa++;a.xa>=a.zd&&(a.xa=0);if(1===a.xa||3===a.xa)a.ra.ic(),a.Ba.ic(),a.Ca.ic(),a.Ia.ic(),ka(a.Ba),ka(a.Ca);if(0<=a.xa&&4>a.xa){a.Ba.rd();a.Ca.rd();a.Ia.rd();var c=a.ra;c.Fd?(c.pc=c.re,T(c)):0<c.pc&&(c.pc--,T(c));c.Ed||(c.Fd=!1)}3===a.xa&&0===a.Gc&&(a.Mc=!0)}
function s(a,c){if(0<a.mc&&a.Ad)a.mc-=c,0>=a.mc&&(a.Ad=!1);else{c+=a.wd;var d=a.Qd-a.cc;c<<10>d?(a.wd=(c<<10)-d>>10,c-=a.wd):a.wd=0;var f=a.da,b=a.ra,e=a.Ba,m=a.Ca,d=a.Ia;if(f.isEnabled)for(f.uc-=c<<3;0>=f.uc&&0<f.vd;){f.uc+=f.vd;var k=f;k.pe&&(0===(k.data&1)?0<k.wb&&k.wb--:63>k.wb&&k.wb++,k.hb=k.isEnabled?(k.wb<<1)+k.td:0,k.data>>=1);k.ud--;if(0>=k.ud){k.pe=!1;var n=k;0===n.Ja&&n.tc===n.We&&(n.Bb=n.Tc,n.Ja=n.sc);if(0<n.Ja){var p=n;p.data=p.H.a.l.load(p.Bb);var l=p.H.a.h;l.na+=4;p.Ja--;p.Bb++;65535<
p.Bb&&(p.Bb=32768);p.pe=!0;0===n.Ja&&n.tc===n.Ve&&(n.Vb=!0)}k.ud=8}k.Vb&&w(k.H.a.h,k.H.a.h.md)}if(0<b.e)for(b.t-=c;0>=b.t;)b.t+=b.e+1,0<b.pc&&0<b.r&&(b.Kb++,b.Kb&=31,b.isEnabled&&(b.B=16<=b.Kb?b.Kb&15:15-(b.Kb&15),b.B<<=4));e.t-=c;0>=e.t&&(e.t+=e.e+1<<1,e.Hb++,e.Hb&=7,e.Ya());m.t-=c;0>=m.t&&(m.t+=m.e+1<<1,m.Hb++,m.Hb&=7,m.Ya());f=c;if(0<d.t-f)d.t-=f,d.J+=f,d.gc+=f*d.B;else for(;0<f--;)0>=--d.t&&0<d.e&&(d.dc<<=1,d.ed=(d.dc<<(0===d.ve?1:6)^d.dc)&32768,0!==d.ed?(d.dc|=1,d.Od=0,d.B=0):(d.Od=1,d.B=d.isEnabled&&
0<d.r?d.F:0),d.t+=d.e),d.gc+=d.B,d.J++;a.Nc&&a.Mc&&w(a.a.h,a.a.h.md);a.Xb+=c<<1;a.Xb>=a.lc&&(a.Xb-=a.lc,ja(a));d=c;a.ra.we&&(a.Xa=Math.floor((a.ra.t<<4)/(a.ra.e+1)),16<a.Xa&&(a.Xa=16),16<=a.ra.Kb&&(a.Xa=16-a.Xa),a.Xa+=a.ra.B);2===d?(a.qa+=a.Xa<<1,a.ga+=a.da.hb<<1,a.ha+=a.Ba.B<<1,a.ia+=a.Ca.B<<1,a.J+=2):4===d?(a.qa+=a.Xa<<2,a.ga+=a.da.hb<<2,a.ha+=a.Ba.B<<2,a.ia+=a.Ca.B<<2,a.J+=4):(a.qa+=d*a.Xa,a.ga+=d*a.da.hb,a.ha+=d*a.Ba.B,a.ia+=d*a.Ca.B,a.J+=d);a.cc+=c<<10;a.cc>=a.Qd&&(a.hb(),a.cc-=a.Qd)}}
function ia(a,c){a.Ba.Gb(0!==(c&1));a.Ca.Gb(0!==(c&2));a.ra.Gb(0!==(c&4));a.Ia.Gb(0!==(c&8));a.da.Gb(0!==(c&16))}g.Y.Ie=function(a){this.H=a;this.Xe=0;this.We=1;this.Ve=2;this.pe=this.isEnabled=null;this.Vb=!1;this.data=this.td=this.hb=this.uc=this.Ja=this.sc=this.Bb=this.Tc=this.wb=this.ud=this.vd=this.tc=null;this.reset()};
g.Y.Ie.prototype={S:function(a,c){if(16400===a){0===c>>6?this.tc=this.Xe:1===(c>>6&1)?this.tc=this.We:2===c>>6&&(this.tc=this.Ve);0===(c&128)&&(this.Vb=!1);var d=c&15;this.vd=0<=d&&16>d?this.H.O[d]:0}else 16401===a?(this.wb=c>>1&63,this.td=c&1,this.hb=(this.wb<<1)+this.td):16402===a?this.Bb=this.Tc=c<<6|49152:16403===a?this.Ja=this.sc=(c<<4)+1:16405===a&&(0===(c>>4&1)?this.Ja=0:(this.Bb=this.Tc,this.Ja=this.sc),this.Vb=!1)},Gb:function(a){!this.isEnabled&&a&&(this.Ja=this.sc);this.isEnabled=a},xb:function(){return 0!==
this.Ja&&this.isEnabled?1:0},reset:function(){this.Vb=this.isEnabled=!1;this.tc=this.Xe;this.data=this.uc=this.td=this.hb=this.Ja=this.sc=this.Bb=this.Tc=this.wb=this.ud=this.vd=0}};g.Y.Je=function(a){this.H=a;this.F=this.ea=this.bb=this.oa=this.e=this.t=this.r=this.Tb=this.Ha=this.Sb=this.cb=this.isEnabled=null;this.dc=16384;this.B=this.ve=this.Od=null;this.gc=0;this.J=1;this.ed=null;this.reset()};
g.Y.Je.prototype={reset:function(){this.e=this.t=0;this.isEnabled=!1;this.r=0;this.Sb=this.cb=this.Ha=!1;this.F=this.ea=this.bb=this.oa=0;this.dc=1;this.ed=this.B=this.ve=this.Od=0},ic:function(){this.Ha&&0<this.r&&(this.r--,0===this.r&&this.Ya())},rd:function(){this.Tb?(this.Tb=!1,this.bb=this.oa+1,this.ea=15):0>=--this.bb&&(this.bb=this.oa+1,0<this.ea?this.ea--:this.ea=this.Sb?15:0);this.F=this.cb?this.oa:this.ea;this.Ya()},Ya:function(){this.isEnabled&&0<this.r&&(this.B=this.Od*this.F)},S:function(a,
c){if(16396===a)this.cb=0!==(c&16),this.oa=c&15,this.Sb=0!==(c&32),this.Ha=0===(c&32),this.F=this.cb?this.oa:this.ea;else if(16398===a){var d=c&15;this.e=0<=d&&16>d?this.H.P[d]:0;this.ve=c>>7}else 16399===a&&(this.r=this.H.Gd[(c&248)>>3],this.Tb=!0)},Gb:function(a){this.isEnabled=a;a||(this.r=0);this.Ya()},xb:function(){return 0!==this.r&&this.isEnabled?1:0}};
g.Y.Xd=function(a,c){this.H=a;this.Ag=[0,1,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,1,1,1,1,0,0,0,1,0,0,1,1,1,1,1];this.xf=c;this.B=this.ke=this.F=this.ea=this.bb=this.oa=this.wc=this.Ud=this.Td=this.Sd=this.Hb=this.r=this.e=this.t=this.Fe=this.Tb=this.Sb=this.cb=this.Ee=this.Ha=this.isEnabled=null;this.reset()};
g.Y.Xd.prototype={reset:function(){this.ke=this.F=this.ea=this.bb=this.oa=this.wc=this.Ud=this.Td=this.Sd=this.Hb=this.r=this.e=this.t=0;this.Sb=this.cb=this.Ee=this.Ha=this.isEnabled=!1},ic:function(){this.Ha&&0<this.r&&(this.r--,0===this.r&&this.Ya())},rd:function(){this.Tb?(this.Tb=!1,this.bb=this.oa+1,this.ea=15):0>=--this.bb&&(this.bb=this.oa+1,0<this.ea?this.ea--:this.ea=this.Sb?15:0);this.F=this.cb?this.oa:this.ea;this.Ya()},Ya:function(){this.B=this.isEnabled&&0<this.r&&7<this.e?0===this.Ud&&
4095<this.e+(this.e>>this.wc)?0:this.F*this.Ag[(this.ke<<3)+this.Hb]:0},S:function(a,c){var d=this.xf?0:4;a===16384+d?(this.cb=0!==(c&16),this.oa=c&15,this.Sb=0!==(c&32),this.ke=c>>6&3,this.Ha=0===(c&32),this.F=this.cb?this.oa:this.ea,this.Ya()):a===16385+d?(this.Ee=0!==(c&128),this.Td=c>>4&7,this.Ud=c>>3&1,this.wc=c&7,this.Fe=!0):a===16386+d?(this.e&=1792,this.e|=c):a===16387+d&&(this.e&=255,this.e|=(c&7)<<8,this.isEnabled&&(this.r=this.H.Gd[(c&248)>>3]),this.Tb=!0)},Gb:function(a){this.isEnabled=
a;a||(this.r=0);this.Ya()},xb:function(){return 0!==this.r&&this.isEnabled?1:0}};function ka(a){0>=--a.Sd&&(a.Sd=a.Td+1,a.Ee&&0<a.wc&&7<a.e&&(0===a.Ud?(a.e+=a.e>>a.wc,4095<a.e&&(a.e=4095)):a.e-=(a.e>>a.wc)-(a.xf?1:0)));a.Fe&&(a.Fe=!1,a.Sd=a.Td+1)}g.Y.Ke=function(a){this.H=a;this.ed=this.B=this.re=this.pc=this.r=this.Kb=this.e=this.t=this.Ed=this.Fd=this.Ha=this.we=this.isEnabled=null;this.reset()};
g.Y.Ke.prototype={reset:function(){this.Kb=this.e=this.t=0;this.we=this.isEnabled=!1;this.r=0;this.Ha=!1;this.re=this.pc=0;this.Fd=!0;this.Ed=!1;this.ed=0;this.B=15},ic:function(){this.Ha&&0<this.r&&(this.r--,0===this.r&&T(this))},xb:function(){return 0!==this.r&&this.isEnabled?1:0},qf:function(){return 0},S:function(a,c){16392===a?(this.Ed=0!==(c&128),this.re=c&127,this.Ha=!this.Ed):16394===a?(this.e&=1792,this.e|=c):16395===a&&(this.e&=255,this.e|=(c&7)<<8,this.r=this.H.Gd[(c&248)>>3],this.Fd=!0);
T(this)},Gb:function(a){this.isEnabled=a;a||(this.r=0);T(this)}};function T(a){a.we=a.isEnabled&&7<a.e&&0<a.pc&&0<a.r};g.Z=function(a){this.a=a;this.Yb=this.Pa=this.za=this.jc=this.m=this.K=this.Pc=this.ec=this.Oc=this.La=this.Ka=this.fe=this.yb=this.sa=this.vc=this.Ma=this.u=this.ma=this.Rb=this.fb=this.M=this.wf=this.Lb=this.pa=this.pd=this.pf=this.buffer=this.ub=this.vb=this.Pd=this.Wc=this.Va=this.fa=this.Ua=this.Eb=this.Db=this.wa=this.T=this.ba=this.ca=this.va=this.Ub=this.xd=this.yd=this.Sa=this.ya=this.Jc=this.ne=this.Ic=this.Kc=this.me=this.kc=this.oe=this.Rd=this.Sc=this.Lb=this.Hc=this.mf=this.Xc=this.jc=
this.Wa=this.eb=this.Wd=this.fd=this.U=this.ib=this.R=null;this.Jg=!1;this.ge=!0;this.reset()};
g.Z.prototype={df:6,ce:7,reset:function(){var a;this.R=Array(32768);this.ib=Array(256);for(a=0;a<this.R.length;a++)this.R[a]=0;for(a=0;a<this.ib.length;a++)this.ib[a]=0;this.fd=this.U=null;this.Wd=0;this.eb=!0;this.Wa=0;this.jc=-1;this.Lb=this.Hc=this.mf=this.Xc=!1;this.Sc=0;this.Rd=null;this.Pd=this.Wc=this.Va=this.fa=this.Ua=this.Eb=this.Db=this.wa=this.T=this.ba=this.ca=this.va=this.Ub=this.xd=this.yd=this.Sa=this.ya=this.Jc=this.ne=this.Ic=this.Kc=this.me=this.kc=this.oe=0;this.vb=null;this.ub=
Array(32);this.buffer=Array(61440);this.pf=Array(61440);this.pd=Array(61440);this.pa=Array(61440);this.Lb=null;this.wf=Array(32);this.M=0;this.fb=-1;this.Rb=0;this.ma=Array(64);this.u=Array(64);this.Ma=Array(64);this.vc=Array(64);this.sa=Array(64);this.yb=Array(64);this.fe=Array(64);this.La=this.Ka=0;this.Oc=!1;this.ec=Array(16);this.Pc=Array(16);this.K=Array(512);for(a=0;512>a;a++)this.K[a]=new g.Z.de;this.m=Array(4);this.jc=-1;this.za=Array(4);for(a=0;4>a;a++)this.za[a]=new g.Z.Ye(32,32,"Nt"+a);
this.Pa=Array(32768);for(a=0;32768>a;a++)this.Pa[a]=a;a=this.Yb=new g.Z.$e;a.Qb=[5395026,11796480,10485760,11599933,7602281,91,95,6208,12048,543240,26368,1196544,7153664,0,0,0,12899815,16728064,14421538,16729963,14090399,6818519,6588,21681,27227,35843,43776,2918400,10777088,0,0,0,16316664,16755516,16742785,16735173,16730354,14633471,4681215,46327,57599,58229,259115,7911470,15065624,7895160,0,0,16777215,16773822,16300216,16300248,16758527,16761855,13095423,10148607,8973816,8650717,12122296,16119980,
16777136,16308472,0,0];for(var c,d,f,b,e,m,k,n=0;8>n;n++)for(k=m=e=1,0!==(n&1)&&(k=e=.75),0!==(n&2)&&(m=e=.75),0!==(n&4)&&(k=m=.75),a.le[n]=Array(64),b=0;64>b;b++)f=a.Qb[b],c=Math.floor((f>>16&255)*e),d=Math.floor((f>>8&255)*m),f=Math.floor((f&255)*k),a.le[n][b]=c<<16|d<<8|f;U(a,0);da(this,0);ea(this,0)},Ob:{R:"vramMem",ib:"spriteMem",va:"cntFV",ca:"cntV",ba:"cntH",T:"cntVT",wa:"cntHT",Db:"regFV",Eb:"regV",Ua:"regH",fa:"regVT",Va:"regHT",Wc:"regFH",Pd:"regS",U:"vramAddress",fd:"vramTmpAddress",oe:"f_nmiOnVblank",
kc:"f_spriteSize",me:"f_bgPatternTable",Kc:"f_spPatternTable",Ic:"f_addrInc",ne:"f_nTblAddress",Jc:"f_color",ya:"f_spVisibility",Sa:"f_bgVisibility",yd:"f_spClipping",xd:"f_bgClipping",Ub:"f_dispType",Wd:"vramBufferedReadValue",eb:"firstWrite",jc:"currentMirroring",Pa:"vramMirrorTable",m:"ntable1",Wa:"sramAddress",Oc:"hitSpr0",ec:"sprPalette",Pc:"imgPalette",Rb:"curX",M:"scanline",fb:"lastRenderedScanline",vb:"curNt",ub:"attrib",buffer:"buffer",pd:"bgbuffer",pa:"pixrendered",Xc:"requestEndFrame",
mf:"nmiOk",Hc:"dummyCycleToggle",Sc:"nmiCounter",Lb:"validTileData",Rd:"scanlineAlreadyRendered"},toJSON:function(){var a,c=g.ta.toJSON(this);c.nameTable=[];for(a=0;a<this.za.length;a++)c.nameTable[a]=this.za[a].toJSON();c.ptTile=[];for(a=0;a<this.K.length;a++)c.ptTile[a]=this.K[a].toJSON();return c},G:function(a){var c;g.ta.G(this,a);for(c=0;c<this.za.length;c++)this.za[c].G(a.nameTable[c]);for(c=0;c<this.K.length;c++)this.K[c].G(a.ptTile[c]);for(c=0;c<this.ib.length;c++)Q(this,c,this.ib[c])}};
function Q(a,c,d){var f=Math.floor(c/4);0===f&&z(a,a.M-20);0===c%4?a.u[f]=d:1==c%4?a.Ma[f]=d:2==c%4?(a.sa[f]=0!==(d&128),a.yb[f]=0!==(d&64),a.fe[f]=0!==(d&32),a.vc[f]=(d&3)<<2):3==c%4&&(a.ma[f]=d)}function V(a,c,d,f){a.za[c].Vd[d]=f;z(a,a.M-20)}function la(a){var c;for(c=0;16>c;c++)a.Pc[c]=0===a.Ub?a.Yb.Qb[a.R[16128+c]&63]:a.Yb.Qb[a.R[16128+c]&32];for(c=0;16>c;c++)a.ec[c]=0===a.Ub?a.Yb.Qb[a.R[16144+c]&63]:a.Yb.Qb[a.R[16144+c]&32]}
function S(a,c,d){a.R[c]=d;if(8192>c){a.R[c]=d;var f=Math.floor(c/16),b=c%16;8>b?W(a.K[f],b,d,a.R[c+8]):W(a.K[f],b-8,a.R[c-8],d)}else 8192<=c&&9152>c?V(a,a.m[0],c-8192,d):9152<=c&&9216>c?X(a.za[a.m[0]],c-9152,d):9216<=c&&10176>c?V(a,a.m[1],c-9216,d):10176<=c&&10240>c?X(a.za[a.m[1]],c-10176,d):10240<=c&&11200>c?V(a,a.m[2],c-10240,d):11200<=c&&11264>c?X(a.za[a.m[2]],c-11200,d):11264<=c&&12224>c?V(a,a.m[3],c-11264,d):12224<=c&&12288>c?X(a.za[a.m[3]],c-12224,d):16128<=c&&16160>c&&la(a)}
function z(a,c){a.Ka=-1;a.La=-1;var d,f=0===a.Kc?0:256,b,e,m;b=a.ma[0];d=a.u[0]+1;if(0===a.kc){if(d<=c&&d+8>c&&-7<=b&&256>b)if(f=a.K[a.Ma[0]+f],d=a.sa[0]?7-(c-d):c-d,d*=8,m=256*c+b,a.yb[0])for(e=7;0<=e;e--){if(0<=b&&256>b&&0<=m&&61440>m&&0!==a.pa[m]&&0!==f.la[d+e])return a.Ka=m%256,a.La=c,!0;b++;m++}else for(e=0;8>e;e++){if(0<=b&&256>b&&0<=m&&61440>m&&0!==a.pa[m]&&0!==f.la[d+e])return a.Ka=m%256,a.La=c,!0;b++;m++}}else if(d<=c&&d+16>c&&-7<=b&&256>b)if(d=a.sa[0]?15-(c-d):c-d,8>d?f=a.K[a.Ma[0]+(a.sa[0]?
1:0)+(0!==(a.Ma[0]&1)?255:0)]:(f=a.K[a.Ma[0]+(a.sa[0]?0:1)+(0!==(a.Ma[0]&1)?255:0)],d=a.sa[0]?15-d:d-8),d*=8,m=256*c+b,a.yb[0])for(e=7;0<=e;e--){if(0<=b&&256>b&&0<=m&&61440>m&&0!==a.pa[m]&&0!==f.la[d+e])return a.Ka=m%256,a.La=c,!0;b++;m++}else for(e=0;8>e;e++){if(0<=b&&256>b&&0<=m&&61440>m&&0!==a.pa[m]&&0!==f.la[d+e])return a.Ka=m%256,a.La=c,!0;b++;m++}return!1}
function ma(a,c,d,f){if(1===a.ya)for(var b=0;64>b;b++)if(a.fe[b]==f&&0<=a.ma[b]&&256>a.ma[b]&&a.u[b]+8>=c&&a.u[b]<c+d)if(0===a.kc)a.xe=0,a.ye=8,a.u[b]<c&&(a.xe=c-a.u[b]-1),a.u[b]+8>c+d&&(a.ye=c+d-a.u[b]+1),0===a.Kc?Y(a.K[a.Ma[b]],a.buffer,a.xe,a.ye,a.ma[b],a.u[b]+1,a.vc[b],a.ec,a.yb[b],a.sa[b],b,a.pa):Y(a.K[a.Ma[b]+256],a.buffer,a.xe,a.ye,a.ma[b],a.u[b]+1,a.vc[b],a.ec,a.yb[b],a.sa[b],b,a.pa);else{var e=a.Ma[b];0!==(e&1)&&(e=a.Ma[b]-1+256);var m=0,k=8;a.u[b]<c&&(m=c-a.u[b]-1);a.u[b]+8>c+d&&(k=c+d-
a.u[b]);Y(a.K[e+(a.sa[b]?1:0)],a.buffer,m,k,a.ma[b],a.u[b]+1,a.vc[b],a.ec,a.yb[b],a.sa[b],b,a.pa);m=0;k=8;a.u[b]+8<c&&(m=c-(a.u[b]+8+1));a.u[b]+16>c+d&&(k=c+d-(a.u[b]+8));Y(a.K[e+(a.sa[b]?0:1)],a.buffer,m,k,a.ma[b],a.u[b]+1+8,a.vc[b],a.ec,a.yb[b],a.sa[b],b,a.pa)}}
function y(a,c,d){var f=0===a.Pd?0:256,b=(d<<8)-a.Wc;a.vb=a.m[a.ca+a.ca+a.ba];a.wa=a.Va;a.ba=a.Ua;a.vb=a.m[a.ca+a.ca+a.ba];if(240>d&&0<=d-a.va){var e=a.va<<3,m=a.wf,k=a.ub,n=a.K,p=a.za,l=a.Pc,v=a.pa;c=c?a.pd:a.buffer;for(var r,t,B,E=0;32>E;E++){if(0<=d){a.Lb?(r=m[E],t=r.la,B=k[E]):(t=p[a.vb],r=n[f+t.Vd[a.T*t.width+a.wa]],t=r.la,B=p[a.vb],B=B.ub[a.T*B.width+a.wa],m[E]=r,k[E]=B);var F=0,R=(E<<3)-a.Wc;if(-8<R)if(0>R&&(b-=R,F=-R),r.Ld[a.va])for(;8>F;F++)c[b]=l[t[e+F]+B],v[b]|=256,b++;else for(;8>F;F++)r=
t[e+F],0!==r&&(c[b]=l[r+B],v[b]|=256),b++}32==++a.wa&&(a.wa=0,a.ba++,a.ba%=2,a.vb=a.m[(a.ca<<1)+a.ba])}a.Lb=!0}a.va++;8==a.va&&(a.va=0,a.T++,30==a.T?(a.T=0,a.ca++,a.ca%=2,a.vb=a.m[(a.ca<<1)+a.ba]):32==a.T&&(a.T=0),a.Lb=!1)}function x(a,c,d){1==a.ya&&ma(a,c,d,!0);if(1==a.Sa){var f=c+d<<8;61440<f&&(f=61440);for(var b=a.buffer,e=a.pd,m=a.pa,k=c<<8;k<f;k++)255<m[k]&&(b[k]=e[k])}1==a.ya&&ma(a,c,d,!1);a.Lb=!1}function M(a){21<=a.M&&260>=a.M&&(x(a,a.fb+1,a.M-21-a.fb),a.fb=a.M-21)}
function C(a){var c=(a.va&7)<<4,c=c|(a.ca&1)<<3,c=c|(a.ba&1)<<2,c=c|a.T>>3&3,d=(a.T&7)<<5,d=d|a.wa&31;a.U=(c<<8|d)&32767}function A(a){var c=(a.Db&7)<<4,c=c|(a.Eb&1)<<3,c=c|(a.Ua&1)<<2,c=c|a.fa>>3&3,d=(a.fa&7)<<5,d=d|a.Va&31;a.fd=(c<<8|d)&32767}function ga(a){var c=a.U>>8&255;a.va=c>>4&3;a.ca=c>>3&1;a.ba=c>>2&1;a.T=a.T&7|(c&3)<<3;c=a.U&255;a.T=a.T&24|c>>5&7;a.wa=c&31}
function fa(a){var c=a.fd>>8&255;a.Db=c>>4&7;a.Eb=c>>3&1;a.Ua=c>>2&1;a.fa=a.fa&7|(c&3)<<3;c=a.fd&255;a.fa=a.fa&24|c>>5&7;a.Va=c&31}function u(a,c,d){c=1<<c;a.a.h.p[8194]=a.a.h.p[8194]&255-c|(d?c:0)}function ea(a,c){M(a);a.Jc=c>>5&7;a.ya=c>>4&1;a.Sa=c>>3&1;a.yd=c>>2&1;a.xd=c>>1&1;a.Ub=c&1;0===a.Ub&&U(a.Yb,a.Jc);la(a)}function da(a,c){M(a);a.oe=c>>7&1;a.kc=c>>5&1;a.me=c>>4&1;a.Kc=c>>3&1;a.Ic=c>>2&1;a.ne=c&3;a.Eb=c>>1&1;a.Ua=c&1;a.Pd=c>>4&1}function Z(a,c,d,f){for(var b=0;b<f;b++)a.Pa[c+b]=d+b}
function D(a,c){if(c!=a.jc){a.jc=c;M(a);null===a.Pa&&(a.Pa=Array(32768));for(var d=0;32768>d;d++)a.Pa[d]=d;Z(a,16160,16128,32);Z(a,16192,16128,32);Z(a,16256,16128,32);Z(a,16320,16128,32);Z(a,12288,8192,3840);Z(a,16384,0,16384);c==a.a.b.jd?(a.m[0]=0,a.m[1]=0,a.m[2]=1,a.m[3]=1,Z(a,9216,8192,1024),Z(a,11264,10240,1024)):c==a.a.b.od?(a.m[0]=0,a.m[1]=1,a.m[2]=0,a.m[3]=1,Z(a,10240,8192,1024),Z(a,11264,9216,1024)):c==a.a.b.cf?(a.m[0]=0,a.m[1]=0,a.m[2]=0,a.m[3]=0,Z(a,9216,8192,1024),Z(a,10240,8192,1024),
Z(a,11264,8192,1024)):c==a.a.b.zg?(a.m[0]=1,a.m[1]=1,a.m[2]=1,a.m[3]=1,Z(a,9216,9216,1024),Z(a,10240,9216,1024),Z(a,11264,9216,1024)):(a.m[0]=0,a.m[1]=1,a.m[2]=2,a.m[3]=3)}}g.Z.Ye=function(a,c,d){this.width=a;this.height=c;this.name=d;this.Vd=Array(a*c);this.ub=Array(a*c)};g.Z.Ye.prototype={toJSON:function(){return{tile:this.Vd,attrib:this.ub}},G:function(a){this.Vd=a.tile;this.ub=a.attrib}};
function X(a,c,d){var f=c%8*4;c=4*Math.floor(c/8);for(var b,e,m,k=0;2>k;k++)for(var n=0;2>n;n++){b=d>>2*(2*k+n)&3;for(var p=0;2>p;p++)for(var l=0;2>l;l++)e=f+2*n+l,m=c+2*k+p,a.ub[m*a.width+e]=b<<2&12}}g.Z.$e=function(){this.Qb=Array(64);this.le=Array(8);this.ff=-1};g.Z.$e.prototype={reset:function(){U(this,0)}};function U(a,c){if(c!=a.ff){a.ff=c;for(var d=0;64>d;d++)a.Qb[d]=a.le[c][d]}}g.Z.de=function(){this.la=Array(64);this.I=this.Aa=this.y=this.x=this.N=this.k=null;this.Ld=Array(8)};
g.Z.de.prototype={toJSON:function(){return{opaque:this.Ld,pix:this.la}},G:function(a){this.Ld=a.opaque;this.la=a.pix}};
function Y(a,c,d,f,b,e,m,k,n,p,l,v){var r=0,t=8;if(!(-7>b||256<=b||-7>e||240<=e))if(0>b&&(r-=b),256<=b+t&&(t=256-b),0>e&&(d-=e),240<=e+f&&(f=240-e),n||p)if(n&&!p)for(a.k=(e<<8)+b,a.N=7,a.y=0;8>a.y;a.y++){for(a.x=0;8>a.x;a.x++)a.x>=r&&a.x<t&&a.y>=d&&a.y<f&&(a.Aa=a.la[a.N],a.I=v[a.k],0!==a.Aa&&l<=(a.I&255)&&(c[a.k]=k[a.Aa+m],a.I=a.I&3840|l,v[a.k]=a.I)),a.k++,a.N--;a.k-=8;a.k+=256;a.N+=16}else if(p&&!n)for(a.k=(e<<8)+b,a.N=56,a.y=0;8>a.y;a.y++){for(a.x=0;8>a.x;a.x++)a.x>=r&&a.x<t&&a.y>=d&&a.y<f&&(a.Aa=
a.la[a.N],a.I=v[a.k],0!==a.Aa&&l<=(a.I&255)&&(c[a.k]=k[a.Aa+m],a.I=a.I&3840|l,v[a.k]=a.I)),a.k++,a.N++;a.k-=8;a.k+=256;a.N-=16}else for(a.k=(e<<8)+b,a.N=63,a.y=0;8>a.y;a.y++){for(a.x=0;8>a.x;a.x++)a.x>=r&&a.x<t&&a.y>=d&&a.y<f&&(a.Aa=a.la[a.N],a.I=v[a.k],0!==a.Aa&&l<=(a.I&255)&&(c[a.k]=k[a.Aa+m],a.I=a.I&3840|l,v[a.k]=a.I)),a.k++,a.N--;a.k-=8;a.k+=256}else for(a.k=(e<<8)+b,a.N=0,a.y=0;8>a.y;a.y++){for(a.x=0;8>a.x;a.x++)a.x>=r&&a.x<t&&a.y>=d&&a.y<f&&(a.Aa=a.la[a.N],a.I=v[a.k],0!==a.Aa&&l<=(a.I&255)&&
(c[a.k]=k[a.Aa+m],a.I=a.I&3840|l,v[a.k]=a.I)),a.k++,a.N++;a.k-=8;a.k+=256}}function W(a,c,d,f){a.N=c<<3;for(a.x=0;8>a.x;a.x++)a.la[a.N+a.x]=(d>>7-a.x&1)+((f>>7-a.x&1)<<1),0===a.la[a.N+a.x]&&(a.Ld[c]=!1)};g.bf=function(a){this.a=a;this.i=Array(92);for(a=0;92>a;a++)this.i[a]="Unknown Mapper";this.i[0]="Direct Access";this.i[1]="Nintendo MMC1";this.i[2]="UNROM";this.i[3]="CNROM";this.i[4]="Nintendo MMC3";this.i[5]="Nintendo MMC5";this.i[6]="FFE F4xxx";this.i[7]="AOROM";this.i[8]="FFE F3xxx";this.i[9]="Nintendo MMC2";this.i[10]="Nintendo MMC4";this.i[11]="Color Dreams Chip";this.i[12]="FFE F6xxx";this.i[15]="100-in-1 switch";this.i[16]="Bandai chip";this.i[17]="FFE F8xxx";this.i[18]="Jaleco SS8806 chip";
this.i[19]="Namcot 106 chip";this.i[20]="Famicom Disk System";this.i[21]="Konami VRC4a";this.i[22]="Konami VRC2a";this.i[23]="Konami VRC2a";this.i[24]="Konami VRC6";this.i[25]="Konami VRC4b";this.i[32]="Irem G-101 chip";this.i[33]="Taito TC0190/TC0350";this.i[34]="32kB ROM switch";this.i[64]="Tengen RAMBO-1 chip";this.i[65]="Irem H-3001 chip";this.i[66]="GNROM switch";this.i[67]="SunSoft3 chip";this.i[68]="SunSoft4 chip";this.i[69]="SunSoft5 FME-7 chip";this.i[71]="Camerica chip";this.i[78]="Irem 74HC161/32-based";
this.i[91]="Pirate HK-SF3 chip"};
g.bf.prototype={od:0,jd:1,Pf:2,cf:3,zg:4,Ga:null,b:null,Za:null,Mb:null,L:null,C:null,gb:null,ee:null,Kg:null,hf:null,Ta:null,valid:!1,load:function(a){var c,d;if(-1===a.indexOf("NES\u001a"))this.a.ui.Oa("Not a valid NES ROM.");else{this.Ga=Array(16);for(c=0;16>c;c++)this.Ga[c]=a.charCodeAt(c)&255;this.L=this.Ga[4];this.C=2*this.Ga[5];this.gb=0!==(this.Ga[6]&1)?1:0;this.ee=0!==(this.Ga[6]&2);this.Kg=0!==(this.Ga[6]&4);this.hf=0!==(this.Ga[6]&8);this.Ta=this.Ga[6]>>4|this.Ga[7]&240;d=!1;for(c=8;16>
c;c++)if(0!==this.Ga[c]){d=!0;break}d&&(this.Ta&=15);this.b=Array(this.L);var f=16;for(c=0;c<this.L;c++){this.b[c]=Array(16384);for(d=0;16384>d&&!(f+d>=a.length);d++)this.b[c][d]=a.charCodeAt(f+d)&255;f+=16384}this.Za=Array(this.C);for(c=0;c<this.C;c++){this.Za[c]=Array(4096);for(d=0;4096>d&&!(f+d>=a.length);d++)this.Za[c][d]=a.charCodeAt(f+d)&255;f+=4096}this.Mb=Array(this.C);for(c=0;c<this.C;c++)for(this.Mb[c]=Array(256),d=0;256>d;d++)this.Mb[c][d]=new g.Z.de;for(a=0;a<this.C;a++)for(c=0;4096>c;c++)d=
c>>4,f=c%16,8>f?W(this.Mb[a][d],f,this.Za[a][c],this.Za[a][c+8]):W(this.Mb[a][d],f-8,this.Za[a][c-8],this.Za[a][c]);this.valid=!0}}};g.Of=function(a){this.a=a;this.enable=function(){};this.Oa=function(){};this.Df=function(){};this.Ef=function(){}};
"undefined"!==typeof jQuery&&function(a){a.fn.yg=function(c){function d(b){var d=this;d.a=b;d.root=a("<div></div>");d.screen=a('<canvas class="nes-screen" width="256" height="240"></canvas>').appendTo(d.root);d.screen[0].getContext?(d.Gg=a('<div class="nes-roms"></div>').appendTo(d.root),d.Zc=a("<select></select>").appendTo(d.Gg),d.controls=a('<div class="nes-controls"></div>').appendTo(d.root),d.buttons={pause:a('<input type="button" value="pause" class="nes-pause" disabled="disabled">').appendTo(d.controls),
tf:a('<input type="button" value="restart" class="nes-restart" disabled="disabled">').appendTo(d.controls),dd:a('<input type="button" value="enable sound" class="nes-enablesound">').appendTo(d.controls),zoom:a('<input type="button" value="zoom in" class="nes-zoom">').appendTo(d.controls)},d.status=a('<p class="nes-status">Booting up...</p>').appendTo(d.root),d.root.appendTo(f),d.Zc.change(function(){d.qc()}),d.buttons.pause.click(function(){d.a.Wb?(d.a.stop(),d.Oa("Paused"),d.buttons.pause.attr("value",
"resume")):(d.a.start(),d.buttons.pause.attr("value","pause"))}),d.buttons.tf.click(function(){d.a.rf();d.a.start()}),d.buttons.dd.click(function(){d.a.Q.emulateSound?(d.a.Q.emulateSound=!1,d.buttons.dd.attr("value","enable sound")):(d.a.Q.emulateSound=!0,d.buttons.dd.attr("value","disable sound"))}),d.Ge=!1,d.buttons.zoom.click(function(){d.Ge?(d.screen.animate({width:"256px",height:"240px"}),d.buttons.zoom.attr("value","zoom in"),d.Ge=!1):(d.screen.animate({width:"512px",height:"480px"}),d.buttons.zoom.attr("value",
"zoom out"),d.Ge=!0)}),a.offset&&d.screen.mousedown(function(a){d.a.l&&(d.a.l.Id=!0,d.a.l.Jd=a.pageX-d.screen.offset().left,d.a.l.Kd=a.pageY-d.screen.offset().top)}).mouseup(function(){setTimeout(function(){d.a.l&&(d.a.l.Id=!1,d.a.l.Jd=0,d.a.l.Kd=0)},500)}),"undefined"!=typeof c&&d.Ig(c),d.Fc=d.screen[0].getContext("2d"),d.Fc.getImageData?(d.qd=d.Fc.getImageData(0,0,256,240),d.Fg(),a(document).bind("keydown",function(a){d.a.Rc.jf(a)}).bind("keyup",function(a){d.a.Rc.lf(a)}).bind("keypress",function(a){d.a.Rc.kf(a)}),
d.Bg=new DynamicAudio({swf:b.Q.swfPath+"dynamicaudio.swf"})):f.html("Your browser doesn't support writing pixels directly to the <code>&lt;canvas&gt;</code> tag. Try the latest versions of Google Chrome, Safari, Opera or Firefox!")):f.html("Your browser doesn't support the <code>&lt;canvas&gt;</code> tag. Try Google Chrome, Safari, Opera or Firefox!")}var f=this;d.prototype={qc:function(){var b=this;b.Oa("Downloading...");a.ajax({url:escape(b.Zc.val()),xhr:function(){var c=a.ajaxSettings.xhr();"undefined"!==
typeof c.overrideMimeType&&c.overrideMimeType("text/plain; charset=x-user-defined");return b.xhr=c},complete:function(a){g.ta.Dg()?(a=JSNESBinaryToArray(a.responseBody).toArray(),a=String.fromCharCode.apply(void 0,a)):a=a.responseText;b.a.Hd(a);b.a.start();b.enable()}})},Fg:function(){this.Fc.fillStyle="black";this.Fc.fillRect(0,0,256,240);for(var a=3;a<this.qd.data.length-3;a+=4)this.qd.data[a]=255},enable:function(){this.buttons.pause.attr("disabled",null);this.a.Wb?this.buttons.pause.attr("value",
"pause"):this.buttons.pause.attr("value","resume");this.buttons.tf.attr("disabled",null);this.a.Q.emulateSound?this.buttons.dd.attr("value","disable sound"):this.buttons.dd.attr("value","enable sound")},Oa:function(a){this.status.text(a)},Ig:function(b){this.Zc.children().remove();a("<option>Select a ROM...</option>").appendTo(this.Zc);for(var c in b)if(b.hasOwnProperty(c)){for(var d=a("<optgroup></optgroup>").attr("label",c),f=0;f<b[c].length;f++)a("<option>"+b[c][f][0]+"</option>").attr("value",
b[c][f][1]).appendTo(d);this.Zc.append(d)}},Df:function(a){return this.Bg.writeInt(a)},Ef:function(a,c){var d=this.qd.data,f,n,p;for(n=0;61440>n;n++)f=a[n],f!=c[n]&&(p=4*n,d[p]=f&255,d[p+1]=f>>8&255,d[p+2]=f>>16&255,c[n]=f);this.Fc.putImageData(this.qd,0,0)}};return d}}(jQuery);window.$=$;$.fn.JSNESUI=$.fn.yg;window.JSNES=g;g.prototype.loadRom=g.prototype.Hd;g.prototype.start=g.prototype.start;g.prototype.frame=g.prototype.frame;g.prototype.reloadRom=g.prototype.rf;g.prototype.stop=g.prototype.stop;g.prototype.toJSON=g.prototype.toJSON;g.prototype.fromJSON=g.prototype.G;g.CPU=g.mb;g.CPU.prototype.toJSON=g.mb.prototype.toJSON;g.CPU.prototype.fromJSON=g.mb.prototype.G;g.PPU=g.Z;g.PPU.prototype.toJSON=g.Z.prototype.toJSON;g.PPU.prototype.fromJSON=g.Z.prototype.G;
g.Keyboard=g.fc;g.Keyboard.prototype.keyDown=g.fc.prototype.jf;g.Keyboard.prototype.keyUp=g.fc.prototype.lf;g.Keyboard.prototype.keyPress=g.fc.prototype.kf;g.prototype.isRunning=g.prototype.Wb;g.prototype.fpsFrameCount=g.prototype.Lc;g.prototype.limitFrames=g.prototype.Og;g.prototype.romData=g.prototype.Yc;g.prototype.reset=g.prototype.reset;g.prototype.printFps=g.prototype.ue;g.prototype.resetFps=g.prototype.sf;g.prototype.setFramerate=g.prototype.Hg;g.prototype.setLimitFrames=g.prototype.Qg;
