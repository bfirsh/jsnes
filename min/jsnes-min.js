/*
JSNES, based on Jamie Sanders' vNES
Copyright (C) 2010 Ben Firshman

This program is free software: you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License
along with this program.  If not, see <http://www.gnu.org/licenses/>.
*/
'use strict';function h(a){this.Q={ui:h.Gf,swfPath:"lib/",preferredFrameRate:60,fpsInterval:500,showDisplay:!0,emulateSound:!1,sampleRate:44100,CPU_FREQ_NTSC:1789772.5,CPU_FREQ_PAL:1773447.4};if("undefined"!=typeof a)for(var b in this.Q)"undefined"!=typeof a[b]&&(this.Q[b]=a[b]);this.Nc=1E3/this.Q.preferredFrameRate;this.ui=new this.Q.ui(this);this.h=new h.mb(this);this.o=new h.Z(this);this.H=new h.Y(this);this.l=null;this.Rc=new h.fc;this.ui.Na("Ready to load a ROM.")}h.VERSION="23855813a39a1008f0e3";
h.prototype={zb:!1,Kc:0,Yc:null,reset:function(){null!==this.l&&this.l.reset();this.h.reset();this.o.reset();this.H.reset()},start:function(){var a=this;null!==this.b&&this.b.valid?this.zb||(this.zb=!0,requestAnimationFrame(function(){a.frame()}),this.kf(),this.te(),this.fpsInterval=setInterval(function(){a.te()},this.Q.fpsInterval)):this.ui.Na("There is no ROM loaded, or it is invalid.")},frame:function(){aa(this.o);var a=this,b=0,c=this.Q.emulateSound,d=this.h,e=this.o,f=this.H;a:for(;;)for(0===
d.na?(b=ba(d),c&&k(f,b),b*=3):8<d.na?(b=24,c&&k(f,8),d.na-=8):(b=3*d.na,c&&k(f,d.na),d.na=0);0<b;b--){e.Sb===e.Ja&&1===e.ya&&e.M-21===e.Ka&&q(e,e.We,!0);if(e.Xc&&(e.Sc--,0===e.Sc)){e.Xc=!1;ca(e);break a}e.Sb++;341===e.Sb&&(e.Sb=0,da(e))}this.Kc++;this.zb&&requestAnimationFrame(function(){a.frame()})},te:function(){var a=+new Date,b="Running";this.pe&&(b+=": "+(this.Kc/((a-this.pe)/1E3)).toFixed(2)+" FPS");this.ui.Na(b);this.Kc=0;this.pe=a},stop:function(){clearInterval(this.fpsInterval);this.zb=!1},
jf:function(){null!==this.Yc&&this.Hd(this.Yc)},Hd:function(a){this.zb&&this.stop();this.ui.Na("Loading ROM...");this.b=new h.Ue(this);this.b.load(a);if(this.b.valid){this.reset();var b;b=this.b;"undefined"!==typeof h.n[b.Sa]?b=new h.n[b.Sa](b.a):(b.a.ui.Na("This ROM uses a mapper not supported by JSNES: "+(0<=b.Sa&&b.Sa<b.i.length?b.i[b.Sa]:"Unknown Mapper, "+b.Sa)+"("+b.Sa+")"),b=null);this.l=b;if(!this.l)return;this.l.pc();b=this.b;s(this.o,b.$e?b.Hf:0===b.gb?b.jd:b.od);this.Yc=a;this.ui.Na("Successfully loaded. Ready to be started.")}else this.ui.Na("Invalid ROM!");
return this.b.valid},kf:function(){this.pe=null;this.Kc=0},yg:function(a){this.Q.preferredFrameRate=a;this.Nc=1E3/a;this.H.Ig(this.Q.sampleRate,!1)},toJSON:function(){return{romData:this.Yc,cpu:this.h.toJSON(),mmap:this.l.toJSON(),ppu:this.o.toJSON()}},G:function(a){this.Hd(a.romData);this.h.G(a.cpu);this.l.G(a.mmap);this.o.G(a.ppu)}};h.ta={Qb:function(a,b,c,d,e){for(var f=0;f<e;++f)c[d+f]=a[b+f]},Cg:function(a){for(var b=Array(a.length),c=0;c<a.length;c++)b[c]=a[c];return b},G:function(a,b){for(var c in a.Pb)a.Pb.hasOwnProperty(c)&&(a[c]=b[a.Pb[c]])},toJSON:function(a){var b={},c;for(c in a.Pb)a.Pb.hasOwnProperty(c)&&(b[a.Pb[c]]=a[c]);return b},ug:function(){return/msie/i.test(navigator.userAgent)&&!/opera/i.test(navigator.userAgent)}};h.mb=function(a){this.a=a;this.Cd=this.nc=this.na=this.qc=this.hd=this.Ea=this.Ke=this.Qa=this.g=this.f=this.ka=this.xc=this.ja=this.Pa=this.q=this.Te=this.W=this.j=this.aa=this.w=this.s=this.d=this.p=null;this.reset()};
h.mb.prototype={md:0,pg:1,nd:2,reset:function(){this.p=new Uint8Array(65536);for(var a=0;8192>a;a++)this.p[a]=255;for(var b=0;4>b;b++)a=2048*b,this.p[a+8]=247,this.p[a+9]=239,this.p[a+10]=223,this.p[a+15]=191;for(a=8193;a<this.p.length;a++)this.p[a]=0;this.w=this.s=this.d=0;this.aa=511;this.W=this.j=32767;this.Te=40;this.ja=this.g=this.q=0;this.Pa=1;this.Ea=0;this.Qa=1;this.Pa=this.q=this.f=this.ka=0;this.xc=this.ja=1;this.f=this.ka=0;this.hd=this.Ea=this.Ke=this.Qa=this.g=1;this.qc=(new h.mb.Re).qc;
this.na=0;this.nc=!1;this.Cd=null},load:function(a){return 8192>a?this.p[a&2047]:this.a.l.load(a)},write:function(a,b){8192>a?this.p[a&2047]=b:this.a.l.write(a,b)},push:function(a){this.a.l.write(this.aa,a);this.aa--;this.aa=256|this.aa&255},Pb:{p:"mem",na:"cyclesToHalt",nc:"irqRequested",Cd:"irqType",d:"REG_ACC",s:"REG_X",w:"REG_Y",aa:"REG_SP",j:"REG_PC",W:"REG_PC_NEW",Te:"REG_STATUS",q:"F_CARRY",Pa:"F_DECIMAL",ja:"F_INTERRUPT",xc:"F_INTERRUPT_NEW",ka:"F_OVERFLOW",f:"F_SIGN",g:"F_ZERO",Qa:"F_NOTUSED",
Ke:"F_NOTUSED_NEW",Ea:"F_BRK",hd:"F_BRK_NEW"},toJSON:function(){return h.ta.toJSON(this)},G:function(a){h.ta.G(this,a)}};function u(a){a.aa++;a.aa=256|a.aa&255;return a.a.l.load(a.aa)}function w(a,b){a.nc&&b==a.md||(a.nc=!0,a.Cd=b)}function x(a,b){return 8191>b?a.p[b&2047]|a.p[b+1&2047]<<8:a.a.l.load(b)|a.a.l.load(b+1)<<8}
function ba(a){var b,c;if(a.nc){b=a.q|(0===a.g?1:0)<<1|a.ja<<2|a.Pa<<3|a.Ea<<4|a.Qa<<5|a.ka<<6|a.f<<7;a.W=a.j;a.xc=a.ja;switch(a.Cd){case 0:if(0!=a.ja)break;var d=b;a.W++;a.push(a.W>>8&255);a.push(a.W&255);a.push(d);a.xc=1;a.hd=0;a.W=a.a.l.load(65534)|a.a.l.load(65535)<<8;a.W--;break;case 1:d=b;0!=(a.a.l.load(8192)&128)&&(a.W++,a.push(a.W>>8&255),a.push(a.W&255),a.push(d),a.W=a.a.l.load(65530)|a.a.l.load(65531)<<8,a.W--);break;case 2:a.W=a.a.l.load(65532)|a.a.l.load(65533)<<8,a.W--}a.j=a.W;a.ja=a.xc;
a.Ea=a.hd;a.nc=!1}b=a.qc[a.a.l.load(a.j+1)];d=b>>24;c=0;var e=b>>8&255,f=a.j;a.j+=b>>16&255;var g=0;switch(e){case 0:g=a.load(f+2);break;case 1:g=a.load(f+2);g=128>g?g+a.j:g+(a.j-256);break;case 3:g=x(a,f+2);break;case 4:g=a.d;break;case 5:g=a.j;break;case 6:g=a.load(f+2)+a.s&255;break;case 7:g=a.load(f+2)+a.w&255;break;case 8:g=x(a,f+2);(g&65280)!=(g+a.s&65280)&&(c=1);g+=a.s;break;case 9:g=x(a,f+2);(g&65280)!=(g+a.w&65280)&&(c=1);g+=a.w;break;case 10:g=a.load(f+2);(g&65280)!=(g+a.s&65280)&&(c=1);
g+=a.s;g=x(a,g&255);break;case 11:g=x(a,a.load(f+2));(g&65280)!=(g+a.w&65280)&&(c=1);g+=a.w;break;case 12:g=x(a,f+2),g=8191>g?a.p[g]+(a.p[g&65280|(g&255)+1&255]<<8):a.a.l.load(g)+(a.a.l.load(g&65280|(g&255)+1&255)<<8)}g&=65535;switch(b&255){case 0:b=a.d+a.load(g)+a.q;a.ka=0==((a.d^a.load(g))&128)&&0!=((a.d^b)&128)?1:0;a.q=255<b?1:0;a.f=b>>7&1;a.g=b&255;a.d=b&255;d+=c;break;case 1:a.d&=a.load(g);a.f=a.d>>7&1;a.g=a.d;11!=e&&(d+=c);break;case 2:4==e?(a.q=a.d>>7&1,a.d=a.d<<1&255,a.f=a.d>>7&1,a.g=a.d):
(b=a.load(g),a.q=b>>7&1,b=b<<1&255,a.f=b>>7&1,a.g=b,a.write(g,b));break;case 3:0==a.q&&(d+=(f&65280)!=(g&65280)?2:1,a.j=g);break;case 4:1==a.q&&(d+=(f&65280)!=(g&65280)?2:1,a.j=g);break;case 5:0==a.g&&(d+=(f&65280)!=(g&65280)?2:1,a.j=g);break;case 6:b=a.load(g);a.f=b>>7&1;a.ka=b>>6&1;b&=a.d;a.g=b;break;case 7:1==a.f&&(d++,a.j=g);break;case 8:0!=a.g&&(d+=(f&65280)!=(g&65280)?2:1,a.j=g);break;case 9:0==a.f&&(d+=(f&65280)!=(g&65280)?2:1,a.j=g);break;case 10:a.j+=2;a.push(a.j>>8&255);a.push(a.j&255);
a.Ea=1;a.push(a.q|(0==a.g?1:0)<<1|a.ja<<2|a.Pa<<3|a.Ea<<4|a.Qa<<5|a.ka<<6|a.f<<7);a.ja=1;a.j=x(a,65534);a.j--;break;case 11:0==a.ka&&(d+=(f&65280)!=(g&65280)?2:1,a.j=g);break;case 12:1==a.ka&&(d+=(f&65280)!=(g&65280)?2:1,a.j=g);break;case 13:a.q=0;break;case 14:a.Pa=0;break;case 15:a.ja=0;break;case 16:a.ka=0;break;case 17:b=a.d-a.load(g);a.q=0<=b?1:0;a.f=b>>7&1;a.g=b&255;d+=c;break;case 18:b=a.s-a.load(g);a.q=0<=b?1:0;a.f=b>>7&1;a.g=b&255;break;case 19:b=a.w-a.load(g);a.q=0<=b?1:0;a.f=b>>7&1;a.g=
b&255;break;case 20:b=a.load(g)-1&255;a.f=b>>7&1;a.g=b;a.write(g,b);break;case 21:a.s=a.s-1&255;a.f=a.s>>7&1;a.g=a.s;break;case 22:a.w=a.w-1&255;a.f=a.w>>7&1;a.g=a.w;break;case 23:a.d=(a.load(g)^a.d)&255;a.f=a.d>>7&1;a.g=a.d;d+=c;break;case 24:b=a.load(g)+1&255;a.f=b>>7&1;a.g=b;a.write(g,b&255);break;case 25:a.s=a.s+1&255;a.f=a.s>>7&1;a.g=a.s;break;case 26:a.w++;a.w&=255;a.f=a.w>>7&1;a.g=a.w;break;case 27:a.j=g-1;break;case 28:a.push(a.j>>8&255);a.push(a.j&255);a.j=g-1;break;case 29:a.d=a.load(g);
a.f=a.d>>7&1;a.g=a.d;d+=c;break;case 30:a.s=a.load(g);a.f=a.s>>7&1;a.g=a.s;d+=c;break;case 31:a.w=a.load(g);a.f=a.w>>7&1;a.g=a.w;d+=c;break;case 32:4==e?(b=a.d&255,a.q=b&1,b>>=1,a.d=b):(b=a.load(g)&255,a.q=b&1,b>>=1,a.write(g,b));a.f=0;a.g=b;break;case 33:break;case 34:b=(a.load(g)|a.d)&255;a.f=b>>7&1;a.g=b;a.d=b;11!=e&&(d+=c);break;case 35:a.push(a.d);break;case 36:a.Ea=1;a.push(a.q|(0==a.g?1:0)<<1|a.ja<<2|a.Pa<<3|a.Ea<<4|a.Qa<<5|a.ka<<6|a.f<<7);break;case 37:a.d=u(a);a.f=a.d>>7&1;a.g=a.d;break;
case 38:b=u(a);a.q=b&1;a.g=1==(b>>1&1)?0:1;a.ja=b>>2&1;a.Pa=b>>3&1;a.Ea=b>>4&1;a.Qa=b>>5&1;a.ka=b>>6&1;a.f=b>>7&1;a.Qa=1;break;case 39:4==e?(b=a.d,c=a.q,a.q=b>>7&1,b=(b<<1&255)+c,a.d=b):(b=a.load(g),c=a.q,a.q=b>>7&1,b=(b<<1&255)+c,a.write(g,b));a.f=b>>7&1;a.g=b;break;case 40:4==e?(c=a.q<<7,a.q=a.d&1,b=(a.d>>1)+c,a.d=b):(b=a.load(g),c=a.q<<7,a.q=b&1,b=(b>>1)+c,a.write(g,b));a.f=b>>7&1;a.g=b;break;case 41:b=u(a);a.q=b&1;a.g=0==(b>>1&1)?1:0;a.ja=b>>2&1;a.Pa=b>>3&1;a.Ea=b>>4&1;a.Qa=b>>5&1;a.ka=b>>6&1;
a.f=b>>7&1;a.j=u(a);a.j+=u(a)<<8;if(65535==a.j)return;a.j--;a.Qa=1;break;case 42:a.j=u(a);a.j+=u(a)<<8;if(65535==a.j)return;break;case 43:b=a.d-a.load(g)-(1-a.q);a.f=b>>7&1;a.g=b&255;a.ka=0!=((a.d^b)&128)&&0!=((a.d^a.load(g))&128)?1:0;a.q=0>b?0:1;a.d=b&255;11!=e&&(d+=c);break;case 44:a.q=1;break;case 45:a.Pa=1;break;case 46:a.ja=1;break;case 47:a.write(g,a.d);break;case 48:a.write(g,a.s);break;case 49:a.write(g,a.w);break;case 50:a.s=a.d;a.f=a.d>>7&1;a.g=a.d;break;case 51:a.w=a.d;a.f=a.d>>7&1;a.g=
a.d;break;case 52:a.s=a.aa-256;a.f=a.aa>>7&1;a.g=a.s;break;case 53:a.d=a.s;a.f=a.s>>7&1;a.g=a.s;break;case 54:a.aa=a.s+256;a.aa=256|a.aa&255;break;case 55:a.d=a.w;a.f=a.w>>7&1;a.g=a.w;break;default:a.a.stop(),a.a.Dg="Game crashed, invalid opcode at address $"+f.toString(16)}return d}
h.mb.Re=function(){this.qc=new Uint32Array(255);for(var a=0;255>a;a++)this.qc[a]=255;y(this,this.nb,105,this.Da,2,2);y(this,this.nb,101,this.D,2,3);y(this,this.nb,117,this.V,2,4);y(this,this.nb,109,this.A,3,4);y(this,this.nb,125,this.X,3,4);y(this,this.nb,121,this.$a,3,4);y(this,this.nb,97,this.kb,2,6);y(this,this.nb,113,this.jb,2,5);y(this,this.ob,41,this.Da,2,2);y(this,this.ob,37,this.D,2,3);y(this,this.ob,53,this.V,2,4);y(this,this.ob,45,this.A,3,4);y(this,this.ob,61,this.X,3,4);y(this,this.ob,
57,this.$a,3,4);y(this,this.ob,33,this.kb,2,6);y(this,this.ob,49,this.jb,2,5);y(this,this.yc,10,this.gd,1,2);y(this,this.yc,6,this.D,2,5);y(this,this.yc,22,this.V,2,6);y(this,this.yc,14,this.A,3,6);y(this,this.yc,30,this.X,3,7);y(this,this.If,144,this.lb,2,2);y(this,this.Jf,176,this.lb,2,2);y(this,this.Kf,240,this.lb,2,2);y(this,this.Le,36,this.D,2,3);y(this,this.Le,44,this.A,3,4);y(this,this.Lf,48,this.lb,2,2);y(this,this.Mf,208,this.lb,2,2);y(this,this.Nf,16,this.lb,2,2);y(this,this.Of,0,this.v,
1,7);y(this,this.Pf,80,this.lb,2,2);y(this,this.Qf,112,this.lb,2,2);y(this,this.Rf,24,this.v,1,2);y(this,this.Sf,216,this.v,1,2);y(this,this.Tf,88,this.v,1,2);y(this,this.Uf,184,this.v,1,2);y(this,this.pb,201,this.Da,2,2);y(this,this.pb,197,this.D,2,3);y(this,this.pb,213,this.V,2,4);y(this,this.pb,205,this.A,3,4);y(this,this.pb,221,this.X,3,4);y(this,this.pb,217,this.$a,3,4);y(this,this.pb,193,this.kb,2,6);y(this,this.pb,209,this.jb,2,5);y(this,this.Yd,224,this.Da,2,2);y(this,this.Yd,228,this.D,2,
3);y(this,this.Yd,236,this.A,3,4);y(this,this.Zd,192,this.Da,2,2);y(this,this.Zd,196,this.D,2,3);y(this,this.Zd,204,this.A,3,4);y(this,this.kd,198,this.D,2,5);y(this,this.kd,214,this.V,2,6);y(this,this.kd,206,this.A,3,6);y(this,this.kd,222,this.X,3,7);y(this,this.Vf,202,this.v,1,2);y(this,this.Wf,136,this.v,1,2);y(this,this.qb,73,this.Da,2,2);y(this,this.qb,69,this.D,2,3);y(this,this.qb,85,this.V,2,4);y(this,this.qb,77,this.A,3,4);y(this,this.qb,93,this.X,3,4);y(this,this.qb,89,this.$a,3,4);y(this,
this.qb,65,this.kb,2,6);y(this,this.qb,81,this.jb,2,5);y(this,this.ld,230,this.D,2,5);y(this,this.ld,246,this.V,2,6);y(this,this.ld,238,this.A,3,6);y(this,this.ld,254,this.X,3,7);y(this,this.Xf,232,this.v,1,2);y(this,this.Yf,200,this.v,1,2);y(this,this.Me,76,this.A,3,3);y(this,this.Me,108,this.xf,3,5);y(this,this.Zf,32,this.A,3,6);y(this,this.rb,169,this.Da,2,2);y(this,this.rb,165,this.D,2,3);y(this,this.rb,181,this.V,2,4);y(this,this.rb,173,this.A,3,4);y(this,this.rb,189,this.X,3,4);y(this,this.rb,
185,this.$a,3,4);y(this,this.rb,161,this.kb,2,6);y(this,this.rb,177,this.jb,2,5);y(this,this.zc,162,this.Da,2,2);y(this,this.zc,166,this.D,2,3);y(this,this.zc,182,this.Ge,2,4);y(this,this.zc,174,this.A,3,4);y(this,this.zc,190,this.$a,3,4);y(this,this.Ac,160,this.Da,2,2);y(this,this.Ac,164,this.D,2,3);y(this,this.Ac,180,this.V,2,4);y(this,this.Ac,172,this.A,3,4);y(this,this.Ac,188,this.X,3,4);y(this,this.Bc,74,this.gd,1,2);y(this,this.Bc,70,this.D,2,5);y(this,this.Bc,86,this.V,2,6);y(this,this.Bc,
78,this.A,3,6);y(this,this.Bc,94,this.X,3,7);y(this,this.$f,234,this.v,1,2);y(this,this.sb,9,this.Da,2,2);y(this,this.sb,5,this.D,2,3);y(this,this.sb,21,this.V,2,4);y(this,this.sb,13,this.A,3,4);y(this,this.sb,29,this.X,3,4);y(this,this.sb,25,this.$a,3,4);y(this,this.sb,1,this.kb,2,6);y(this,this.sb,17,this.jb,2,5);y(this,this.ag,72,this.v,1,3);y(this,this.bg,8,this.v,1,3);y(this,this.cg,104,this.v,1,4);y(this,this.dg,40,this.v,1,4);y(this,this.Cc,42,this.gd,1,2);y(this,this.Cc,38,this.D,2,5);y(this,
this.Cc,54,this.V,2,6);y(this,this.Cc,46,this.A,3,6);y(this,this.Cc,62,this.X,3,7);y(this,this.Dc,106,this.gd,1,2);y(this,this.Dc,102,this.D,2,5);y(this,this.Dc,118,this.V,2,6);y(this,this.Dc,110,this.A,3,6);y(this,this.Dc,126,this.X,3,7);y(this,this.eg,64,this.v,1,6);y(this,this.fg,96,this.v,1,6);y(this,this.tb,233,this.Da,2,2);y(this,this.tb,229,this.D,2,3);y(this,this.tb,245,this.V,2,4);y(this,this.tb,237,this.A,3,4);y(this,this.tb,253,this.X,3,4);y(this,this.tb,249,this.$a,3,4);y(this,this.tb,
225,this.kb,2,6);y(this,this.tb,241,this.jb,2,5);y(this,this.gg,56,this.v,1,2);y(this,this.hg,248,this.v,1,2);y(this,this.ig,120,this.v,1,2);y(this,this.Ob,133,this.D,2,3);y(this,this.Ob,149,this.V,2,4);y(this,this.Ob,141,this.A,3,4);y(this,this.Ob,157,this.X,3,5);y(this,this.Ob,153,this.$a,3,5);y(this,this.Ob,129,this.kb,2,6);y(this,this.Ob,145,this.jb,2,6);y(this,this.$d,134,this.D,2,3);y(this,this.$d,150,this.Ge,2,4);y(this,this.$d,142,this.A,3,4);y(this,this.ae,132,this.D,2,3);y(this,this.ae,
148,this.V,2,4);y(this,this.ae,140,this.A,3,4);y(this,this.jg,170,this.v,1,2);y(this,this.kg,168,this.v,1,2);y(this,this.lg,186,this.v,1,2);y(this,this.mg,138,this.v,1,2);y(this,this.ng,154,this.v,1,2);y(this,this.og,152,this.v,1,2);new Uint8Array([7,6,2,8,3,3,5,5,3,2,2,2,4,4,6,6,2,5,2,8,4,4,6,6,2,4,2,7,4,4,7,7,6,6,2,8,3,3,5,5,4,2,2,2,4,4,6,6,2,5,2,8,4,4,6,6,2,4,2,7,4,4,7,7,6,6,2,8,3,3,5,5,3,2,2,2,3,4,6,6,2,5,2,8,4,4,6,6,2,4,2,7,4,4,7,7,6,6,2,8,3,3,5,5,4,2,2,2,5,4,6,6,2,5,2,8,4,4,6,6,2,4,2,7,4,4,
7,7,2,6,2,6,3,3,3,3,2,2,2,2,4,4,4,4,2,6,2,6,4,4,4,4,2,5,2,5,5,5,5,5,2,6,2,6,3,3,3,3,2,2,2,2,4,4,4,4,2,5,2,5,4,4,4,4,2,4,2,4,4,4,4,4,2,6,2,8,3,3,5,5,2,2,2,2,4,4,6,6,2,5,2,8,4,4,6,6,2,4,2,7,4,4,7,7,2,6,3,8,3,3,5,5,2,2,2,2,4,4,6,6,2,5,2,8,4,4,6,6,2,4,2,7,4,4,7,7]);this.c=Array(56);this.c[0]="ADC";this.c[1]="AND";this.c[2]="ASL";this.c[3]="BCC";this.c[4]="BCS";this.c[5]="BEQ";this.c[6]="BIT";this.c[7]="BMI";this.c[8]="BNE";this.c[9]="BPL";this.c[10]="BRK";this.c[11]="BVC";this.c[12]="BVS";this.c[13]=
"CLC";this.c[14]="CLD";this.c[15]="CLI";this.c[16]="CLV";this.c[17]="CMP";this.c[18]="CPX";this.c[19]="CPY";this.c[20]="DEC";this.c[21]="DEX";this.c[22]="DEY";this.c[23]="EOR";this.c[24]="INC";this.c[25]="INX";this.c[26]="INY";this.c[27]="JMP";this.c[28]="JSR";this.c[29]="LDA";this.c[30]="LDX";this.c[31]="LDY";this.c[32]="LSR";this.c[33]="NOP";this.c[34]="ORA";this.c[35]="PHA";this.c[36]="PHP";this.c[37]="PLA";this.c[38]="PLP";this.c[39]="ROL";this.c[40]="ROR";this.c[41]="RTI";this.c[42]="RTS";this.c[43]=
"SBC";this.c[44]="SEC";this.c[45]="SED";this.c[46]="SEI";this.c[47]="STA";this.c[48]="STX";this.c[49]="STY";this.c[50]="TAX";this.c[51]="TAY";this.c[52]="TSX";this.c[53]="TXA";this.c[54]="TXS";this.c[55]="TYA"};
h.mb.Re.prototype={nb:0,ob:1,yc:2,If:3,Jf:4,Kf:5,Le:6,Lf:7,Mf:8,Nf:9,Of:10,Pf:11,Qf:12,Rf:13,Sf:14,Tf:15,Uf:16,pb:17,Yd:18,Zd:19,kd:20,Vf:21,Wf:22,qb:23,ld:24,Xf:25,Yf:26,Me:27,Zf:28,rb:29,zc:30,Ac:31,Bc:32,$f:33,sb:34,ag:35,bg:36,cg:37,dg:38,Cc:39,Dc:40,eg:41,fg:42,tb:43,gg:44,hg:45,ig:46,Ob:47,$d:48,ae:49,jg:50,kg:51,lg:52,mg:53,ng:54,og:55,D:0,lb:1,v:2,A:3,gd:4,Da:5,V:6,Ge:7,X:8,$a:9,kb:10,jb:11,xf:12};function y(a,b,c,d,e,f){a.qc[c]=b&255|(d&255)<<8|(e&255)<<16|(f&255)<<24};h.fc=function(){var a=0;this.Ma=new Uint8Array(8);for(a=0;8>a;a++)this.Ma[a]=64;this.Wa=new Uint8Array(8);for(a=0;8>a;a++)this.Wa[a]=64};h.fc.prototype={af:function(a){!z(this,a.keyCode,65)&&a.preventDefault&&a.preventDefault()},cf:function(a){!z(this,a.keyCode,64)&&a.preventDefault&&a.preventDefault()},bf:function(a){a.preventDefault()}};
function z(a,b,c){switch(b){case 88:a.Ma[0]=c;break;case 89:a.Ma[1]=c;break;case 90:a.Ma[1]=c;break;case 17:a.Ma[2]=c;break;case 13:a.Ma[3]=c;break;case 38:a.Ma[4]=c;break;case 40:a.Ma[5]=c;break;case 37:a.Ma[6]=c;break;case 39:a.Ma[7]=c;break;case 103:a.Wa[0]=c;break;case 105:a.Wa[1]=c;break;case 99:a.Wa[2]=c;break;case 97:a.Wa[3]=c;break;case 104:a.Wa[4]=c;break;case 98:a.Wa[5]=c;break;case 100:a.Wa[6]=c;break;case 102:a.Wa[7]=c;break;default:return!0}return!1};h.n={};h.n[0]=function(a){this.a=a};
h.n[0].prototype={reset:function(){this.Dd=this.Bb=this.Ab=0;this.Id=!1;this.Kd=this.Jd=null},write:function(a,b){8192>a?this.a.h.p[a&2047]=b:16407<a?this.a.h.p[a]=b:8199<a&&16384>a?A(this,8192+(a&7),b):A(this,a,b)},Jg:function(a,b){8192>a?this.a.h.p[a&2047]=b:16407<a?this.a.h.p[a]=b:8199<a&&16384>a?A(this,8192+(a&7),b):A(this,a,b)},load:function(a){a&=65535;return 16407<a?this.a.h.p[a]:8192<=a?ea(this,a):this.a.h.p[a&2047]},pc:function(){!this.a.b.valid||1>this.a.b.L?alert("NoMapper: Invalid ROM! Unable to load."):
(1<this.a.b.L?(C(this,0,32768),C(this,1,49152)):(C(this,0,32768),C(this,0,49152)),D(this),G(this),w(this.a.h,this.a.h.nd))},Gg:function(a,b){if(0!==this.a.b.C){H(this.a.o);var c=Math.floor(a/2)%this.a.b.C;h.ta.Qb(this.a.b.Za[c],a%2*2048,this.a.o.R,b,2048);for(var c=this.a.b.Nb[c],d=b>>4,e=0;128>e;e++)this.a.o.K[d+e]=c[(a%2<<7)+e]}},ge:function(){},Eg:function(){},toJSON:function(){return{joy1StrobeState:this.Ab,joy2StrobeState:this.Bb,joypadLastWrite:this.Dd}},G:function(a){this.Ab=a.joy1StrobeState;
this.Bb=a.joy2StrobeState;this.Dd=a.joypadLastWrite}};function I(a,b,c){h.ta.Qb(a.a.b.b[Math.floor(b/2)%a.a.b.L],b%2*8192,a.a.h.p,c,8192)}function J(a,b,c){if(0!==a.a.b.C){H(a.a.o);var d=Math.floor(b/4)%a.a.b.C;h.ta.Qb(a.a.b.Za[d],0,a.a.o.R,b%4*1024,1024);d=a.a.b.Nb[d];c>>=4;for(var e=0;64>e;e++)a.a.o.K[c+e]=d[(b%4<<6)+e]}}function K(a,b){0!==a.a.b.C&&(H(a.a.o),L(a,b%a.a.b.C,0),L(a,(b+1)%a.a.b.C,4096))}
function L(a,b,c){0!==a.a.b.C&&(H(a.a.o),h.ta.Qb(a.a.b.Za[b%a.a.b.C],0,a.a.o.R,c,4096),h.ta.Qb(a.a.b.Nb[b%a.a.b.C],0,a.a.o.K,c>>4,256))}function C(a,b,c){b%=a.a.b.L;h.ta.Qb(a.a.b.b[b],0,a.a.h.p,c,16384)}function G(a){if(a.a.b.de){var b=a.a.b.de;null!==b&&8192==b.length&&h.ta.Qb(b,0,a.a.h.p,24576,8192)}}function D(a){0<a.a.b.C&&(1==a.a.b.C?(L(a,0,0),L(a,0,4096)):(L(a,0,0),L(a,1,4096)))}
function M(a){var b;switch(a.Bb){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:b=a.a.Rc.Wa[a.Bb];break;case 8:case 9:case 10:case 11:case 12:case 13:case 14:case 15:case 16:case 17:case 18:b=0;break;case 19:b=1;break;default:b=0}a.Bb++;24==a.Bb&&(a.Bb=0);return b}
function A(a,b,c){switch(b){case 8192:a.a.h.p[b]=c;fa(a.a.o,c);break;case 8193:a.a.h.p[b]=c;ga(a.a.o,c);break;case 8195:a.a.o.Va=c;break;case 8196:a=a.a.o;a.ib[a.Va]=c;N(a,a.Va,c);a.Va++;a.Va%=256;break;case 8197:a=a.a.o;H(a);a.eb?(a.Ua=c>>3&31,a.Wc=c&7):(a.Eb=c&7,a.fa=c>>3&31);a.eb=!a.eb;break;case 8198:a=a.a.o;a.eb?(a.Eb=c>>4&3,a.Fb=c>>3&1,a.Ta=c>>2&1,a.fa=a.fa&7|(c&3)<<3):(H(a),a.fa=a.fa&24|c>>5&7,a.Ua=c&31,a.va=a.Eb,a.ca=a.Fb,a.ba=a.Ta,a.T=a.fa,a.wa=a.Ua,O(a,a.M-20));a.eb=!a.eb;P(a);break;case 8199:a=
a.a.o;H(a);P(a);Q(a);8192<=a.U?(b=a.U,16128<=b&&16160>b?16128==b||16144==b?(S(a,16128,c),S(a,16144,c)):16132==b||16148==b?(S(a,16132,c),S(a,16148,c)):16136==b||16152==b?(S(a,16136,c),S(a,16152,c)):16140==b||16156==b?(S(a,16140,c),S(a,16156,c)):S(a,b,c):b<a.Oa.length?S(a,a.Oa[b],c):alert("Invalid VRAM address: "+b.toString(16))):S(a,a.U,c);a.U+=1==a.Hc?32:1;ha(a);ia(a);break;case 16404:a=a.a.o;c*=256;for(var d=a.Va;256>d;d++)b=a.a.h.p[c+d],a.ib[d]=b,N(a,d,b);c=a.a.h;c.na+=513;break;case 16405:a.a.H.S(b,
c);break;case 16406:0===(c&1)&&1===(a.Dd&1)&&(a.Ab=0,a.Bb=0);a.Dd=c;break;case 16407:a.a.H.S(b,c);break;default:16384<=b&&16407>=b&&a.a.H.S(b,c)}}
function ea(a,b){switch(b>>12){case 2:case 3:switch(b&7){case 0:return a.a.h.p[8192];case 1:return a.a.h.p[8193];case 2:var c=a.a.o,d=c.a.h.p[8194];c.eb=!0;q(c,c.be,!1);return d;case 3:return 0;case 4:return c=a.a.o,c.ib[c.Va];case 5:return 0;case 6:return 0;case 7:return c=a.a.o,P(c),Q(c),16127>=c.U?(d=c.Wd,c.Wd=8192>c.U?c.R[c.U]:c.R[c.Oa[c.U]]):d=c.R[c.Oa[c.U]],c.U+=1==c.Hc?32:1,ia(c),ha(c),d}break;case 4:switch(b-16405){case 0:return a.a.H.hf(b);case 1:switch(a.Ab){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:c=
a.a.Rc.Ma[a.Ab];break;case 8:case 9:case 10:case 11:case 12:case 13:case 14:case 15:case 16:case 17:case 18:c=0;break;case 19:c=1;break;default:c=0}a.Ab++;24==a.Ab&&(a.Ab=0);return c;case 2:if(a.Id){for(var c=Math.max(0,a.Jd-4),d=Math.min(256,a.Jd+4),e=Math.max(0,a.Kd-4),f=Math.min(240,a.Kd+4),g=0;e<f;e++)for(var l=c;l<d;l++)if(16777215==a.a.o.buffer[(e<<8)+l]){g|=8;console.debug("Clicked on white!");break}g|=a.Id?16:0;return(M(a)|g)&65535}return M(a)}}return 0}h.n[1]=function(a){this.a=a};
h.n[1].prototype=new h.n[0];h.n[1].prototype.reset=function(){h.n[0].prototype.reset.apply(this);this.ef=this.gb=this.Db=this.bc=0;this.Vc=this.Uc=1;this.mf=this.$c=this.Gb=this.wc=0};
h.n[1].prototype.write=function(a,b){if(32768>a)h.n[0].prototype.write.apply(this,arguments);else if(0!==(b&128))this.bc=this.Db=0,0===ja(a)&&(this.Vc=this.Uc=1);else if(this.bc=this.bc&255-(1<<this.Db)|(b&1)<<this.Db,this.Db++,5==this.Db){var c=this.bc,d;switch(ja(a)){case 0:d=c&3;d!==this.gb&&(this.gb=d,0===(this.gb&2)?s(this.a.o,this.a.b.Ve):0!==(this.gb&1)?s(this.a.o,this.a.b.jd):s(this.a.o,this.a.b.od));this.Uc=c>>2&1;this.Vc=c>>3&1;this.wc=c>>4&1;break;case 1:this.Gb=c>>4&1;0<this.a.b.C&&(0===
this.wc?0===this.Gb?K(this,c&15):K(this,Math.floor(this.a.b.C/2)+(c&15)):0===this.Gb?L(this,c&15,0):L(this,Math.floor(this.a.b.C/2)+(c&15),0));break;case 2:this.$c=c>>4&1;0<this.a.b.C&&1===this.wc&&(0===this.$c?L(this,c&15,4096):L(this,Math.floor(this.a.b.C/2)+(c&15),4096));break;default:d=0,32<=this.a.b.L?0===this.wc?1===this.Gb&&(d=16):d=(this.Gb|this.$c<<1)<<3:16<=this.a.b.L&&1===this.Gb&&(d=8),0===this.Vc?(c=d+(c&15),C(this,2*c%this.a.b.L,32768),C(this,(2*c+1)%this.a.b.L,49152)):(c=2*d+(c&15),
0===this.Uc?C(this,c,49152):C(this,c,32768))}this.Db=this.bc=0}};function ja(a){return 32768<=a&&40959>=a?0:40960<=a&&49151>=a?1:49152<=a&&57343>=a?2:3}h.n[1].prototype.pc=function(){this.a.b.valid?(C(this,0,32768),C(this,this.a.b.L-1,49152),D(this),G(this),w(this.a.h,this.a.h.nd)):alert("MMC1: Invalid ROM! Unable to load.")};
h.n[1].prototype.toJSON=function(){var a=h.n[0].prototype.toJSON.apply(this);a.mirroring=this.gb;a.oneScreenMirroring=this.ef;a.prgSwitchingArea=this.Uc;a.prgSwitchingSize=this.Vc;a.vromSwitchingSize=this.wc;a.romSelectionReg0=this.Gb;a.romSelectionReg1=this.$c;a.romBankSelect=this.mf;a.regBuffer=this.bc;a.regBufferCounter=this.Db;return a};
h.n[1].prototype.G=function(a){h.n[0].prototype.G.apply(this,a);this.gb=a.mirroring;this.ef=a.oneScreenMirroring;this.Uc=a.prgSwitchingArea;this.Vc=a.prgSwitchingSize;this.wc=a.vromSwitchingSize;this.Gb=a.romSelectionReg0;this.$c=a.romSelectionReg1;this.mf=a.romBankSelect;this.bc=a.regBuffer;this.Db=a.regBufferCounter};h.n[2]=function(a){this.a=a};h.n[2].prototype=new h.n[0];h.n[2].prototype.write=function(a,b){32768>a?h.n[0].prototype.write.apply(this,arguments):C(this,b,32768)};
h.n[2].prototype.pc=function(){this.a.b.valid?(C(this,0,32768),C(this,this.a.b.L-1,49152),D(this),w(this.a.h,this.a.h.nd)):alert("UNROM: Invalid ROM! Unable to load.")};h.n[4]=function(a){this.a=a;this.Cf=0;this.Df=1;this.yf=2;this.zf=3;this.Af=4;this.Bf=5;this.Ef=6;this.Ff=7;this.Qc=this.Bd=this.mc=this.ff=this.ab=this.ac=this.sd=null;this.$b=!1};h.n[4].prototype=new h.n[0];
h.n[4].prototype.write=function(a,b){if(32768>a)h.n[0].prototype.write.apply(this,arguments);else switch(a){case 32768:this.sd=b&7;var c=b>>6&1;c!=this.ac&&(this.$b=!0);this.ac=c;this.ab=b>>7&1;break;case 32769:c=b;switch(this.sd){case this.Cf:0===this.ab?(J(this,c,0),J(this,c+1,1024)):(J(this,c,4096),J(this,c+1,5120));break;case this.Df:0===this.ab?(J(this,c,2048),J(this,c+1,3072)):(J(this,c,6144),J(this,c+1,7168));break;case this.yf:0===this.ab?J(this,c,4096):J(this,c,0);break;case this.zf:0===
this.ab?J(this,c,5120):J(this,c,1024);break;case this.Af:0===this.ab?J(this,c,6144):J(this,c,2048);break;case this.Bf:0===this.ab?J(this,c,7168):J(this,c,3072);break;case this.Ef:this.$b&&(0===this.ac?I(this,2*(this.a.b.L-1),49152):I(this,2*(this.a.b.L-1),32768),this.$b=!1);0===this.ac?I(this,c,32768):I(this,c,49152);break;case this.Ff:I(this,c,40960),this.$b&&(0===this.ac?I(this,2*(this.a.b.L-1),49152):I(this,2*(this.a.b.L-1),32768),this.$b=!1)}break;case 40960:0!==(b&1)?s(this.a.o,this.a.b.jd):
s(this.a.o,this.a.b.od);break;case 49152:this.mc=b;break;case 49153:this.Bd=b;break;case 57344:this.Qc=0;break;case 57345:this.Qc=1}};h.n[4].prototype.pc=function(){this.a.b.valid?(I(this,2*(this.a.b.L-1),49152),I(this,2*(this.a.b.L-1)+1,57344),I(this,0,32768),I(this,1,40960),D(this),G(this),w(this.a.h,this.a.h.nd)):alert("MMC3: Invalid ROM! Unable to load.")};h.n[4].prototype.ge=function(){1==this.Qc&&(this.mc--,0>this.mc&&(w(this.a.h,this.a.h.md),this.mc=this.Bd))};
h.n[4].prototype.toJSON=function(){var a=h.n[0].prototype.toJSON.apply(this);a.command=this.sd;a.prgAddressSelect=this.ac;a.chrAddressSelect=this.ab;a.pageNumber=this.ff;a.irqCounter=this.mc;a.irqLatchValue=this.Bd;a.irqEnable=this.Qc;a.prgAddressChanged=this.$b;return a};
h.n[4].prototype.G=function(a){h.n[0].prototype.G.apply(this,a);this.sd=a.command;this.ac=a.prgAddressSelect;this.ab=a.chrAddressSelect;this.ff=a.pageNumber;this.mc=a.irqCounter;this.Bd=a.irqLatchValue;this.Qc=a.irqEnable;this.$b=a.prgAddressChanged};h.Y=function(a){this.a=a;this.Ba=new h.Y.Xd(this,!0);this.Ca=new h.Y.Xd(this,!1);this.ra=new h.Y.Je(this);this.Ha=new h.Y.Ie(this);this.da=new h.Y.He(this);this.zd=4;this.lc=2048;this.Xe=8192;this.hc=0;this.nf=44100;this.Kb=this.Jb=this.P=this.O=this.Gd=null;this.ad=Array(2*this.Xe);this.Mc=!1;this.Lc=null;this.Ad=!1;this.Qd=this.Nc=this.cc=this.Fc=this.xa=this.Xb=null;this.Xa=0;this.J=this.ga=this.qa=this.ia=this.ha=null;this.he=this.Ze=this.cd=this.bd=this.Nd=this.Md=0;this.F=256;this.se=this.re=
this.wd=this.qf=this.rf=this.uf=this.tf=this.sf=this.ye=this.ze=this.Ce=this.Be=this.Ae=null;a=this.Zb=[80,170,100,150,128];for(var b=0;5>b;b++)this.Zb[b]=a[b];this.Ae=this.Zb[0]*this.F>>8;this.Be=this.Zb[1]*this.F>>8;this.Ce=this.Zb[2]*this.F>>8;this.ze=this.Zb[3]*this.F>>8;this.ye=this.Zb[4]*this.F>>8;this.sf=this.F-this.Ae;this.tf=this.F-this.Be;this.uf=this.F-this.Ce;this.rf=this.F-this.ze;this.qf=this.F-this.ye;this.Gd=[10,254,20,2,40,4,80,6,160,8,60,10,14,12,26,14,12,16,24,18,48,20,96,22,192,
24,72,26,16,28,32,30];this.O=Array(16);this.O[0]=3424;this.O[1]=3040;this.O[2]=2720;this.O[3]=2560;this.O[4]=2288;this.O[5]=2032;this.O[6]=1808;this.O[7]=1712;this.O[8]=1520;this.O[9]=1280;this.O[10]=1136;this.O[11]=1024;this.O[12]=848;this.O[13]=672;this.O[14]=576;this.O[15]=432;this.P=Array(16);this.P[0]=4;this.P[1]=8;this.P[2]=16;this.P[3]=32;this.P[4]=64;this.P[5]=96;this.P[6]=128;this.P[7]=160;this.P[8]=202;this.P[9]=254;this.P[10]=380;this.P[11]=508;this.P[12]=762;this.P[13]=1016;this.P[14]=
2034;this.P[15]=4068;var c,d=b=0;this.Jb=Array(512);this.Kb=Array(3264);for(a=0;512>a;a++)c=95.52/(8128/(a/16)+100),c*=.98411,c*=5E4,c=Math.floor(c),this.Jb[a]=c,c>b&&(b=c);for(a=0;3264>a;a++)c=163.67/(24329/(a/16)+100),c*=.98411,c*=5E4,c=Math.floor(c),this.Kb[a]=c,c>d&&(d=c);this.Ze=b+d;this.he=this.Ze/2;for(a=0;20>a;a++)16===a?this.S(16400,16):this.S(16384+a,0);this.reset()};
h.Y.prototype={reset:function(){this.nf=this.a.Q.sampleRate;this.Qd=Math.floor(1024*this.a.Q.CPU_FREQ_NTSC*this.a.Q.vg/(60*this.nf));this.Nc=Math.floor(14915*this.a.Q.vg/60);this.hc=this.cc=0;ka(this,0);this.Fc=this.xa=this.Xb=0;this.lc=2048;this.Ad=this.Mc=!1;this.xa=0===this.Fc?4:0;this.Ba.reset();this.Ca.reset();this.ra.reset();this.Ha.reset();this.da.reset();this.ga=this.qa=this.ia=this.ha=this.J=this.hc=0;this.Mc=!1;this.zd=4;this.cd=this.bd=this.Nd=this.Md=0;this.re=-5E5;this.se=5E5},hf:function(){var a;
a=0|this.Ba.xb();a|=this.Ca.xb()<<1;a|=this.ra.xb()<<2;a|=this.Ha.xb()<<3;a|=this.da.xb()<<4;a|=(this.Lc&&this.Mc?1:0)<<6;a|=(this.da.Wb?1:0)<<7;this.Lc=!1;this.da.Wb=!1;return a&65535},S:function(a,b){16384<=a&&16388>a?this.Ba.S(a,b):16388<=a&&16392>a?this.Ca.S(a,b):16392<=a&&16396>a?this.ra.S(a,b):16396<=a&&16399>=a?this.Ha.S(a,b):16400===a?this.da.S(a,b):16401===a?this.da.S(a,b):16402===a?this.da.S(a,b):16403===a?this.da.S(a,b):16405===a?(ka(this,b),0!==b&&0<this.lc&&(this.Ad=!0),this.da.S(a,b)):
16407===a&&(this.Fc=b>>7&1,this.Xb=0,this.Lc=!1,this.Mc=0===(b>>6&1),0===this.Fc?this.xa=this.zd=4:(this.zd=5,this.xa=0,la(this)))},hb:function(){var a,b;0<this.J?(this.ha<<=4,this.ha=Math.floor(this.ha/this.J),this.ia<<=4,this.ia=Math.floor(this.ia/this.J),this.qa=Math.floor(this.qa/this.J),this.ga<<=4,this.ga=Math.floor(this.ga/this.J),this.J=0):(this.ha=this.Ba.B<<4,this.ia=this.Ca.B<<4,this.qa=this.ra.B,this.ga=this.da.hb<<4);var c=Math.floor((this.Ha.gc<<4)/this.Ha.J);this.Ha.gc=c>>4;this.Ha.J=
1;a=this.ha*this.Ae+this.ia*this.Be>>8;b=3*this.qa*this.Ce+(c<<1)*this.ze+this.ga*this.ye>>8;a>=this.Jb.length&&(a=this.Jb.length-1);b>=this.Kb.length&&(b=this.Kb.length-1);var d=this.Jb[a]+this.Kb[b]-this.he;a=this.ha*this.sf+this.ia*this.tf>>8;b=3*this.qa*this.uf+(c<<1)*this.rf+this.ga*this.qf>>8;a>=this.Jb.length&&(a=this.Jb.length-1);b>=this.Kb.length&&(b=this.Kb.length-1);a=this.Jb[a]+this.Kb[b]-this.he;d-=this.Md;this.Md+=d;d=this.bd+=d-(this.bd>>10);a-=this.Nd;this.Nd+=a;a=this.cd+=a-(this.cd>>
10);d>this.re&&(this.re=d);d<this.se&&(this.se=d);this.ad[this.hc++]=d;this.ad[this.hc++]=a;this.hc===this.ad.length&&(this.a.ui.vf(this.ad),this.ad=Array(2*this.Xe),this.hc=0);this.ga=this.qa=this.ia=this.ha=0}};function la(a){a.xa++;a.xa>=a.zd&&(a.xa=0);if(1===a.xa||3===a.xa)a.ra.ic(),a.Ba.ic(),a.Ca.ic(),a.Ha.ic(),ma(a.Ba),ma(a.Ca);if(0<=a.xa&&4>a.xa){a.Ba.rd();a.Ca.rd();a.Ha.rd();var b=a.ra;b.Fd?(b.oc=b.qe,T(b)):0<b.oc&&(b.oc--,T(b));b.Ed||(b.Fd=!1)}3===a.xa&&0===a.Fc&&(a.Lc=!0)}
function k(a,b){if(0<a.lc&&a.Ad)a.lc-=b,0>=a.lc&&(a.Ad=!1);else{b+=a.wd;var c=a.Qd-a.cc;b<<10>c?(a.wd=(b<<10)-c>>10,b-=a.wd):a.wd=0;var d=a.da,e=a.ra,f=a.Ba,g=a.Ca,c=a.Ha;if(d.isEnabled)for(d.tc-=b<<3;0>=d.tc&&0<d.vd;){d.tc+=d.vd;var l=d;l.oe&&(0===(l.data&1)?0<l.wb&&l.wb--:63>l.wb&&l.wb++,l.hb=l.isEnabled?(l.wb<<1)+l.td:0,l.data>>=1);l.ud--;if(0>=l.ud){l.oe=!1;var m=l;0===m.Ia&&m.sc===m.Oe&&(m.Cb=m.Tc,m.Ia=m.rc);if(0<m.Ia){var n=m;n.data=n.H.a.l.load(n.Cb);var p=n.H.a.h;p.na+=4;n.Ia--;n.Cb++;65535<
n.Cb&&(n.Cb=32768);n.oe=!0;0===m.Ia&&m.sc===m.Ne&&(m.Wb=!0)}l.ud=8}l.Wb&&w(l.H.a.h,l.H.a.h.md)}if(0<e.e)for(e.t-=b;0>=e.t;)e.t+=e.e+1,0<e.oc&&0<e.r&&(e.Lb++,e.Lb&=31,e.isEnabled&&(e.B=16<=e.Lb?e.Lb&15:15-(e.Lb&15),e.B<<=4));f.t-=b;0>=f.t&&(f.t+=f.e+1<<1,f.Ib++,f.Ib&=7,f.Ya());g.t-=b;0>=g.t&&(g.t+=g.e+1<<1,g.Ib++,g.Ib&=7,g.Ya());d=b;if(0<c.t-d)c.t-=d,c.J+=d,c.gc+=d*c.B;else for(;0<d--;)0>=--c.t&&0<c.e&&(c.dc<<=1,c.ed=(c.dc<<(0===c.ue?1:6)^c.dc)&32768,0!==c.ed?(c.dc|=1,c.Od=0,c.B=0):(c.Od=1,c.B=c.isEnabled&&
0<c.r?c.F:0),c.t+=c.e),c.gc+=c.B,c.J++;a.Mc&&a.Lc&&w(a.a.h,a.a.h.md);a.Xb+=b<<1;a.Xb>=a.Nc&&(a.Xb-=a.Nc,la(a));c=b;a.ra.ve&&(a.Xa=Math.floor((a.ra.t<<4)/(a.ra.e+1)),16<a.Xa&&(a.Xa=16),16<=a.ra.Lb&&(a.Xa=16-a.Xa),a.Xa+=a.ra.B);2===c?(a.qa+=a.Xa<<1,a.ga+=a.da.hb<<1,a.ha+=a.Ba.B<<1,a.ia+=a.Ca.B<<1,a.J+=2):4===c?(a.qa+=a.Xa<<2,a.ga+=a.da.hb<<2,a.ha+=a.Ba.B<<2,a.ia+=a.Ca.B<<2,a.J+=4):(a.qa+=c*a.Xa,a.ga+=c*a.da.hb,a.ha+=c*a.Ba.B,a.ia+=c*a.Ca.B,a.J+=c);a.cc+=b<<10;a.cc>=a.Qd&&(a.hb(),a.cc-=a.Qd)}}
function ka(a,b){a.Ba.Hb(0!==(b&1));a.Ca.Hb(0!==(b&2));a.ra.Hb(0!==(b&4));a.Ha.Hb(0!==(b&8));a.da.Hb(0!==(b&16))}h.Y.He=function(a){this.H=a;this.Pe=0;this.Oe=1;this.Ne=2;this.oe=this.isEnabled=null;this.Wb=!1;this.data=this.td=this.hb=this.tc=this.Ia=this.rc=this.Cb=this.Tc=this.wb=this.ud=this.vd=this.sc=null;this.reset()};
h.Y.He.prototype={S:function(a,b){if(16400===a){0===b>>6?this.sc=this.Pe:1===(b>>6&1)?this.sc=this.Oe:2===b>>6&&(this.sc=this.Ne);0===(b&128)&&(this.Wb=!1);var c=b&15;this.vd=0<=c&&16>c?this.H.O[c]:0}else 16401===a?(this.wb=b>>1&63,this.td=b&1,this.hb=(this.wb<<1)+this.td):16402===a?this.Cb=this.Tc=b<<6|49152:16403===a?this.Ia=this.rc=(b<<4)+1:16405===a&&(0===(b>>4&1)?this.Ia=0:(this.Cb=this.Tc,this.Ia=this.rc),this.Wb=!1)},Hb:function(a){!this.isEnabled&&a&&(this.Ia=this.rc);this.isEnabled=a},xb:function(){return 0!==
this.Ia&&this.isEnabled?1:0},reset:function(){this.Wb=this.isEnabled=!1;this.sc=this.Pe;this.data=this.tc=this.td=this.hb=this.Ia=this.rc=this.Cb=this.Tc=this.wb=this.ud=this.vd=0}};h.Y.Ie=function(a){this.H=a;this.F=this.ea=this.bb=this.oa=this.e=this.t=this.r=this.Ub=this.Ga=this.Tb=this.cb=this.isEnabled=null;this.dc=16384;this.B=this.ue=this.Od=null;this.gc=0;this.J=1;this.ed=null;this.reset()};
h.Y.Ie.prototype={reset:function(){this.e=this.t=0;this.isEnabled=!1;this.r=0;this.Tb=this.cb=this.Ga=!1;this.F=this.ea=this.bb=this.oa=0;this.dc=1;this.ed=this.B=this.ue=this.Od=0},ic:function(){this.Ga&&0<this.r&&(this.r--,0===this.r&&this.Ya())},rd:function(){this.Ub?(this.Ub=!1,this.bb=this.oa+1,this.ea=15):0>=--this.bb&&(this.bb=this.oa+1,0<this.ea?this.ea--:this.ea=this.Tb?15:0);this.F=this.cb?this.oa:this.ea;this.Ya()},Ya:function(){this.isEnabled&&0<this.r&&(this.B=this.Od*this.F)},S:function(a,
b){if(16396===a)this.cb=0!==(b&16),this.oa=b&15,this.Tb=0!==(b&32),this.Ga=0===(b&32),this.F=this.cb?this.oa:this.ea;else if(16398===a){var c=b&15;this.e=0<=c&&16>c?this.H.P[c]:0;this.ue=b>>7}else 16399===a&&(this.r=this.H.Gd[(b&248)>>3],this.Ub=!0)},Hb:function(a){this.isEnabled=a;a||(this.r=0);this.Ya()},xb:function(){return 0!==this.r&&this.isEnabled?1:0}};
h.Y.Xd=function(a,b){this.H=a;this.sg=[0,1,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,1,1,1,1,0,0,0,1,0,0,1,1,1,1,1];this.pf=b;this.B=this.je=this.F=this.ea=this.bb=this.oa=this.vc=this.Ud=this.Td=this.Sd=this.Ib=this.r=this.e=this.t=this.Ee=this.Ub=this.Tb=this.cb=this.De=this.Ga=this.isEnabled=null;this.reset()};
h.Y.Xd.prototype={reset:function(){this.je=this.F=this.ea=this.bb=this.oa=this.vc=this.Ud=this.Td=this.Sd=this.Ib=this.r=this.e=this.t=0;this.Tb=this.cb=this.De=this.Ga=this.isEnabled=!1},ic:function(){this.Ga&&0<this.r&&(this.r--,0===this.r&&this.Ya())},rd:function(){this.Ub?(this.Ub=!1,this.bb=this.oa+1,this.ea=15):0>=--this.bb&&(this.bb=this.oa+1,0<this.ea?this.ea--:this.ea=this.Tb?15:0);this.F=this.cb?this.oa:this.ea;this.Ya()},Ya:function(){this.B=this.isEnabled&&0<this.r&&7<this.e?0===this.Ud&&
4095<this.e+(this.e>>this.vc)?0:this.F*this.sg[(this.je<<3)+this.Ib]:0},S:function(a,b){var c=this.pf?0:4;a===16384+c?(this.cb=0!==(b&16),this.oa=b&15,this.Tb=0!==(b&32),this.je=b>>6&3,this.Ga=0===(b&32),this.F=this.cb?this.oa:this.ea,this.Ya()):a===16385+c?(this.De=0!==(b&128),this.Td=b>>4&7,this.Ud=b>>3&1,this.vc=b&7,this.Ee=!0):a===16386+c?(this.e&=1792,this.e|=b):a===16387+c&&(this.e&=255,this.e|=(b&7)<<8,this.isEnabled&&(this.r=this.H.Gd[(b&248)>>3]),this.Ub=!0)},Hb:function(a){this.isEnabled=
a;a||(this.r=0);this.Ya()},xb:function(){return 0!==this.r&&this.isEnabled?1:0}};function ma(a){0>=--a.Sd&&(a.Sd=a.Td+1,a.De&&0<a.vc&&7<a.e&&(0===a.Ud?(a.e+=a.e>>a.vc,4095<a.e&&(a.e=4095)):a.e-=(a.e>>a.vc)-(a.pf?1:0)));a.Ee&&(a.Ee=!1,a.Sd=a.Td+1)}h.Y.Je=function(a){this.H=a;this.ed=this.B=this.qe=this.oc=this.r=this.Lb=this.e=this.t=this.Ed=this.Fd=this.Ga=this.ve=this.isEnabled=null;this.reset()};
h.Y.Je.prototype={reset:function(){this.Lb=this.e=this.t=0;this.ve=this.isEnabled=!1;this.r=0;this.Ga=!1;this.qe=this.oc=0;this.Fd=!0;this.Ed=!1;this.ed=0;this.B=15},ic:function(){this.Ga&&0<this.r&&(this.r--,0===this.r&&T(this))},xb:function(){return 0!==this.r&&this.isEnabled?1:0},hf:function(){return 0},S:function(a,b){16392===a?(this.Ed=0!==(b&128),this.qe=b&127,this.Ga=!this.Ed):16394===a?(this.e&=1792,this.e|=b):16395===a&&(this.e&=255,this.e|=(b&7)<<8,this.r=this.H.Gd[(b&248)>>3],this.Fd=!0);
T(this)},Hb:function(a){this.isEnabled=a;a||(this.r=0);T(this)}};function T(a){a.ve=a.isEnabled&&7<a.e&&0<a.oc&&0<a.r};h.Z=function(a){this.a=a;this.Yb=this.Oa=this.za=this.jc=this.m=this.K=this.Pc=this.ec=this.Oc=this.Ka=this.Ja=this.ee=this.yb=this.sa=this.uc=this.La=this.u=this.ma=this.Sb=this.fb=this.M=this.of=this.Mb=this.pa=this.pd=this.gf=this.buffer=this.ub=this.vb=this.Pd=this.Wc=this.Ua=this.fa=this.Ta=this.Fb=this.Eb=this.wa=this.T=this.ba=this.ca=this.va=this.Vb=this.xd=this.yd=this.Ra=this.ya=this.Ic=this.me=this.Hc=this.Jc=this.le=this.kc=this.ne=this.Rd=this.Sc=this.Mb=this.Gc=this.df=this.Xc=this.jc=
this.Va=this.eb=this.Wd=this.fd=this.U=this.ib=this.R=null;this.Ag=!1;this.fe=!0;this.reset()};
h.Z.prototype={We:6,be:7,reset:function(){var a;this.R=new Uint8Array(32768);this.ib=new Uint8Array(256);for(a=0;a<this.R.length;a++)this.R[a]=0;for(a=0;a<this.ib.length;a++)this.ib[a]=0;this.fd=this.U=null;this.Wd=0;this.eb=!0;this.Va=0;this.jc=-1;this.Mb=this.Gc=this.df=this.Xc=!1;this.Sc=0;this.Rd=null;this.Pd=this.Wc=this.Ua=this.fa=this.Ta=this.Fb=this.Eb=this.wa=this.T=this.ba=this.ca=this.va=this.Vb=this.xd=this.yd=this.Ra=this.ya=this.Ic=this.me=this.Hc=this.Jc=this.le=this.kc=this.ne=0;this.vb=
null;this.ub=Array(32);this.buffer=Array(61440);this.gf=Array(61440);this.pd=Array(61440);this.pa=Array(61440);this.Mb=null;this.of=Array(32);this.M=0;this.fb=-1;this.Sb=0;this.ma=Array(64);this.u=Array(64);this.La=Array(64);this.uc=Array(64);this.sa=Array(64);this.yb=Array(64);this.ee=Array(64);this.Ka=this.Ja=0;this.Oc=!1;this.ec=Array(16);this.Pc=Array(16);this.K=Array(512);for(a=0;512>a;a++)this.K[a]=new h.Z.ce;this.m=Array(4);this.jc=-1;this.za=Array(4);for(a=0;4>a;a++)this.za[a]=new h.Z.Qe(32,
32,"Nt"+a);this.Oa=Array(32768);for(a=0;32768>a;a++)this.Oa[a]=a;a=this.Yb=new h.Z.Se;a.Rb=[5395026,11796480,10485760,11599933,7602281,91,95,6208,12048,543240,26368,1196544,7153664,0,0,0,12899815,16728064,14421538,16729963,14090399,6818519,6588,21681,27227,35843,43776,2918400,10777088,0,0,0,16316664,16755516,16742785,16735173,16730354,14633471,4681215,46327,57599,58229,259115,7911470,15065624,7895160,0,0,16777215,16773822,16300216,16300248,16758527,16761855,13095423,10148607,8973816,8650717,12122296,
16119980,16777136,16308472,0,0];for(var b,c,d,e,f,g,l,m=0;8>m;m++)for(l=g=f=1,0!==(m&1)&&(l=f=.75),0!==(m&2)&&(g=f=.75),0!==(m&4)&&(l=g=.75),a.ke[m]=Array(64),e=0;64>e;e++)d=a.Rb[e],b=Math.floor((d>>16&255)*f),c=Math.floor((d>>8&255)*g),d=Math.floor((d&255)*l),a.ke[m][e]=b<<16|c<<8|d;U(a,0);fa(this,0);ga(this,0)},Pb:{R:"vramMem",ib:"spriteMem",va:"cntFV",ca:"cntV",ba:"cntH",T:"cntVT",wa:"cntHT",Eb:"regFV",Fb:"regV",Ta:"regH",fa:"regVT",Ua:"regHT",Wc:"regFH",Pd:"regS",U:"vramAddress",fd:"vramTmpAddress",
ne:"f_nmiOnVblank",kc:"f_spriteSize",le:"f_bgPatternTable",Jc:"f_spPatternTable",Hc:"f_addrInc",me:"f_nTblAddress",Ic:"f_color",ya:"f_spVisibility",Ra:"f_bgVisibility",yd:"f_spClipping",xd:"f_bgClipping",Vb:"f_dispType",Wd:"vramBufferedReadValue",eb:"firstWrite",jc:"currentMirroring",Oa:"vramMirrorTable",m:"ntable1",Va:"sramAddress",Oc:"hitSpr0",ec:"sprPalette",Pc:"imgPalette",Sb:"curX",M:"scanline",fb:"lastRenderedScanline",vb:"curNt",ub:"attrib",buffer:"buffer",pd:"bgbuffer",pa:"pixrendered",Xc:"requestEndFrame",
df:"nmiOk",Gc:"dummyCycleToggle",Sc:"nmiCounter",Mb:"validTileData",Rd:"scanlineAlreadyRendered"},toJSON:function(){var a,b=h.ta.toJSON(this);b.nameTable=[];for(a=0;a<this.za.length;a++)b.nameTable[a]=this.za[a].toJSON();b.ptTile=[];for(a=0;a<this.K.length;a++)b.ptTile[a]=this.K[a].toJSON();return b},G:function(a){var b;h.ta.G(this,a);for(b=0;b<this.za.length;b++)this.za[b].G(a.nameTable[b]);for(b=0;b<this.K.length;b++)this.K[b].G(a.ptTile[b]);for(b=0;b<this.ib.length;b++)N(this,b,this.ib[b])}};
function N(a,b,c){var d=Math.floor(b/4);0===d&&O(a,a.M-20);0===b%4?a.u[d]=c:1==b%4?a.La[d]=c:2==b%4?(a.sa[d]=0!==(c&128),a.yb[d]=0!==(c&64),a.ee[d]=0!==(c&32),a.uc[d]=(c&3)<<2):3==b%4&&(a.ma[d]=c)}function V(a,b,c,d){a.za[b].Vd[c]=d;O(a,a.M-20)}function na(a){var b;for(b=0;16>b;b++)a.Pc[b]=0===a.Vb?a.Yb.Rb[a.R[16128+b]&63]:a.Yb.Rb[a.R[16128+b]&32];for(b=0;16>b;b++)a.ec[b]=0===a.Vb?a.Yb.Rb[a.R[16144+b]&63]:a.Yb.Rb[a.R[16144+b]&32]}
function S(a,b,c){a.R[b]=c;if(8192>b){a.R[b]=c;var d=Math.floor(b/16),e=b%16;8>e?W(a.K[d],e,c,a.R[b+8]):W(a.K[d],e-8,a.R[b-8],c)}else 8192<=b&&9152>b?V(a,a.m[0],b-8192,c):9152<=b&&9216>b?X(a.za[a.m[0]],b-9152,c):9216<=b&&10176>b?V(a,a.m[1],b-9216,c):10176<=b&&10240>b?X(a.za[a.m[1]],b-10176,c):10240<=b&&11200>b?V(a,a.m[2],b-10240,c):11200<=b&&11264>b?X(a.za[a.m[2]],b-11200,c):11264<=b&&12224>b?V(a,a.m[3],b-11264,c):12224<=b&&12288>b?X(a.za[a.m[3]],b-12224,c):16128<=b&&16160>b&&na(a)}
function O(a,b){a.Ja=-1;a.Ka=-1;var c,d=0===a.Jc?0:256,e,f,g;e=a.ma[0];c=a.u[0]+1;if(0===a.kc){if(c<=b&&c+8>b&&-7<=e&&256>e)if(d=a.K[a.La[0]+d],c=a.sa[0]?7-(b-c):b-c,c*=8,g=256*b+e,a.yb[0])for(f=7;0<=f;f--){if(0<=e&&256>e&&0<=g&&61440>g&&0!==a.pa[g]&&0!==d.la[c+f])return a.Ja=g%256,a.Ka=b,!0;e++;g++}else for(f=0;8>f;f++){if(0<=e&&256>e&&0<=g&&61440>g&&0!==a.pa[g]&&0!==d.la[c+f])return a.Ja=g%256,a.Ka=b,!0;e++;g++}}else if(c<=b&&c+16>b&&-7<=e&&256>e)if(c=a.sa[0]?15-(b-c):b-c,8>c?d=a.K[a.La[0]+(a.sa[0]?
1:0)+(0!==(a.La[0]&1)?255:0)]:(d=a.K[a.La[0]+(a.sa[0]?0:1)+(0!==(a.La[0]&1)?255:0)],c=a.sa[0]?15-c:c-8),c*=8,g=256*b+e,a.yb[0])for(f=7;0<=f;f--){if(0<=e&&256>e&&0<=g&&61440>g&&0!==a.pa[g]&&0!==d.la[c+f])return a.Ja=g%256,a.Ka=b,!0;e++;g++}else for(f=0;8>f;f++){if(0<=e&&256>e&&0<=g&&61440>g&&0!==a.pa[g]&&0!==d.la[c+f])return a.Ja=g%256,a.Ka=b,!0;e++;g++}return!1}
function oa(a,b,c,d){if(1===a.ya)for(var e=0;64>e;e++)if(a.ee[e]==d&&0<=a.ma[e]&&256>a.ma[e]&&a.u[e]+8>=b&&a.u[e]<b+c)if(0===a.kc)a.we=0,a.xe=8,a.u[e]<b&&(a.we=b-a.u[e]-1),a.u[e]+8>b+c&&(a.xe=b+c-a.u[e]+1),0===a.Jc?Y(a.K[a.La[e]],a.buffer,a.we,a.xe,a.ma[e],a.u[e]+1,a.uc[e],a.ec,a.yb[e],a.sa[e],e,a.pa):Y(a.K[a.La[e]+256],a.buffer,a.we,a.xe,a.ma[e],a.u[e]+1,a.uc[e],a.ec,a.yb[e],a.sa[e],e,a.pa);else{var f=a.La[e];0!==(f&1)&&(f=a.La[e]-1+256);var g=0,l=8;a.u[e]<b&&(g=b-a.u[e]-1);a.u[e]+8>b+c&&(l=b+c-
a.u[e]);Y(a.K[f+(a.sa[e]?1:0)],a.buffer,g,l,a.ma[e],a.u[e]+1,a.uc[e],a.ec,a.yb[e],a.sa[e],e,a.pa);g=0;l=8;a.u[e]+8<b&&(g=b-(a.u[e]+8+1));a.u[e]+16>b+c&&(l=b+c-(a.u[e]+8));Y(a.K[f+(a.sa[e]?0:1)],a.buffer,g,l,a.ma[e],a.u[e]+1+8,a.uc[e],a.ec,a.yb[e],a.sa[e],e,a.pa)}}
function pa(a,b,c){var d=0===a.Pd?0:256,e=(c<<8)-a.Wc;a.vb=a.m[a.ca+a.ca+a.ba];a.wa=a.Ua;a.ba=a.Ta;a.vb=a.m[a.ca+a.ca+a.ba];if(240>c&&0<=c-a.va){var f=a.va<<3,g=a.of,l=a.ub,m=a.K,n=a.za,p=a.Pc,v=a.pa;b=b?a.pd:a.buffer;for(var r,t,B,E=0;32>E;E++){if(0<=c){a.Mb?(r=g[E],t=r.la,B=l[E]):(t=n[a.vb],r=m[d+t.Vd[a.T*t.width+a.wa]],t=r.la,B=n[a.vb],B=B.ub[a.T*B.width+a.wa],g[E]=r,l[E]=B);var F=0,R=(E<<3)-a.Wc;if(-8<R)if(0>R&&(e-=R,F=-R),r.Ld[a.va])for(;8>F;F++)b[e]=p[t[f+F]+B],v[e]|=256,e++;else for(;8>F;F++)r=
t[f+F],0!==r&&(b[e]=p[r+B],v[e]|=256),e++}32==++a.wa&&(a.wa=0,a.ba++,a.ba%=2,a.vb=a.m[(a.ca<<1)+a.ba])}a.Mb=!0}a.va++;8==a.va&&(a.va=0,a.T++,30==a.T?(a.T=0,a.ca++,a.ca%=2,a.vb=a.m[(a.ca<<1)+a.ba]):32==a.T&&(a.T=0),a.Mb=!1)}function qa(a,b,c){1==a.ya&&oa(a,b,c,!0);if(1==a.Ra){var d=b+c<<8;61440<d&&(d=61440);for(var e=a.buffer,f=a.pd,g=a.pa,l=b<<8;l<d;l++)255<g[l]&&(e[l]=f[l])}1==a.ya&&oa(a,b,c,!1);a.Mb=!1}function H(a){21<=a.M&&260>=a.M&&(qa(a,a.fb+1,a.M-21-a.fb),a.fb=a.M-21)}
function P(a){var b=(a.va&7)<<4,b=b|(a.ca&1)<<3,b=b|(a.ba&1)<<2,b=b|a.T>>3&3,c=(a.T&7)<<5,c=c|a.wa&31;a.U=(b<<8|c)&32767}function Q(a){var b=(a.Eb&7)<<4,b=b|(a.Fb&1)<<3,b=b|(a.Ta&1)<<2,b=b|a.fa>>3&3,c=(a.fa&7)<<5,c=c|a.Ua&31;a.fd=(b<<8|c)&32767}function ia(a){var b=a.U>>8&255;a.va=b>>4&3;a.ca=b>>3&1;a.ba=b>>2&1;a.T=a.T&7|(b&3)<<3;b=a.U&255;a.T=a.T&24|b>>5&7;a.wa=b&31}
function ha(a){var b=a.fd>>8&255;a.Eb=b>>4&7;a.Fb=b>>3&1;a.Ta=b>>2&1;a.fa=a.fa&7|(b&3)<<3;b=a.fd&255;a.fa=a.fa&24|b>>5&7;a.Ua=b&31}function q(a,b,c){b=1<<b;a.a.h.p[8194]=a.a.h.p[8194]&255-b|(c?b:0)}function ga(a,b){H(a);a.Ic=b>>5&7;a.ya=b>>4&1;a.Ra=b>>3&1;a.yd=b>>2&1;a.xd=b>>1&1;a.Vb=b&1;0===a.Vb&&U(a.Yb,a.Ic);na(a)}function fa(a,b){H(a);a.ne=b>>7&1;a.kc=b>>5&1;a.le=b>>4&1;a.Jc=b>>3&1;a.Hc=b>>2&1;a.me=b&3;a.Fb=b>>1&1;a.Ta=b&1;a.Pd=b>>4&1}
function aa(a){var b=0;if(0===a.Vb)b=a.Pc[0];else switch(a.Ic){case 0:b=0;break;case 1:b=65280;break;case 2:b=16711680;break;case 3:b=0;break;case 4:b=255;break;default:b=0}var c=a.buffer,d;for(d=0;61440>d;d++)c[d]=b;a=a.pa;for(d=0;d<a.length;d++)a[d]=65}
function da(a){switch(a.M){case 19:a.Gc&&(a.Sb=1,a.Gc=!a.Gc);break;case 20:q(a,a.be,!1);q(a,a.We,!1);a.Oc=!1;a.Ja=-1;a.Ka=-1;if(1==a.Ra||1==a.ya)a.va=a.Eb,a.ca=a.Fb,a.ba=a.Ta,a.T=a.fa,a.wa=a.Ua,1==a.Ra&&pa(a,!1,0);1==a.Ra&&1==a.ya&&O(a,0);1!=a.Ra&&1!=a.ya||a.a.l.ge();break;case 261:q(a,a.be,!0);a.Xc=!0;a.Sc=9;a.M=-1;break;default:21<=a.M&&260>=a.M&&(1==a.Ra&&(a.Rd||(a.wa=a.Ua,a.ba=a.Ta,pa(a,!0,a.M+1-21)),a.Rd=!1,!a.Oc&&1==a.ya&&-7<=a.ma[0]&&256>a.ma[0]&&a.u[0]+1<=a.M-20&&a.u[0]+1+(0===a.kc?8:16)>=
a.M-20&&O(a,a.M-20)&&(a.Oc=!0)),1!=a.Ra&&1!=a.ya||a.a.l.ge())}a.M++;Q(a);P(a)}
function ca(a){w(a.a.h,a.a.h.pg);239>a.fb&&qa(a,a.fb+1,240-a.fb);var b,c,d=a.buffer;if(a.Ag){if(0<=a.ma[0]&&256>a.ma[0]&&0<=a.u[0]&&240>a.u[0]){for(b=0;256>b;b++)d[(a.u[0]<<8)+b]=16733525;for(b=0;240>b;b++)d[(b<<8)+a.ma[0]]=16733525}if(0<=a.Ja&&256>a.Ja&&0<=a.Ka&&240>a.Ka){for(b=0;256>b;b++)d[(a.Ka<<8)+b]=5635925;for(b=0;240>b;b++)d[(b<<8)+a.Ja]=5635925}}if(a.fe||0===a.xd||0===a.yd)for(c=0;240>c;c++)for(b=0;8>b;b++)d[(c<<8)+b]=0;if(a.fe)for(c=0;240>c;c++)for(b=0;8>b;b++)d[(c<<8)+255-b]=0;if(a.fe)for(c=
0;8>c;c++)for(b=0;256>b;b++)d[(c<<8)+b]=0,d[(239-c<<8)+b]=0;a.a.Q.showDisplay&&a.a.ui.wf(d,a.gf);a.fb=-1}function Z(a,b,c,d){for(var e=0;e<d;e++)a.Oa[b+e]=c+e}
function s(a,b){if(b!=a.jc){a.jc=b;H(a);null===a.Oa&&(a.Oa=Array(32768));for(var c=0;32768>c;c++)a.Oa[c]=c;Z(a,16160,16128,32);Z(a,16192,16128,32);Z(a,16256,16128,32);Z(a,16320,16128,32);Z(a,12288,8192,3840);Z(a,16384,0,16384);b==a.a.b.jd?(a.m[0]=0,a.m[1]=0,a.m[2]=1,a.m[3]=1,Z(a,9216,8192,1024),Z(a,11264,10240,1024)):b==a.a.b.od?(a.m[0]=0,a.m[1]=1,a.m[2]=0,a.m[3]=1,Z(a,10240,8192,1024),Z(a,11264,9216,1024)):b==a.a.b.Ve?(a.m[0]=0,a.m[1]=0,a.m[2]=0,a.m[3]=0,Z(a,9216,8192,1024),Z(a,10240,8192,1024),
Z(a,11264,8192,1024)):b==a.a.b.rg?(a.m[0]=1,a.m[1]=1,a.m[2]=1,a.m[3]=1,Z(a,9216,9216,1024),Z(a,10240,9216,1024),Z(a,11264,9216,1024)):(a.m[0]=0,a.m[1]=1,a.m[2]=2,a.m[3]=3)}}h.Z.Qe=function(a,b,c){this.width=a;this.height=b;this.name=c;this.Vd=Array(a*b);this.ub=Array(a*b)};h.Z.Qe.prototype={toJSON:function(){return{tile:this.Vd,attrib:this.ub}},G:function(a){this.Vd=a.tile;this.ub=a.attrib}};
function X(a,b,c){var d=b%8*4;b=4*Math.floor(b/8);for(var e,f,g,l=0;2>l;l++)for(var m=0;2>m;m++){e=c>>2*(2*l+m)&3;for(var n=0;2>n;n++)for(var p=0;2>p;p++)f=d+2*m+p,g=b+2*l+n,a.ub[g*a.width+f]=e<<2&12}}h.Z.Se=function(){this.Rb=Array(64);this.ke=Array(8);this.Ye=-1};h.Z.Se.prototype={reset:function(){U(this,0)}};function U(a,b){if(b!=a.Ye){a.Ye=b;for(var c=0;64>c;c++)a.Rb[c]=a.ke[b][c]}}h.Z.ce=function(){this.la=Array(64);this.I=this.Aa=this.y=this.x=this.N=this.k=null;this.Ld=Array(8)};
h.Z.ce.prototype={toJSON:function(){return{opaque:this.Ld,pix:this.la}},G:function(a){this.Ld=a.opaque;this.la=a.pix}};
function Y(a,b,c,d,e,f,g,l,m,n,p,v){var r=0,t=8;if(!(-7>e||256<=e||-7>f||240<=f))if(0>e&&(r-=e),256<=e+t&&(t=256-e),0>f&&(c-=f),240<=f+d&&(d=240-f),m||n)if(m&&!n)for(a.k=(f<<8)+e,a.N=7,a.y=0;8>a.y;a.y++){for(a.x=0;8>a.x;a.x++)a.x>=r&&a.x<t&&a.y>=c&&a.y<d&&(a.Aa=a.la[a.N],a.I=v[a.k],0!==a.Aa&&p<=(a.I&255)&&(b[a.k]=l[a.Aa+g],a.I=a.I&3840|p,v[a.k]=a.I)),a.k++,a.N--;a.k-=8;a.k+=256;a.N+=16}else if(n&&!m)for(a.k=(f<<8)+e,a.N=56,a.y=0;8>a.y;a.y++){for(a.x=0;8>a.x;a.x++)a.x>=r&&a.x<t&&a.y>=c&&a.y<d&&(a.Aa=
a.la[a.N],a.I=v[a.k],0!==a.Aa&&p<=(a.I&255)&&(b[a.k]=l[a.Aa+g],a.I=a.I&3840|p,v[a.k]=a.I)),a.k++,a.N++;a.k-=8;a.k+=256;a.N-=16}else for(a.k=(f<<8)+e,a.N=63,a.y=0;8>a.y;a.y++){for(a.x=0;8>a.x;a.x++)a.x>=r&&a.x<t&&a.y>=c&&a.y<d&&(a.Aa=a.la[a.N],a.I=v[a.k],0!==a.Aa&&p<=(a.I&255)&&(b[a.k]=l[a.Aa+g],a.I=a.I&3840|p,v[a.k]=a.I)),a.k++,a.N--;a.k-=8;a.k+=256}else for(a.k=(f<<8)+e,a.N=0,a.y=0;8>a.y;a.y++){for(a.x=0;8>a.x;a.x++)a.x>=r&&a.x<t&&a.y>=c&&a.y<d&&(a.Aa=a.la[a.N],a.I=v[a.k],0!==a.Aa&&p<=(a.I&255)&&
(b[a.k]=l[a.Aa+g],a.I=a.I&3840|p,v[a.k]=a.I)),a.k++,a.N++;a.k-=8;a.k+=256}}function W(a,b,c,d){a.N=b<<3;for(a.x=0;8>a.x;a.x++)a.la[a.N+a.x]=(c>>7-a.x&1)+((d>>7-a.x&1)<<1),0===a.la[a.N+a.x]&&(a.Ld[b]=!1)};h.Ue=function(a){this.a=a;this.i=Array(92);for(a=0;92>a;a++)this.i[a]="Unknown Mapper";this.i[0]="Direct Access";this.i[1]="Nintendo MMC1";this.i[2]="UNROM";this.i[3]="CNROM";this.i[4]="Nintendo MMC3";this.i[5]="Nintendo MMC5";this.i[6]="FFE F4xxx";this.i[7]="AOROM";this.i[8]="FFE F3xxx";this.i[9]="Nintendo MMC2";this.i[10]="Nintendo MMC4";this.i[11]="Color Dreams Chip";this.i[12]="FFE F6xxx";this.i[15]="100-in-1 switch";this.i[16]="Bandai chip";this.i[17]="FFE F8xxx";this.i[18]="Jaleco SS8806 chip";
this.i[19]="Namcot 106 chip";this.i[20]="Famicom Disk System";this.i[21]="Konami VRC4a";this.i[22]="Konami VRC2a";this.i[23]="Konami VRC2a";this.i[24]="Konami VRC6";this.i[25]="Konami VRC4b";this.i[32]="Irem G-101 chip";this.i[33]="Taito TC0190/TC0350";this.i[34]="32kB ROM switch";this.i[64]="Tengen RAMBO-1 chip";this.i[65]="Irem H-3001 chip";this.i[66]="GNROM switch";this.i[67]="SunSoft3 chip";this.i[68]="SunSoft4 chip";this.i[69]="SunSoft5 FME-7 chip";this.i[71]="Camerica chip";this.i[78]="Irem 74HC161/32-based";
this.i[91]="Pirate HK-SF3 chip"};
h.Ue.prototype={od:0,jd:1,Hf:2,Ve:3,rg:4,Fa:null,b:null,Za:null,Nb:null,L:null,C:null,gb:null,de:null,Bg:null,$e:null,Sa:null,valid:!1,load:function(a){var b,c;if(-1===a.indexOf("NES\u001a"))this.a.ui.Na("Not a valid NES ROM.");else{this.Fa=new Uint8Array(16);for(b=0;16>b;b++)this.Fa[b]=a.charCodeAt(b)&255;this.L=this.Fa[4];this.C=2*this.Fa[5];this.gb=0!==(this.Fa[6]&1)?1:0;this.de=0!==(this.Fa[6]&2);this.Bg=0!==(this.Fa[6]&4);this.$e=0!==(this.Fa[6]&8);this.Sa=this.Fa[6]>>4|this.Fa[7]&240;c=!1;for(b=
8;16>b;b++)if(0!==this.Fa[b]){c=!0;break}c&&(this.Sa&=15);this.b=Array(this.L);var d=16;for(b=0;b<this.L;b++){this.b[b]=new Uint8Array(16384);for(c=0;16384>c&&!(d+c>=a.length);c++)this.b[b][c]=a.charCodeAt(d+c)&255;d+=16384}this.Za=Array(this.C);for(b=0;b<this.C;b++){this.Za[b]=new Uint8Array(4096);for(c=0;4096>c&&!(d+c>=a.length);c++)this.Za[b][c]=a.charCodeAt(d+c)&255;d+=4096}this.Nb=Array(this.C);for(b=0;b<this.C;b++)for(this.Nb[b]=Array(256),c=0;256>c;c++)this.Nb[b][c]=new h.Z.ce;for(a=0;a<this.C;a++)for(b=
0;4096>b;b++)c=b>>4,d=b%16,8>d?W(this.Nb[a][c],d,this.Za[a][b],this.Za[a][b+8]):W(this.Nb[a][c],d-8,this.Za[a][b-8],this.Za[a][b]);this.valid=!0}}};h.Gf=function(a){this.a=a;this.enable=function(){};this.Na=function(){};this.vf=function(){};this.wf=function(){}};
"undefined"!==typeof jQuery&&function(a){a.fn.qg=function(b){function c(c){var f=this;f.a=c;f.root=a("<div></div>");f.screen=a('<canvas class="nes-screen" width="256" height="240"></canvas>').appendTo(f.root);f.screen[0].getContext?(f.xg=a('<div class="nes-roms"></div>').appendTo(f.root),f.Zc=a("<select></select>").appendTo(f.xg),f.controls=a('<div class="nes-controls"></div>').appendTo(f.root),f.buttons={pause:a('<input type="button" value="pause" class="nes-pause" disabled="disabled">').appendTo(f.controls),
lf:a('<input type="button" value="restart" class="nes-restart" disabled="disabled">').appendTo(f.controls),dd:a('<input type="button" value="enable sound" class="nes-enablesound">').appendTo(f.controls),zoom:a('<input type="button" value="zoom in" class="nes-zoom">').appendTo(f.controls)},f.status=a('<p class="nes-status">Booting up...</p>').appendTo(f.root),f.root.appendTo(d),f.Zc.change(function(){f.pc()}),f.buttons.pause.click(function(){f.a.zb?(f.a.stop(),f.Na("Paused"),f.buttons.pause.attr("value",
"resume")):(f.a.start(),f.buttons.pause.attr("value","pause"))}),f.buttons.lf.click(function(){f.a.jf();f.a.start()}),f.buttons.dd.click(function(){f.a.Q.emulateSound?(f.a.Q.emulateSound=!1,f.buttons.dd.attr("value","enable sound")):(f.a.Q.emulateSound=!0,f.buttons.dd.attr("value","disable sound"))}),f.Fe=!1,f.buttons.zoom.click(function(){f.Fe?(f.screen.animate({width:"256px",height:"240px"}),f.buttons.zoom.attr("value","zoom in"),f.Fe=!1):(f.screen.animate({width:"512px",height:"480px"}),f.buttons.zoom.attr("value",
"zoom out"),f.Fe=!0)}),a.offset&&f.screen.mousedown(function(a){f.a.l&&(f.a.l.Id=!0,f.a.l.Jd=a.pageX-f.screen.offset().left,f.a.l.Kd=a.pageY-f.screen.offset().top)}).mouseup(function(){setTimeout(function(){f.a.l&&(f.a.l.Id=!1,f.a.l.Jd=0,f.a.l.Kd=0)},500)}),"undefined"!=typeof b&&f.zg(b),f.Ec=f.screen[0].getContext("2d"),f.Ec.getImageData?(f.qd=f.Ec.getImageData(0,0,256,240),f.wg(),a(document).bind("keydown",function(a){f.a.Rc.af(a)}).bind("keyup",function(a){f.a.Rc.cf(a)}).bind("keypress",function(a){f.a.Rc.bf(a)}),
f.tg=new DynamicAudio({swf:c.Q.swfPath+"dynamicaudio.swf"})):d.html("Your browser doesn't support writing pixels directly to the <code>&lt;canvas&gt;</code> tag. Try the latest versions of Google Chrome, Safari, Opera or Firefox!")):d.html("Your browser doesn't support the <code>&lt;canvas&gt;</code> tag. Try Google Chrome, Safari, Opera or Firefox!")}var d=this;c.prototype={pc:function(){var b=this;b.Na("Downloading...");a.ajax({url:escape(b.Zc.val()),xhr:function(){var c=a.ajaxSettings.xhr();"undefined"!==
typeof c.overrideMimeType&&c.overrideMimeType("text/plain; charset=x-user-defined");return b.xhr=c},complete:function(a){h.ta.ug()?(a=JSNESBinaryToArray(a.responseBody).toArray(),a=String.fromCharCode.apply(void 0,a)):a=a.responseText;b.a.Hd(a);b.a.start();b.enable()}})},wg:function(){this.Ec.fillStyle="black";this.Ec.fillRect(0,0,256,240);for(var a=3;a<this.qd.data.length-3;a+=4)this.qd.data[a]=255},enable:function(){this.buttons.pause.attr("disabled",null);this.a.zb?this.buttons.pause.attr("value",
"pause"):this.buttons.pause.attr("value","resume");this.buttons.lf.attr("disabled",null);this.a.Q.emulateSound?this.buttons.dd.attr("value","disable sound"):this.buttons.dd.attr("value","enable sound")},Na:function(a){this.status.text(a)},zg:function(b){this.Zc.children().remove();a("<option>Select a ROM...</option>").appendTo(this.Zc);for(var c in b)if(b.hasOwnProperty(c)){for(var d=a("<optgroup></optgroup>").attr("label",c),l=0;l<b[c].length;l++)a("<option>"+b[c][l][0]+"</option>").attr("value",
b[c][l][1]).appendTo(d);this.Zc.append(d)}},vf:function(a){return this.tg.writeInt(a)},wf:function(a,b){var c=this.qd.data,d,m,n;for(m=0;61440>m;m++)d=a[m],d!=b[m]&&(n=4*m,c[n]=d&255,c[n+1]=d>>8&255,c[n+2]=d>>16&255,b[m]=d);this.Ec.putImageData(this.qd,0,0)}};return c}}(jQuery);window.$=$;$.fn.JSNESUI=$.fn.qg;window.JSNES=h;h.prototype.loadRom=h.prototype.Hd;h.prototype.start=h.prototype.start;h.prototype.frame=h.prototype.frame;h.prototype.reloadRom=h.prototype.jf;h.prototype.stop=h.prototype.stop;h.prototype.toJSON=h.prototype.toJSON;h.prototype.fromJSON=h.prototype.G;h.CPU=h.mb;h.CPU.prototype.toJSON=h.mb.prototype.toJSON;h.CPU.prototype.fromJSON=h.mb.prototype.G;h.PPU=h.Z;h.PPU.prototype.toJSON=h.Z.prototype.toJSON;h.PPU.prototype.fromJSON=h.Z.prototype.G;
h.Keyboard=h.fc;h.Keyboard.prototype.keyDown=h.fc.prototype.af;h.Keyboard.prototype.keyUp=h.fc.prototype.cf;h.Keyboard.prototype.keyPress=h.fc.prototype.bf;h.prototype.isRunning=h.prototype.zb;h.prototype.fpsFrameCount=h.prototype.Kc;h.prototype.limitFrames=h.prototype.Fg;h.prototype.romData=h.prototype.Yc;h.prototype.reset=h.prototype.reset;h.prototype.printFps=h.prototype.te;h.prototype.resetFps=h.prototype.kf;h.prototype.setFramerate=h.prototype.yg;h.prototype.setLimitFrames=h.prototype.Hg;
